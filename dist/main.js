(()=>{var xx=Object.create;var ad=Object.defineProperty;var Ax=Object.getOwnPropertyDescriptor;var Ex=Object.getOwnPropertyNames;var Ix=Object.getPrototypeOf,Ox=Object.prototype.hasOwnProperty;var g=(n,e)=>()=>(n&&(e=n(n=0)),e);var C=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Gi=(n,e)=>{for(var t in e)ad(n,t,{get:e[t],enumerable:!0})},Px=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ex(e))!Ox.call(n,s)&&s!==t&&ad(n,s,{get:()=>e[s],enumerable:!(r=Ax(e,s))||r.enumerable});return n};var At=(n,e,t)=>(t=n!=null?xx(Ix(n)):{},Px(e||!n||!n.__esModule?ad(t,"default",{value:n,enumerable:!0}):t,n));var _m,wm,vm,ml=g(()=>{_m=Symbol("Let zodToJsonSchema decide on which parser to use"),wm={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},vm=n=>typeof n=="string"?{...wm,name:n}:{...wm,...n}});var xm,od=g(()=>{ml();xm=n=>{let e=vm(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}}});function ld(n,e,t,r){r?.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Y(n,e,t,r,s){n[e]=t,ld(n,e,r,s)}var Qr=g(()=>{});var gl,yl=g(()=>{gl=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")}});var W,ud,I,Qt,Ki=g(()=>{(function(n){n.assertEqual=s=>{};function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{let a={};for(let i of s)a[i]=i;return a},n.getValidEnumValues=s=>{let a=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of a)i[o]=s[o];return n.objectValues(i)},n.objectValues=s=>n.objectKeys(s).map(function(a){return s[a]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let a=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},n.find=(s,a)=>{for(let i of s)if(a(i))return i},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}n.joinValues=r,n.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(W||(W={}));(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(ud||(ud={}));I=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qt=n=>{switch(typeof n){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(n)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(n)?I.array:n===null?I.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?I.promise:typeof Map<"u"&&n instanceof Map?I.map:typeof Set<"u"&&n instanceof Set?I.set:typeof Date<"u"&&n instanceof Date?I.date:I.object;default:return I.unknown}}});var _,Sx,et,bl=g(()=>{Ki();_=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Sx=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),et=class n extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(a){return a.message},r={_errors:[]},s=a=>{for(let i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let o=r,l=0;for(;l<i.path.length;){let u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),r}static assert(e){if(!(e instanceof n))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},r=[];for(let s of this.issues)if(s.path.length>0){let a=s.path[0];t[a]=t[a]||[],t[a].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};et.create=n=>new et(n)});var Cx,Ar,cd=g(()=>{bl();Ki();Cx=(n,e)=>{let t;switch(n.code){case _.invalid_type:n.received===I.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case _.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,W.jsonStringifyReplacer)}`;break;case _.unrecognized_keys:t=`Unrecognized key(s) in object: ${W.joinValues(n.keys,", ")}`;break;case _.invalid_union:t="Invalid input";break;case _.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${W.joinValues(n.options)}`;break;case _.invalid_enum_value:t=`Invalid enum value. Expected ${W.joinValues(n.options)}, received '${n.received}'`;break;case _.invalid_arguments:t="Invalid function arguments";break;case _.invalid_return_type:t="Invalid function return type";break;case _.invalid_date:t="Invalid date";break;case _.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:W.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case _.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case _.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case _.custom:t="Invalid input";break;case _.invalid_intersection_types:t="Intersection results could not be merged";break;case _.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case _.not_finite:t="Number must be finite";break;default:t=e.defaultError,W.assertNever(n)}return{message:t}},Ar=Cx});function kx(n){Am=n}function ra(){return Am}var Am,wl=g(()=>{cd();Am=Ar});function E(n,e){let t=ra(),r=Wi({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Ar?void 0:Ar].filter(s=>!!s)});n.common.issues.push(r)}var Wi,Rx,Se,L,Dn,De,_l,vl,en,na,dd=g(()=>{wl();cd();Wi=n=>{let{data:e,path:t,errorMaps:r,issueData:s}=n,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="",l=r.filter(u=>!!u).slice().reverse();for(let u of l)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},Rx=[];Se=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let s of t){if(s.status==="aborted")return L;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let s of t){let a=await s.key,i=await s.value;r.push({key:a,value:i})}return n.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let s of t){let{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return L;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:e.value,value:r}}},L=Object.freeze({status:"aborted"}),Dn=n=>({status:"dirty",value:n}),De=n=>({status:"valid",value:n}),_l=n=>n.status==="aborted",vl=n=>n.status==="dirty",en=n=>n.status==="valid",na=n=>typeof Promise<"u"&&n instanceof Promise});var Em=g(()=>{});var k,Im=g(()=>{(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(k||(k={}))});function q(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{let{message:l}=n;return i.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??r??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:l??t??o.defaultError}},description:s}}function Sm(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);let t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Jx(n){return new RegExp(`^${Sm(n)}$`)}function Cm(n){let e=`${Tm}T${Sm(n)}`,t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Zx(n,e){return!!((e==="v4"||!e)&&zx.test(n)||(e==="v6"||!e)&&Hx.test(n))}function Yx(n,e){if(!Dx.test(n))return!1;try{let[t]=n.split(".");if(!t)return!1;let r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Xx(n,e){return!!((e==="v4"||!e)&&qx.test(n)||(e==="v6"||!e)&&Vx.test(n))}function Qx(n,e){let t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,a=Number.parseInt(n.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}function sa(n){if(n instanceof tt){let e={};for(let t in n.shape){let r=n.shape[t];e[t]=Et.create(sa(r))}return new tt({...n._def,shape:()=>e})}else return n instanceof Or?new Or({...n._def,type:sa(n.element)}):n instanceof Et?Et.create(sa(n.unwrap())):n instanceof tr?tr.create(sa(n.unwrap())):n instanceof er?er.create(n.items.map(e=>sa(e))):n}function fd(n,e){let t=Qt(n),r=Qt(e);if(n===e)return{valid:!0,data:n};if(t===I.object&&r===I.object){let s=W.objectKeys(e),a=W.objectKeys(n).filter(o=>s.indexOf(o)!==-1),i={...n,...e};for(let o of a){let l=fd(n[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(t===I.array&&r===I.array){if(n.length!==e.length)return{valid:!1};let s=[];for(let a=0;a<n.length;a++){let i=n[a],o=e[a],l=fd(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===I.date&&r===I.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}function km(n,e){return new Jn({values:n,typeName:v.ZodEnum,...q(e)})}function Pm(n,e){let t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function Rm(n,e={},t){return n?rn.create().superRefine((r,s)=>{let a=n(r);if(a instanceof Promise)return a.then(i=>{if(!i){let o=Pm(e,r),l=o.fatal??t??!0;s.addIssue({code:"custom",...o,fatal:l})}});if(!a){let i=Pm(e,r),o=i.fatal??t??!0;s.addIssue({code:"custom",...i,fatal:o})}}):rn.create()}var It,Om,H,Nx,$x,Mx,jx,Lx,Dx,Fx,Ux,Bx,pd,zx,qx,Hx,Vx,Gx,Kx,Tm,Wx,tn,Fn,Un,Bn,zn,aa,qn,Hn,rn,Ir,Dt,ia,Or,tt,Vn,Er,xl,Gn,er,Al,oa,la,El,Kn,Wn,Jn,Zn,nn,Ot,Et,tr,Yn,Xn,ua,e0,Ji,Zi,Qn,t0,v,r0,Nm,$m,n0,s0,Mm,a0,i0,o0,l0,u0,c0,d0,p0,f0,h0,m0,g0,y0,b0,w0,_0,v0,x0,A0,E0,I0,O0,P0,T0,S0,C0,k0,R0,N0,$0,M0,j0,L0,D0,jm=g(()=>{bl();wl();Im();dd();Ki();It=class{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Om=(n,e)=>{if(en(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new et(n.common.issues);return this._error=t,this._error}}};H=class{get description(){return this._def.description}_getType(e){return Qt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Qt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Se,ctx:{common:e.parent.common,data:e.data,parsedType:Qt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(na(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qt(e)},s=this._parseSync({data:e,path:r.path,parent:r});return Om(r,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qt(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return en(r)?{value:r.value}:{issues:t.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(r=>en(r)?{value:r.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qt(e)},s=this._parse({data:e,path:r.path,parent:r}),a=await(na(s)?s:Promise.resolve(s));return Om(r,a)}refine(e,t){let r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{let i=e(s),o=()=>a.addIssue({code:_.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new Ot({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Et.create(this,this._def)}nullable(){return tr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Or.create(this)}promise(){return nn.create(this,this._def)}or(e){return Vn.create([this,e],this._def)}and(e){return Gn.create(this,e,this._def)}transform(e){return new Ot({...q(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Yn({...q(this._def),innerType:this,defaultValue:t,typeName:v.ZodDefault})}brand(){return new Ji({typeName:v.ZodBranded,type:this,...q(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Xn({...q(this._def),innerType:this,catchValue:t,typeName:v.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Zi.create(this,e)}readonly(){return Qn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Nx=/^c[^\s-]{8,}$/i,$x=/^[0-9a-z]+$/,Mx=/^[0-9A-HJKMNP-TV-Z]{26}$/i,jx=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Lx=/^[a-z0-9_-]{21}$/i,Dx=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Fx=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ux=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Bx="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",zx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,qx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Hx=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Vx=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Gx=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Kx=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Tm="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Wx=new RegExp(`^${Tm}$`);tn=class n extends H{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==I.string){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_type,expected:I.string,received:a.parsedType}),L}let r=new Se,s;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?E(s,{code:_.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(s,{code:_.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")Ux.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"email",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")pd||(pd=new RegExp(Bx,"u")),pd.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"emoji",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")jx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"uuid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")Lx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"nanoid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")Nx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")$x.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid2",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")Mx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ulid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),E(s,{validation:"url",code:_.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"regex",code:_.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?Cm(a).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?Wx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?Jx(a).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?Fx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"duration",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?Zx(e.data,a.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ip",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?Yx(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"jwt",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?Xx(e.data,a.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cidr",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?Gx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?Kx.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64url",code:_.invalid_string,message:a.message}),r.dirty()):W.assertNever(a);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:_.invalid_string,...k.errToObj(r)})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...k.errToObj(e)})}url(e){return this._addCheck({kind:"url",...k.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...k.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...k.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...k.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...k.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...k.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...k.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...k.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...k.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...k.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...k.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...k.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...k.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...k.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...k.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...k.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...k.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...k.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...k.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...k.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...k.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...k.errToObj(t)})}nonempty(e){return this.min(1,k.errToObj(e))}trim(){return new n({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};tn.create=n=>new tn({checks:[],typeName:v.ZodString,coerce:n?.coerce??!1,...q(n)});Fn=class n extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==I.number){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_type,expected:I.number,received:a.parsedType}),L}let r,s=new Se;for(let a of this._def.checks)a.kind==="int"?W.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Qx(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.not_finite,message:a.message}),s.dirty()):W.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,k.toString(t))}gt(e,t){return this.setLimit("min",e,!1,k.toString(t))}lte(e,t){return this.setLimit("max",e,!0,k.toString(t))}lt(e,t){return this.setLimit("max",e,!1,k.toString(t))}setLimit(e,t,r,s){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:k.toString(s)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:k.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:k.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:k.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:k.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:k.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Fn.create=n=>new Fn({checks:[],typeName:v.ZodNumber,coerce:n?.coerce||!1,...q(n)});Un=class n extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==I.bigint)return this._getInvalidInput(e);let r,s=new Se;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):W.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return E(t,{code:_.invalid_type,expected:I.bigint,received:t.parsedType}),L}gte(e,t){return this.setLimit("min",e,!0,k.toString(t))}gt(e,t){return this.setLimit("min",e,!1,k.toString(t))}lte(e,t){return this.setLimit("max",e,!0,k.toString(t))}lt(e,t){return this.setLimit("max",e,!1,k.toString(t))}setLimit(e,t,r,s){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:k.toString(s)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:k.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:k.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:k.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:k.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:k.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Un.create=n=>new Un({checks:[],typeName:v.ZodBigInt,coerce:n?.coerce??!1,...q(n)});Bn=class extends H{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==I.boolean){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:I.boolean,received:r.parsedType}),L}return De(e.data)}};Bn.create=n=>new Bn({typeName:v.ZodBoolean,coerce:n?.coerce||!1,...q(n)});zn=class n extends H{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==I.date){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_type,expected:I.date,received:a.parsedType}),L}if(Number.isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_date}),L}let r=new Se,s;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):W.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:k.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:k.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};zn.create=n=>new zn({checks:[],coerce:n?.coerce||!1,typeName:v.ZodDate,...q(n)});aa=class extends H{_parse(e){if(this._getType(e)!==I.symbol){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:I.symbol,received:r.parsedType}),L}return De(e.data)}};aa.create=n=>new aa({typeName:v.ZodSymbol,...q(n)});qn=class extends H{_parse(e){if(this._getType(e)!==I.undefined){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:I.undefined,received:r.parsedType}),L}return De(e.data)}};qn.create=n=>new qn({typeName:v.ZodUndefined,...q(n)});Hn=class extends H{_parse(e){if(this._getType(e)!==I.null){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:I.null,received:r.parsedType}),L}return De(e.data)}};Hn.create=n=>new Hn({typeName:v.ZodNull,...q(n)});rn=class extends H{constructor(){super(...arguments),this._any=!0}_parse(e){return De(e.data)}};rn.create=n=>new rn({typeName:v.ZodAny,...q(n)});Ir=class extends H{constructor(){super(...arguments),this._unknown=!0}_parse(e){return De(e.data)}};Ir.create=n=>new Ir({typeName:v.ZodUnknown,...q(n)});Dt=class extends H{_parse(e){let t=this._getOrReturnCtx(e);return E(t,{code:_.invalid_type,expected:I.never,received:t.parsedType}),L}};Dt.create=n=>new Dt({typeName:v.ZodNever,...q(n)});ia=class extends H{_parse(e){if(this._getType(e)!==I.undefined){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:I.void,received:r.parsedType}),L}return De(e.data)}};ia.create=n=>new ia({typeName:v.ZodVoid,...q(n)});Or=class n extends H{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==I.array)return E(t,{code:_.invalid_type,expected:I.array,received:t.parsedType}),L;if(s.exactLength!==null){let i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(E(t,{code:i?_.too_big:_.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(E(t,{code:_.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(E(t,{code:_.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new It(t,i,t.path,o)))).then(i=>Se.mergeArray(r,i));let a=[...t.data].map((i,o)=>s.type._parseSync(new It(t,i,t.path,o)));return Se.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new n({...this._def,minLength:{value:e,message:k.toString(t)}})}max(e,t){return new n({...this._def,maxLength:{value:e,message:k.toString(t)}})}length(e,t){return new n({...this._def,exactLength:{value:e,message:k.toString(t)}})}nonempty(e){return this.min(1,e)}};Or.create=(n,e)=>new Or({type:n,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...q(e)});tt=class n extends H{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=W.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==I.object){let u=this._getOrReturnCtx(e);return E(u,{code:_.invalid_type,expected:I.object,received:u.parsedType}),L}let{status:r,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Dt&&this._def.unknownKeys==="strip"))for(let u in s.data)i.includes(u)||o.push(u);let l=[];for(let u of i){let c=a[u],d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new It(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Dt){let u=this._def.unknownKeys;if(u==="passthrough")for(let c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&(E(s,{code:_.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let c of o){let d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new It(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let u=[];for(let c of l){let d=await c.key,p=await c.value;u.push({key:d,value:p,alwaysSet:c.alwaysSet})}return u}).then(u=>Se.mergeObjectSync(r,u)):Se.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return k.errToObj,new n({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{let s=this._def.errorMap?.(t,r).message??r.defaultError;return t.code==="unrecognized_keys"?{message:k.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new n({...this._def,unknownKeys:"strip"})}passthrough(){return new n({...this._def,unknownKeys:"passthrough"})}extend(e){return new n({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new n({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new n({...this._def,catchall:e})}pick(e){let t={};for(let r of W.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}omit(e){let t={};for(let r of W.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}deepPartial(){return sa(this)}partial(e){let t={};for(let r of W.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new n({...this._def,shape:()=>t})}required(e){let t={};for(let r of W.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof Et;)a=a._def.innerType;t[r]=a}return new n({...this._def,shape:()=>t})}keyof(){return km(W.objectKeys(this.shape))}};tt.create=(n,e)=>new tt({shape:()=>n,unknownKeys:"strip",catchall:Dt.create(),typeName:v.ZodObject,...q(e)});tt.strictCreate=(n,e)=>new tt({shape:()=>n,unknownKeys:"strict",catchall:Dt.create(),typeName:v.ZodObject,...q(e)});tt.lazycreate=(n,e)=>new tt({shape:n,unknownKeys:"strip",catchall:Dt.create(),typeName:v.ZodObject,...q(e)});Vn=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function s(a){for(let o of a)if(o.result.status==="valid")return o.result;for(let o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let i=a.map(o=>new et(o.ctx.common.issues));return E(t,{code:_.invalid_union,unionErrors:i}),L}if(t.common.async)return Promise.all(r.map(async a=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a,i=[];for(let l of r){let u={...t,common:{...t.common,issues:[]},parent:null},c=l._parseSync({data:t.data,path:t.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(l=>new et(l));return E(t,{code:_.invalid_union,unionErrors:o}),L}}get options(){return this._def.options}};Vn.create=(n,e)=>new Vn({options:n,typeName:v.ZodUnion,...q(e)});Er=n=>n instanceof Kn?Er(n.schema):n instanceof Ot?Er(n.innerType()):n instanceof Wn?[n.value]:n instanceof Jn?n.options:n instanceof Zn?W.objectValues(n.enum):n instanceof Yn?Er(n._def.innerType):n instanceof qn?[void 0]:n instanceof Hn?[null]:n instanceof Et?[void 0,...Er(n.unwrap())]:n instanceof tr?[null,...Er(n.unwrap())]:n instanceof Ji||n instanceof Qn?Er(n.unwrap()):n instanceof Xn?Er(n._def.innerType):[],xl=class n extends H{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.object)return E(t,{code:_.invalid_type,expected:I.object,received:t.parsedType}),L;let r=this.discriminator,s=t.data[r],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(E(t,{code:_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),L)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let a of t){let i=Er(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new n({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...q(r)})}};Gn=class extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=(a,i)=>{if(_l(a)||_l(i))return L;let o=fd(a.value,i.value);return o.valid?((vl(a)||vl(i))&&t.dirty(),{status:t.value,value:o.data}):(E(r,{code:_.invalid_intersection_types}),L)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Gn.create=(n,e,t)=>new Gn({left:n,right:e,typeName:v.ZodIntersection,...q(t)});er=class n extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.array)return E(r,{code:_.invalid_type,expected:I.array,received:r.parsedType}),L;if(r.data.length<this._def.items.length)return E(r,{code:_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),L;!this._def.rest&&r.data.length>this._def.items.length&&(E(r,{code:_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((i,o)=>{let l=this._def.items[o]||this._def.rest;return l?l._parse(new It(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>Se.mergeArray(t,i)):Se.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new n({...this._def,rest:e})}};er.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new er({items:n,typeName:v.ZodTuple,rest:null,...q(e)})};Al=class n extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.object)return E(r,{code:_.invalid_type,expected:I.object,received:r.parsedType}),L;let s=[],a=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:a._parse(new It(r,o,r.path,o)),value:i._parse(new It(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Se.mergeObjectAsync(t,s):Se.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof H?new n({keyType:e,valueType:t,typeName:v.ZodRecord,...q(r)}):new n({keyType:tn.create(),valueType:e,typeName:v.ZodRecord,...q(t)})}},oa=class extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.map)return E(r,{code:_.invalid_type,expected:I.map,received:r.parsedType}),L;let s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,l],u)=>({key:s._parse(new It(r,o,r.path,[u,"key"])),value:a._parse(new It(r,l,r.path,[u,"value"]))}));if(r.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let l of i){let u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return L;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let l of i){let u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return L;(u.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(u.value,c.value)}return{status:t.value,value:o}}}};oa.create=(n,e,t)=>new oa({valueType:e,keyType:n,typeName:v.ZodMap,...q(t)});la=class n extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.set)return E(r,{code:_.invalid_type,expected:I.set,received:r.parsedType}),L;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(E(r,{code:_.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(E(r,{code:_.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let a=this._def.valueType;function i(l){let u=new Set;for(let c of l){if(c.status==="aborted")return L;c.status==="dirty"&&t.dirty(),u.add(c.value)}return{status:t.value,value:u}}let o=[...r.data.values()].map((l,u)=>a._parse(new It(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,t){return new n({...this._def,minSize:{value:e,message:k.toString(t)}})}max(e,t){return new n({...this._def,maxSize:{value:e,message:k.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};la.create=(n,e)=>new la({valueType:n,minSize:null,maxSize:null,typeName:v.ZodSet,...q(e)});El=class n extends H{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.function)return E(t,{code:_.invalid_type,expected:I.function,received:t.parsedType}),L;function r(o,l){return Wi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ra(),Ar].filter(u=>!!u),issueData:{code:_.invalid_arguments,argumentsError:l}})}function s(o,l){return Wi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ra(),Ar].filter(u=>!!u),issueData:{code:_.invalid_return_type,returnTypeError:l}})}let a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof nn){let o=this;return De(async function(...l){let u=new et([]),c=await o._def.args.parseAsync(l,a).catch(f=>{throw u.addIssue(r(l,f)),u}),d=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(d,a).catch(f=>{throw u.addIssue(s(d,f)),u})})}else{let o=this;return De(function(...l){let u=o._def.args.safeParse(l,a);if(!u.success)throw new et([r(l,u.error)]);let c=Reflect.apply(i,this,u.data),d=o._def.returns.safeParse(c,a);if(!d.success)throw new et([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n({...this._def,args:er.create(e).rest(Ir.create())})}returns(e){return new n({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new n({args:e||er.create([]).rest(Ir.create()),returns:t||Ir.create(),typeName:v.ZodFunction,...q(r)})}},Kn=class extends H{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Kn.create=(n,e)=>new Kn({getter:n,typeName:v.ZodLazy,...q(e)});Wn=class extends H{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return E(t,{received:t.data,code:_.invalid_literal,expected:this._def.value}),L}return{status:"valid",value:e.data}}get value(){return this._def.value}};Wn.create=(n,e)=>new Wn({value:n,typeName:v.ZodLiteral,...q(e)});Jn=class n extends H{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),r=this._def.values;return E(t,{expected:W.joinValues(r),received:t.parsedType,code:_.invalid_type}),L}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return E(t,{received:t.data,code:_.invalid_enum_value,options:r}),L}return De(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return n.create(e,{...this._def,...t})}exclude(e,t=this._def){return n.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}};Jn.create=km;Zn=class extends H{_parse(e){let t=W.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==I.string&&r.parsedType!==I.number){let s=W.objectValues(t);return E(r,{expected:W.joinValues(s),received:r.parsedType,code:_.invalid_type}),L}if(this._cache||(this._cache=new Set(W.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=W.objectValues(t);return E(r,{received:r.data,code:_.invalid_enum_value,options:s}),L}return De(e.data)}get enum(){return this._def.values}};Zn.create=(n,e)=>new Zn({values:n,typeName:v.ZodNativeEnum,...q(e)});nn=class extends H{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.promise&&t.common.async===!1)return E(t,{code:_.invalid_type,expected:I.promise,received:t.parsedType}),L;let r=t.parsedType===I.promise?t.data:Promise.resolve(t.data);return De(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};nn.create=(n,e)=>new nn({type:n,typeName:v.ZodPromise,...q(e)});Ot=class extends H{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{E(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){let i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return L;let l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?L:l.status==="dirty"?Dn(l.value):t.value==="dirty"?Dn(l.value):l});{if(t.value==="aborted")return L;let o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?L:o.status==="dirty"?Dn(o.value):t.value==="dirty"?Dn(o.value):o}}if(s.type==="refinement"){let i=o=>{let l=s.refinement(o,a);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?L:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?L:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!en(i))return L;let o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>en(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):L);W.assertNever(s)}};Ot.create=(n,e,t)=>new Ot({schema:n,typeName:v.ZodEffects,effect:e,...q(t)});Ot.createWithPreprocess=(n,e,t)=>new Ot({schema:e,effect:{type:"preprocess",transform:n},typeName:v.ZodEffects,...q(t)});Et=class extends H{_parse(e){return this._getType(e)===I.undefined?De(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Et.create=(n,e)=>new Et({innerType:n,typeName:v.ZodOptional,...q(e)});tr=class extends H{_parse(e){return this._getType(e)===I.null?De(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};tr.create=(n,e)=>new tr({innerType:n,typeName:v.ZodNullable,...q(e)});Yn=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===I.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Yn.create=(n,e)=>new Yn({innerType:n,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...q(e)});Xn=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return na(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new et(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new et(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};Xn.create=(n,e)=>new Xn({innerType:n,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...q(e)});ua=class extends H{_parse(e){if(this._getType(e)!==I.nan){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:I.nan,received:r.parsedType}),L}return{status:"valid",value:e.data}}};ua.create=n=>new ua({typeName:v.ZodNaN,...q(n)});e0=Symbol("zod_brand"),Ji=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Zi=class n extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?L:a.status==="dirty"?(t.dirty(),Dn(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?L:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new n({in:e,out:t,typeName:v.ZodPipeline})}},Qn=class extends H{_parse(e){let t=this._def.innerType._parse(e),r=s=>(en(s)&&(s.value=Object.freeze(s.value)),s);return na(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}};Qn.create=(n,e)=>new Qn({innerType:n,typeName:v.ZodReadonly,...q(e)});t0={object:tt.lazycreate};(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(v||(v={}));r0=(n,e={message:`Input not instance of ${n.name}`})=>Rm(t=>t instanceof n,e),Nm=tn.create,$m=Fn.create,n0=ua.create,s0=Un.create,Mm=Bn.create,a0=zn.create,i0=aa.create,o0=qn.create,l0=Hn.create,u0=rn.create,c0=Ir.create,d0=Dt.create,p0=ia.create,f0=Or.create,h0=tt.create,m0=tt.strictCreate,g0=Vn.create,y0=xl.create,b0=Gn.create,w0=er.create,_0=Al.create,v0=oa.create,x0=la.create,A0=El.create,E0=Kn.create,I0=Wn.create,O0=Jn.create,P0=Zn.create,T0=nn.create,S0=Ot.create,C0=Et.create,k0=tr.create,R0=Ot.createWithPreprocess,N0=Zi.create,$0=()=>Nm().optional(),M0=()=>$m().optional(),j0=()=>Mm().optional(),L0={string:n=>tn.create({...n,coerce:!0}),number:n=>Fn.create({...n,coerce:!0}),boolean:n=>Bn.create({...n,coerce:!0}),bigint:n=>Un.create({...n,coerce:!0}),date:n=>zn.create({...n,coerce:!0})},D0=L});var rt={};Gi(rt,{BRAND:()=>e0,DIRTY:()=>Dn,EMPTY_PATH:()=>Rx,INVALID:()=>L,NEVER:()=>D0,OK:()=>De,ParseStatus:()=>Se,Schema:()=>H,ZodAny:()=>rn,ZodArray:()=>Or,ZodBigInt:()=>Un,ZodBoolean:()=>Bn,ZodBranded:()=>Ji,ZodCatch:()=>Xn,ZodDate:()=>zn,ZodDefault:()=>Yn,ZodDiscriminatedUnion:()=>xl,ZodEffects:()=>Ot,ZodEnum:()=>Jn,ZodError:()=>et,ZodFirstPartyTypeKind:()=>v,ZodFunction:()=>El,ZodIntersection:()=>Gn,ZodIssueCode:()=>_,ZodLazy:()=>Kn,ZodLiteral:()=>Wn,ZodMap:()=>oa,ZodNaN:()=>ua,ZodNativeEnum:()=>Zn,ZodNever:()=>Dt,ZodNull:()=>Hn,ZodNullable:()=>tr,ZodNumber:()=>Fn,ZodObject:()=>tt,ZodOptional:()=>Et,ZodParsedType:()=>I,ZodPipeline:()=>Zi,ZodPromise:()=>nn,ZodReadonly:()=>Qn,ZodRecord:()=>Al,ZodSchema:()=>H,ZodSet:()=>la,ZodString:()=>tn,ZodSymbol:()=>aa,ZodTransformer:()=>Ot,ZodTuple:()=>er,ZodType:()=>H,ZodUndefined:()=>qn,ZodUnion:()=>Vn,ZodUnknown:()=>Ir,ZodVoid:()=>ia,addIssueToContext:()=>E,any:()=>u0,array:()=>f0,bigint:()=>s0,boolean:()=>Mm,coerce:()=>L0,custom:()=>Rm,date:()=>a0,datetimeRegex:()=>Cm,defaultErrorMap:()=>Ar,discriminatedUnion:()=>y0,effect:()=>S0,enum:()=>O0,function:()=>A0,getErrorMap:()=>ra,getParsedType:()=>Qt,instanceof:()=>r0,intersection:()=>b0,isAborted:()=>_l,isAsync:()=>na,isDirty:()=>vl,isValid:()=>en,late:()=>t0,lazy:()=>E0,literal:()=>I0,makeIssue:()=>Wi,map:()=>v0,nan:()=>n0,nativeEnum:()=>P0,never:()=>d0,null:()=>l0,nullable:()=>k0,number:()=>$m,object:()=>h0,objectUtil:()=>ud,oboolean:()=>j0,onumber:()=>M0,optional:()=>C0,ostring:()=>$0,pipeline:()=>N0,preprocess:()=>R0,promise:()=>T0,quotelessJson:()=>Sx,record:()=>_0,set:()=>x0,setErrorMap:()=>kx,strictObject:()=>m0,string:()=>Nm,symbol:()=>i0,transformer:()=>S0,tuple:()=>w0,undefined:()=>o0,union:()=>g0,unknown:()=>c0,util:()=>W,void:()=>p0});var hd=g(()=>{wl();dd();Em();Ki();jm();bl()});var es=g(()=>{hd();hd()});function ne(n){if(n.target!=="openAi")return{};let e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?gl(e,n.currentPath):e.join("/")}}var Pt=g(()=>{yl()});function Lm(n,e){let t={type:"array"};return n.type?._def&&n.type?._def?.typeName!==v.ZodAny&&(t.items=D(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Y(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Y(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Y(t,"minItems",n.exactLength.value,n.exactLength.message,e),Y(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}var md=g(()=>{es();Qr();de()});function Dm(n,e){let t={type:"integer",format:"int64"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Y(t,"minimum",r.value,r.message,e):Y(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Y(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Y(t,"maximum",r.value,r.message,e):Y(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Y(t,"maximum",r.value,r.message,e));break;case"multipleOf":Y(t,"multipleOf",r.value,r.message,e);break}return t}var gd=g(()=>{Qr()});function Fm(){return{type:"boolean"}}var yd=g(()=>{});function Il(n,e){return D(n.type._def,e)}var Ol=g(()=>{de()});var Um,bd=g(()=>{de();Um=(n,e)=>D(n.innerType._def,e)});function wd(n,e,t){let r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>wd(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return F0(n,e)}}var F0,_d=g(()=>{Qr();F0=(n,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let r of n.checks)switch(r.kind){case"min":Y(t,"minimum",r.value,r.message,e);break;case"max":Y(t,"maximum",r.value,r.message,e);break}return t}});function Bm(n,e){return{...D(n.innerType._def,e),default:n.defaultValue()}}var vd=g(()=>{de()});function zm(n,e){return e.effectStrategy==="input"?D(n.schema._def,e):ne(e)}var xd=g(()=>{de();Pt()});function qm(n){return{type:"string",enum:Array.from(n.values)}}var Ad=g(()=>{});function Hm(n,e){let t=[D(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(a=>{if(U0(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){let{additionalProperties:o,...l}=a;i=l}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}var U0,Ed=g(()=>{de();U0=n=>"type"in n&&n.type==="string"?!1:"allOf"in n});function Vm(n,e){let t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}var Id=g(()=>{});function Pl(n,e){let t={type:"string"};if(n.checks)for(let r of n.checks)switch(r.kind){case"min":Y(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":Y(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ut(t,"email",r.message,e);break;case"format:idn-email":Ut(t,"idn-email",r.message,e);break;case"pattern:zod":Ge(t,Ft.email,r.message,e);break}break;case"url":Ut(t,"uri",r.message,e);break;case"uuid":Ut(t,"uuid",r.message,e);break;case"regex":Ge(t,r.regex,r.message,e);break;case"cuid":Ge(t,Ft.cuid,r.message,e);break;case"cuid2":Ge(t,Ft.cuid2,r.message,e);break;case"startsWith":Ge(t,RegExp(`^${Pd(r.value,e)}`),r.message,e);break;case"endsWith":Ge(t,RegExp(`${Pd(r.value,e)}$`),r.message,e);break;case"datetime":Ut(t,"date-time",r.message,e);break;case"date":Ut(t,"date",r.message,e);break;case"time":Ut(t,"time",r.message,e);break;case"duration":Ut(t,"duration",r.message,e);break;case"length":Y(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),Y(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{Ge(t,RegExp(Pd(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Ut(t,"ipv4",r.message,e),r.version!=="v4"&&Ut(t,"ipv6",r.message,e);break}case"base64url":Ge(t,Ft.base64url,r.message,e);break;case"jwt":Ge(t,Ft.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&Ge(t,Ft.ipv4Cidr,r.message,e),r.version!=="v4"&&Ge(t,Ft.ipv6Cidr,r.message,e);break}case"emoji":Ge(t,Ft.emoji(),r.message,e);break;case"ulid":{Ge(t,Ft.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ut(t,"binary",r.message,e);break}case"contentEncoding:base64":{Y(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{Ge(t,Ft.base64,r.message,e);break}}break}case"nanoid":Ge(t,Ft.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function Pd(n,e){return e.patternStrategy==="escape"?z0(n):n}function z0(n){let e="";for(let t=0;t<n.length;t++)B0.has(n[t])||(e+="\\"),e+=n[t];return e}function Ut(n,e,t,r){n.format||n.anyOf?.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Y(n,"format",e,t,r)}function Ge(n,e,t,r){n.pattern||n.allOf?.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:Gm(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Y(n,"pattern",Gm(e,r),t,r)}function Gm(n,e){if(!e.applyRegexFlags||!n.flags)return n.source;let t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source,s="",a=!1,i=!1,o=!1;for(let l=0;l<r.length;l++){if(a){s+=r[l],a=!1;continue}if(t.i){if(i){if(r[l].match(/[a-z]/)){o?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&r[l+2]?.match(/[a-z]/)?(s+=r[l],o=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(t.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[l]==="."){s+=i?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?a=!0:i&&r[l]==="]"?i=!1:!i&&r[l]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}var Od,Ft,B0,Tl=g(()=>{Qr();Ft={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Od===void 0&&(Od=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Od),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};B0=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789")});function Sl(n,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&n.keyType?._def.typeName===v.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((r,s)=>({...r,[s]:D(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??ne(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:D(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(n.keyType?._def.typeName===v.ZodString&&n.keyType._def.checks?.length){let{type:r,...s}=Pl(n.keyType._def,e);return{...t,propertyNames:s}}else{if(n.keyType?._def.typeName===v.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(n.keyType?._def.typeName===v.ZodBranded&&n.keyType._def.type._def.typeName===v.ZodString&&n.keyType._def.type._def.checks?.length){let{type:r,...s}=Il(n.keyType._def,e);return{...t,propertyNames:s}}}return t}var Cl=g(()=>{es();de();Tl();Ol();Pt()});function Km(n,e){if(e.mapStrategy==="record")return Sl(n,e);let t=D(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||ne(e),r=D(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||ne(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}var Td=g(()=>{de();Cl();Pt()});function Wm(n){let e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}var Sd=g(()=>{});function Jm(n){return n.target==="openAi"?void 0:{not:ne({...n,currentPath:[...n.currentPath,"not"]})}}var Cd=g(()=>{Pt()});function Zm(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var kd=g(()=>{});function Xm(n,e){if(e.target==="openApi3")return Ym(n,e);let t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Yi&&(!r._def.checks||!r._def.checks.length))){let r=t.reduce((s,a)=>{let i=Yi[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=t.reduce((s,a)=>{let i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){let s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return Ym(n,e)}var Yi,Ym,kl=g(()=>{de();Yi={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};Ym=(n,e)=>{let t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>D(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0}});function Qm(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:Yi[n.innerType._def.typeName],nullable:!0}:{type:[Yi[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=D(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let t=D(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}var Rd=g(()=>{de();kl()});function eg(n,e){let t={type:"number"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"int":t.type="integer",ld(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Y(t,"minimum",r.value,r.message,e):Y(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Y(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Y(t,"maximum",r.value,r.message,e):Y(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Y(t,"maximum",r.value,r.message,e));break;case"multipleOf":Y(t,"multipleOf",r.value,r.message,e);break}return t}var Nd=g(()=>{Qr()});function tg(n,e){let t=e.target==="openAi",r={type:"object",properties:{}},s=[],a=n.shape();for(let o in a){let l=a[o];if(l===void 0||l._def===void 0)continue;let u=H0(l);u&&t&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);let c=D(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(r.properties[o]=c,u||s.push(o))}s.length&&(r.required=s);let i=q0(n,e);return i!==void 0&&(r.additionalProperties=i),r}function q0(n,e){if(n.catchall._def.typeName!=="ZodNever")return D(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function H0(n){try{return n.isOptional()}catch{return!0}}var $d=g(()=>{de()});var rg,Md=g(()=>{de();Pt();rg=(n,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return D(n.innerType._def,e);let t=D(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:ne(e)},t]}:ne(e)}});var ng,jd=g(()=>{de();ng=(n,e)=>{if(e.pipeStrategy==="input")return D(n.in._def,e);if(e.pipeStrategy==="output")return D(n.out._def,e);let t=D(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=D(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}}});function sg(n,e){return D(n.type._def,e)}var Ld=g(()=>{de()});function ag(n,e){let r={type:"array",uniqueItems:!0,items:D(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Y(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Y(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}var Dd=g(()=>{Qr();de()});function ig(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:D(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}var Fd=g(()=>{de()});function og(n){return{not:ne(n)}}var Ud=g(()=>{Pt()});function lg(n){return ne(n)}var Bd=g(()=>{Pt()});var ug,zd=g(()=>{de();ug=(n,e)=>D(n.innerType._def,e)});var cg,qd=g(()=>{es();Pt();md();gd();yd();Ol();bd();_d();vd();xd();Ad();Ed();Id();Td();Sd();Cd();kd();Rd();Nd();$d();Md();jd();Ld();Cl();Dd();Tl();Fd();Ud();kl();Bd();zd();cg=(n,e,t)=>{switch(e){case v.ZodString:return Pl(n,t);case v.ZodNumber:return eg(n,t);case v.ZodObject:return tg(n,t);case v.ZodBigInt:return Dm(n,t);case v.ZodBoolean:return Fm();case v.ZodDate:return wd(n,t);case v.ZodUndefined:return og(t);case v.ZodNull:return Zm(t);case v.ZodArray:return Lm(n,t);case v.ZodUnion:case v.ZodDiscriminatedUnion:return Xm(n,t);case v.ZodIntersection:return Hm(n,t);case v.ZodTuple:return ig(n,t);case v.ZodRecord:return Sl(n,t);case v.ZodLiteral:return Vm(n,t);case v.ZodEnum:return qm(n);case v.ZodNativeEnum:return Wm(n);case v.ZodNullable:return Qm(n,t);case v.ZodOptional:return rg(n,t);case v.ZodMap:return Km(n,t);case v.ZodSet:return ag(n,t);case v.ZodLazy:return()=>n.getter()._def;case v.ZodPromise:return sg(n,t);case v.ZodNaN:case v.ZodNever:return Jm(t);case v.ZodEffects:return zm(n,t);case v.ZodAny:return ne(t);case v.ZodUnknown:return lg(t);case v.ZodDefault:return Bm(n,t);case v.ZodBranded:return Il(n,t);case v.ZodReadonly:return ug(n,t);case v.ZodCatch:return Um(n,t);case v.ZodPipeline:return ng(n,t);case v.ZodFunction:case v.ZodVoid:case v.ZodSymbol:return;default:return(r=>{})(e)}}});function D(n,e,t=!1){let r=e.seen.get(n);if(e.override){let o=e.override?.(n,e,r,t);if(o!==_m)return o}if(r&&!t){let o=V0(r,e);if(o!==void 0)return o}let s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);let a=cg(n,n.typeName,e),i=typeof a=="function"?D(a(),e):a;if(i&&G0(n,e,i),e.postProcess){let o=e.postProcess(i,n,e);return s.jsonSchema=i,o}return s.jsonSchema=i,i}var V0,G0,de=g(()=>{ml();qd();yl();Pt();V0=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:gl(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),ne(e)):e.$refStrategy==="seen"?ne(e):void 0}},G0=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t)});var dg=g(()=>{});var Fe,Hd=g(()=>{de();od();Pt();Fe=(n,e)=>{let t=xm(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[u,c])=>({...l,[u]:D(c._def,{...t,currentPath:[...t.basePath,t.definitionPath,u]},!0)??ne(t)}),{}):void 0,s=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,a=D(n._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??ne(t),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(a.title=i),t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=s===void 0?r?{...a,[t.definitionPath]:r}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:a}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o}});var Pr=g(()=>{ml();od();Qr();yl();de();dg();Pt();md();gd();yd();Ol();bd();_d();vd();xd();Ad();Ed();Id();Td();Sd();Cd();kd();Rd();Nd();$d();Md();jd();Ld();zd();Cl();Dd();Tl();Fd();Ud();kl();Bd();qd();Hd();Hd()});function Vd(n,e=ca){n=n.trim();let t=/```(json)?(.*)```/s.exec(n);return e(t?t[2]:n)}function ca(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="",t=[],r=!1,s=!1;for(let a of n){if(r)a==='"'&&!s?r=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')r=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}r&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}var Gd=g(()=>{});var fg=C((E1,pg)=>{"use strict";pg.exports=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var _g=C((I1,Kd)=>{"use strict";var K0=/[\p{Lu}]/u,W0=/[\p{Ll}]/u,hg=/^[\p{Lu}](?![\p{Lu}])/gu,yg=/([\p{Alpha}\p{N}_]|$)/u,bg=/[_.\- ]+/,J0=new RegExp("^"+bg.source),mg=new RegExp(bg.source+yg.source,"gu"),gg=new RegExp("\\d+"+yg.source,"gu"),Z0=(n,e,t)=>{let r=!1,s=!1,a=!1;for(let i=0;i<n.length;i++){let o=n[i];r&&K0.test(o)?(n=n.slice(0,i)+"-"+n.slice(i),r=!1,a=s,s=!0,i++):s&&a&&W0.test(o)?(n=n.slice(0,i-1)+"-"+n.slice(i-1),a=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,a=s,s=t(o)===o&&e(o)!==o)}return n},Y0=(n,e)=>(hg.lastIndex=0,n.replace(hg,t=>e(t))),X0=(n,e)=>(mg.lastIndex=0,gg.lastIndex=0,n.replace(mg,(t,r)=>e(r)).replace(gg,t=>e(t))),wg=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(a=>a.trim()).filter(a=>a.length).join("-"):n=n.trim(),n.length===0)return"";let t=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),r=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=Z0(n,t,r)),n=n.replace(J0,""),e.preserveConsecutiveUppercase?n=Y0(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),X0(n,r))};Kd.exports=wg;Kd.exports.default=wg});function xg(n,e){return e?.[n]||(0,vg.default)(n)}function Ag(n,e,t){let r={};for(let s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}var vg,Q0,Eg=g(()=>{vg=At(fg(),1),Q0=At(_g(),1)});function Ig(n){return Array.isArray(n)?[...n]:{...n}}function eA(n,e){let t=Ig(n);for(let[r,s]of Object.entries(e)){let[a,...i]=r.split(".").reverse(),o=t;for(let l of i.reverse()){if(o[l]===void 0)break;o[l]=Ig(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function Wd(n){let e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}var mt,da=g(()=>{Eg();mt=class n{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Wd(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof n||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=r,[o,...l]=s.split(".").reverse();for(let u of l.reverse()){if(!(u in a)||a[u]===void 0)return;(!(u in i)||i[u]===void 0)&&(typeof a[u]=="object"&&a[u]!=null?i[u]={}:Array.isArray(a[u])&&(i[u]=[])),a=a[u],i=i[u]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Ag(Object.keys(t).length?eA(r,t):r,xg,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}});function Tt(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?Xi(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function Og(n,e){return n==="error"||e==="error"?"error":"success"}function tA(n,e){function t(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(i=>t(i,s+1));let a={};for(let i of Object.keys(r))a[i]=t(r[i],s+1);return a}return JSON.stringify(t(n,0),null,2)}function ce(n,e){let t={...n};for(let[r,s]of Object.entries(e))if(t[r]==null)t[r]=s;else{if(s==null)continue;if(typeof t[r]!=typeof s||Array.isArray(t[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=s}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=ce(t[r],s);else if(Array.isArray(t[r]))t[r]=Xi(t[r],s);else{if(t[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function Xi(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{let t=[...n];for(let r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){let s=t.findIndex(a=>a.index===r.index);s!==-1?t[s]=ce(t[s],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function Pg(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return Xi(n,e);if(typeof n=="object"&&typeof e=="object")return ce(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}function Tg(n){return typeof n.role=="string"}function st(n){return typeof n?._getType=="function"}function Sg(n){return st(n)&&typeof n.concat=="function"}var ye,nt,Bt=g(()=>{da();ye=class extends mt{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=tA(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};nt=class extends ye{}});function Cg(n){let e=[],t=[];for(let r of n)if(r.function){let s=r.function.name;try{let a=JSON.parse(r.function.arguments),i={name:s||"",args:a||{},id:r.id};e.push(i)}catch{t.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}var Tr,pa,fa=g(()=>{Bt();Tr=class extends ye{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},pa=class n extends nt{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new n({content:Tt(this.content,e.content),additional_kwargs:ce(this.additional_kwargs,e.additional_kwargs),response_metadata:ce(this.response_metadata,e.response_metadata),artifact:Pg(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Og(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}});function ts(n){return n._getType()==="ai"}var se,le,rs=g(()=>{Gd();Bt();fa();se=class extends ye{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let s=r.additional_kwargs?.tool_calls,a=r.tool_calls;s!=null&&s.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(s!=null&&a===void 0){let[i,o]=Cg(s);r.tool_calls=i??[],r.invalid_tool_calls=o??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}};le=class n extends nt{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{let r=[],s=[];for(let a of e.tool_call_chunks){let i={};try{if(i=ca(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:s}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:Tt(this.content,e.content),additional_kwargs:ce(this.additional_kwargs,e.additional_kwargs),response_metadata:ce(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let r=Xi(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:r.input_tokens+s.input_tokens,output_tokens:r.output_tokens+s.output_tokens,total_tokens:r.total_tokens+s.total_tokens};t.usage_metadata=a}return new n(t)}}});var Ce,Sr,Rl=g(()=>{Bt();Ce=class n extends ye{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return n}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},Sr=class n extends nt{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new n({content:Tt(this.content,e.content),additional_kwargs:ce(this.additional_kwargs,e.additional_kwargs),response_metadata:ce(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}});var ns,Nl=g(()=>{Bt();ns=class n extends nt{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new n({content:Tt(this.content,e.content),additional_kwargs:ce(this.additional_kwargs,e.additional_kwargs),response_metadata:ce(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}});var be,Cr,Qi=g(()=>{Bt();be=class extends ye{static lc_name(){return"HumanMessage"}_getType(){return"human"}},Cr=class n extends nt{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new n({content:Tt(this.content,e.content),additional_kwargs:ce(this.additional_kwargs,e.additional_kwargs),response_metadata:ce(this.response_metadata,e.response_metadata),id:this.id??e.id})}}});var ss,kr,$l=g(()=>{Bt();ss=class extends ye{static lc_name(){return"SystemMessage"}_getType(){return"system"}},kr=class n extends nt{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new n({content:Tt(this.content,e.content),additional_kwargs:ce(this.additional_kwargs,e.additional_kwargs),response_metadata:ce(this.response_metadata,e.response_metadata),id:this.id??e.id})}}});function ma(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}var ha,Ml=g(()=>{ha=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}});function nA(n){return ma(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function Jd(n){let{type:e,...t}=n;if(e==="human"||e==="user")return new be(t);if(e==="ai"||e==="assistant"){let{tool_calls:r,...s}=t;if(!Array.isArray(r))return new se(t);let a=r.map(nA);return new se({...s,tool_calls:a})}else{if(e==="system")return new ss(t);if(e==="tool"&&"tool_call_id"in t)return new Tr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}}function zt(n){if(typeof n=="string")return new be(n);if(st(n))return n;if(Array.isArray(n)){let[e,t]=n;return Jd({type:e,content:t})}else if(Tg(n)){let{role:e,...t}=n;return Jd({...t,type:e})}else return Jd(n)}function eo(n,e="Human",t="AI"){let r=[];for(let s of n){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${a}: ${i}${o}`)}return r.join(`
`)}function Zd(n){let e=n._getType();if(e==="human")return new Cr({...n});if(e==="ai"){let t={...n};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(r=>({...r,type:"tool_call_chunk",index:void 0,args:JSON.stringify(r.args)}))}),new le({...t})}else{if(e==="system")return new kr({...n});if(e==="function")return new ns({...n});if(Ce.isInstance(n))return new Sr({...n});throw new Error("Unknown message type.")}}var sn=g(()=>{Ml();rs();Bt();Rl();Nl();Qi();$l();fa()});var Rg=C((tM,kg)=>{function St(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}kg.exports=St;St.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};St.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};St.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};St.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};St.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};St.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};St.prototype.start=St.prototype.try;St.prototype.errors=function(){return this._errors};St.prototype.attempts=function(){return this._attempts};St.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],a=s.message,i=(n[a]||0)+1;n[a]=i,i>=t&&(e=s,t=i)}return e}});var Ng=C(as=>{var sA=Rg();as.operation=function(n){var e=as.timeouts(n);return new sA(e,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})};as.timeouts=function(n){if(n instanceof Array)return[].concat(n);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in n)e[t]=n[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],s=0;s<e.retries;s++)r.push(this.createTimeout(s,e));return n&&n.forever&&!r.length&&r.push(this.createTimeout(s,e)),r.sort(function(a,i){return a-i}),r};as.createTimeout=function(n,e){var t=e.randomize?Math.random()+1:1,r=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,n));return r=Math.min(r,e.maxTimeout),r};as.wrap=function(n,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var r in n)typeof n[r]=="function"&&t.push(r)}for(var s=0;s<t.length;s++){var a=t[s],i=n[a];n[a]=function(l){var u=as.operation(e),c=Array.prototype.slice.call(arguments,1),d=c.pop();c.push(function(p){u.retry(p)||(p&&(arguments[0]=u.mainError()),d.apply(this,arguments))}),u.attempt(function(){l.apply(n,c)})}.bind(n,i),n[a].options=e}}});var Mg=C((nM,$g)=>{$g.exports=Ng()});var Dl=C((sM,Ll)=>{"use strict";var aA=Mg(),iA=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],jl=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},oA=(n,e,t)=>{let r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},lA=n=>iA.includes(n),jg=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};let s=aA.operation(e);s.attempt(async a=>{try{t(await n(a))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof jl)s.stop(),r(i.originalError);else if(i instanceof TypeError&&!lA(i.message))s.stop(),r(i);else{oA(i,a,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}s.retry(i)||r(s.mainError())}}})});Ll.exports=jg;Ll.exports.default=jg;Ll.exports.AbortError=jl});var Lg,Dg=g(()=>{Lg=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function uA(n){return typeof n=="string"&&Lg.test(n)}var to,Fg=g(()=>{Dg();to=uA});function Ug(n,e=0){return(ke[n[e+0]]+ke[n[e+1]]+ke[n[e+2]]+ke[n[e+3]]+"-"+ke[n[e+4]]+ke[n[e+5]]+"-"+ke[n[e+6]]+ke[n[e+7]]+"-"+ke[n[e+8]]+ke[n[e+9]]+"-"+ke[n[e+10]]+ke[n[e+11]]+ke[n[e+12]]+ke[n[e+13]]+ke[n[e+14]]+ke[n[e+15]]).toLowerCase()}var ke,Fl,Bg=g(()=>{ke=[];for(Fl=0;Fl<256;++Fl)ke.push((Fl+256).toString(16).slice(1))});function Yd(){if(!Ul&&(Ul=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ul))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ul(cA)}var Ul,cA,zg=g(()=>{cA=new Uint8Array(16)});var dA,Xd,qg=g(()=>{dA=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Xd={randomUUID:dA}});function pA(n,e,t){if(Xd.randomUUID&&!e&&!n)return Xd.randomUUID();n=n||{};var r=n.random||(n.rng||Yd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return Ug(r)}var at,Hg=g(()=>{qg();zg();Bg();at=pA});var ro=g(()=>{Hg();Fg()});var Vg,Gg=g(()=>{Vg=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function hA(n){return typeof n=="string"&&Vg.test(n)}var Qd,Kg=g(()=>{Gg();Qd=hA});function Wg(n,e=0){return(Re[n[e+0]]+Re[n[e+1]]+Re[n[e+2]]+Re[n[e+3]]+"-"+Re[n[e+4]]+Re[n[e+5]]+"-"+Re[n[e+6]]+Re[n[e+7]]+"-"+Re[n[e+8]]+Re[n[e+9]]+"-"+Re[n[e+10]]+Re[n[e+11]]+Re[n[e+12]]+Re[n[e+13]]+Re[n[e+14]]+Re[n[e+15]]).toLowerCase()}var Re,Bl,Jg=g(()=>{Re=[];for(Bl=0;Bl<256;++Bl)Re.push((Bl+256).toString(16).slice(1))});function ep(){if(!zl&&(zl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!zl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zl(mA)}var zl,mA,Zg=g(()=>{mA=new Uint8Array(16)});var gA,tp,Yg=g(()=>{gA=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),tp={randomUUID:gA}});function yA(n,e,t){if(tp.randomUUID&&!e&&!n)return tp.randomUUID();n=n||{};var r=n.random||(n.rng||ep)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return Wg(r)}var is,Xg=g(()=>{Yg();Zg();Jg();is=yA});var ql=g(()=>{Xg();Kg()});var ey=C((SM,np)=>{"use strict";var bA=Object.prototype.hasOwnProperty,Ke="~";function no(){}Object.create&&(no.prototype=Object.create(null),new no().__proto__||(Ke=!1));function wA(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Qg(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var a=new wA(t,r||n,s),i=Ke?Ke+e:e;return n._events[i]?n._events[i].fn?n._events[i]=[n._events[i],a]:n._events[i].push(a):(n._events[i]=a,n._eventsCount++),n}function Hl(n,e){--n._eventsCount===0?n._events=new no:delete n._events[e]}function Ue(){this._events=new no,this._eventsCount=0}Ue.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)bA.call(t,r)&&e.push(Ke?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ue.prototype.listeners=function(e){var t=Ke?Ke+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,a=r.length,i=new Array(a);s<a;s++)i[s]=r[s].fn;return i};Ue.prototype.listenerCount=function(e){var t=Ke?Ke+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Ue.prototype.emit=function(e,t,r,s,a,i){var o=Ke?Ke+e:e;if(!this._events[o])return!1;var l=this._events[o],u=arguments.length,c,d;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,s),!0;case 5:return l.fn.call(l.context,t,r,s,a),!0;case 6:return l.fn.call(l.context,t,r,s,a,i),!0}for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];l.fn.apply(l.context,c)}else{var p=l.length,f;for(d=0;d<p;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),u){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,r);break;case 4:l[d].fn.call(l[d].context,t,r,s);break;default:if(!c)for(f=1,c=new Array(u-1);f<u;f++)c[f-1]=arguments[f];l[d].fn.apply(l[d].context,c)}}return!0};Ue.prototype.on=function(e,t,r){return Qg(this,e,t,r,!1)};Ue.prototype.once=function(e,t,r){return Qg(this,e,t,r,!0)};Ue.prototype.removeListener=function(e,t,r,s){var a=Ke?Ke+e:e;if(!this._events[a])return this;if(!t)return Hl(this,a),this;var i=this._events[a];if(i.fn)i.fn===t&&(!s||i.once)&&(!r||i.context===r)&&Hl(this,a);else{for(var o=0,l=[],u=i.length;o<u;o++)(i[o].fn!==t||s&&!i[o].once||r&&i[o].context!==r)&&l.push(i[o]);l.length?this._events[a]=l.length===1?l[0]:l:Hl(this,a)}return this};Ue.prototype.removeAllListeners=function(e){var t;return e?(t=Ke?Ke+e:e,this._events[t]&&Hl(this,t)):(this._events=new no,this._eventsCount=0),this};Ue.prototype.off=Ue.prototype.removeListener;Ue.prototype.addListener=Ue.prototype.on;Ue.prefixed=Ke;Ue.EventEmitter=Ue;typeof np<"u"&&(np.exports=Ue)});var ry=C((CM,ty)=>{"use strict";ty.exports=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))});var sy=C((kM,Gl)=>{"use strict";var _A=ry(),Vl=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},ny=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}let a=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(l){s(l)}return}let i=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Vl(i);typeof n.cancel=="function"&&n.cancel(),s(o)},e);_A(n.then(r,s),()=>{clearTimeout(a)})});Gl.exports=ny;Gl.exports.default=ny;Gl.exports.TimeoutError=Vl});var ay=C(sp=>{"use strict";Object.defineProperty(sp,"__esModule",{value:!0});function vA(n,e,t){let r=0,s=n.length;for(;s>0;){let a=s/2|0,i=r+a;t(n[i],e)<=0?(r=++i,s-=a+1):s=a}return r}sp.default=vA});var iy=C(ip=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});var xA=ay(),ap=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let s=xA.default(this._queue,r,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,r)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};ip.default=ap});var Wl=C(lp=>{"use strict";Object.defineProperty(lp,"__esModule",{value:!0});var AA=ey(),oy=sy(),EA=iy(),Kl=()=>{},IA=new oy.TimeoutError,op=class extends AA{constructor(e){var t,r,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Kl,this._resolveIdle=Kl,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:EA.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Kl,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Kl,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{let a=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&t.timeout===void 0?e():oy.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(IA)});r(await i)}catch(i){s(i)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};lp.default=op});var OA,PA,j,Jl=g(()=>{OA=(...n)=>fetch(...n),PA=Symbol.for("ls:fetch_implementation"),j=()=>globalThis[PA]??OA});var ly,Zl,TA,SA,so,uy=g(()=>{ly=At(Dl(),1),Zl=At(Wl(),1);Jl();TA=[400,401,403,404,405,406,407,408],SA=[409],so=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Zl.default?this.queue=new Zl.default.default({concurrency:this.maxConcurrency}):this.queue=new Zl.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,ly.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;let a=s?.response,i=a?.status;if(i){if(TA.includes(+i))throw s;if(SA.includes(+i))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>j()(...e).then(t=>t.ok?t:Promise.reject(t)))}}});function up(n){return typeof n?._getType=="function"}function cp(n){let e={type:n._getType(),data:{content:n.content}};return n?.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var cy=g(()=>{});function J(n,e){if(!Qd(n)){let t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}var dy=g(()=>{ql()});function Yl(n){py[n]||(console.warn(n),py[n]=!0)}var py,dp=g(()=>{py={}});var ao=C((BM,fy)=>{"use strict";var CA="2.0.0",kA=Number.MAX_SAFE_INTEGER||9007199254740991,RA=16,NA=250,$A=["major","premajor","minor","preminor","patch","prepatch","prerelease"];fy.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:RA,MAX_SAFE_BUILD_LENGTH:NA,MAX_SAFE_INTEGER:kA,RELEASE_TYPES:$A,SEMVER_SPEC_VERSION:CA,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var io=C((zM,hy)=>{"use strict";var MA=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};hy.exports=MA});var ga=C((rr,my)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:pp,MAX_SAFE_BUILD_LENGTH:jA,MAX_LENGTH:LA}=ao(),DA=io();rr=my.exports={};var FA=rr.re=[],UA=rr.safeRe=[],O=rr.src=[],BA=rr.safeSrc=[],P=rr.t={},zA=0,fp="[a-zA-Z0-9-]",qA=[["\\s",1],["\\d",LA],[fp,jA]],HA=n=>{for(let[e,t]of qA)n=n.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return n},z=(n,e,t)=>{let r=HA(e),s=zA++;DA(n,s,e),P[n]=s,O[s]=e,BA[s]=r,FA[s]=new RegExp(e,t?"g":void 0),UA[s]=new RegExp(r,t?"g":void 0)};z("NUMERICIDENTIFIER","0|[1-9]\\d*");z("NUMERICIDENTIFIERLOOSE","\\d+");z("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${fp}*`);z("MAINVERSION",`(${O[P.NUMERICIDENTIFIER]})\\.(${O[P.NUMERICIDENTIFIER]})\\.(${O[P.NUMERICIDENTIFIER]})`);z("MAINVERSIONLOOSE",`(${O[P.NUMERICIDENTIFIERLOOSE]})\\.(${O[P.NUMERICIDENTIFIERLOOSE]})\\.(${O[P.NUMERICIDENTIFIERLOOSE]})`);z("PRERELEASEIDENTIFIER",`(?:${O[P.NONNUMERICIDENTIFIER]}|${O[P.NUMERICIDENTIFIER]})`);z("PRERELEASEIDENTIFIERLOOSE",`(?:${O[P.NONNUMERICIDENTIFIER]}|${O[P.NUMERICIDENTIFIERLOOSE]})`);z("PRERELEASE",`(?:-(${O[P.PRERELEASEIDENTIFIER]}(?:\\.${O[P.PRERELEASEIDENTIFIER]})*))`);z("PRERELEASELOOSE",`(?:-?(${O[P.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${O[P.PRERELEASEIDENTIFIERLOOSE]})*))`);z("BUILDIDENTIFIER",`${fp}+`);z("BUILD",`(?:\\+(${O[P.BUILDIDENTIFIER]}(?:\\.${O[P.BUILDIDENTIFIER]})*))`);z("FULLPLAIN",`v?${O[P.MAINVERSION]}${O[P.PRERELEASE]}?${O[P.BUILD]}?`);z("FULL",`^${O[P.FULLPLAIN]}$`);z("LOOSEPLAIN",`[v=\\s]*${O[P.MAINVERSIONLOOSE]}${O[P.PRERELEASELOOSE]}?${O[P.BUILD]}?`);z("LOOSE",`^${O[P.LOOSEPLAIN]}$`);z("GTLT","((?:<|>)?=?)");z("XRANGEIDENTIFIERLOOSE",`${O[P.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);z("XRANGEIDENTIFIER",`${O[P.NUMERICIDENTIFIER]}|x|X|\\*`);z("XRANGEPLAIN",`[v=\\s]*(${O[P.XRANGEIDENTIFIER]})(?:\\.(${O[P.XRANGEIDENTIFIER]})(?:\\.(${O[P.XRANGEIDENTIFIER]})(?:${O[P.PRERELEASE]})?${O[P.BUILD]}?)?)?`);z("XRANGEPLAINLOOSE",`[v=\\s]*(${O[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[P.XRANGEIDENTIFIERLOOSE]})(?:${O[P.PRERELEASELOOSE]})?${O[P.BUILD]}?)?)?`);z("XRANGE",`^${O[P.GTLT]}\\s*${O[P.XRANGEPLAIN]}$`);z("XRANGELOOSE",`^${O[P.GTLT]}\\s*${O[P.XRANGEPLAINLOOSE]}$`);z("COERCEPLAIN",`(^|[^\\d])(\\d{1,${pp}})(?:\\.(\\d{1,${pp}}))?(?:\\.(\\d{1,${pp}}))?`);z("COERCE",`${O[P.COERCEPLAIN]}(?:$|[^\\d])`);z("COERCEFULL",O[P.COERCEPLAIN]+`(?:${O[P.PRERELEASE]})?(?:${O[P.BUILD]})?(?:$|[^\\d])`);z("COERCERTL",O[P.COERCE],!0);z("COERCERTLFULL",O[P.COERCEFULL],!0);z("LONETILDE","(?:~>?)");z("TILDETRIM",`(\\s*)${O[P.LONETILDE]}\\s+`,!0);rr.tildeTrimReplace="$1~";z("TILDE",`^${O[P.LONETILDE]}${O[P.XRANGEPLAIN]}$`);z("TILDELOOSE",`^${O[P.LONETILDE]}${O[P.XRANGEPLAINLOOSE]}$`);z("LONECARET","(?:\\^)");z("CARETTRIM",`(\\s*)${O[P.LONECARET]}\\s+`,!0);rr.caretTrimReplace="$1^";z("CARET",`^${O[P.LONECARET]}${O[P.XRANGEPLAIN]}$`);z("CARETLOOSE",`^${O[P.LONECARET]}${O[P.XRANGEPLAINLOOSE]}$`);z("COMPARATORLOOSE",`^${O[P.GTLT]}\\s*(${O[P.LOOSEPLAIN]})$|^$`);z("COMPARATOR",`^${O[P.GTLT]}\\s*(${O[P.FULLPLAIN]})$|^$`);z("COMPARATORTRIM",`(\\s*)${O[P.GTLT]}\\s*(${O[P.LOOSEPLAIN]}|${O[P.XRANGEPLAIN]})`,!0);rr.comparatorTrimReplace="$1$2$3";z("HYPHENRANGE",`^\\s*(${O[P.XRANGEPLAIN]})\\s+-\\s+(${O[P.XRANGEPLAIN]})\\s*$`);z("HYPHENRANGELOOSE",`^\\s*(${O[P.XRANGEPLAINLOOSE]})\\s+-\\s+(${O[P.XRANGEPLAINLOOSE]})\\s*$`);z("STAR","(<|>)?=?\\s*\\*");z("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");z("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Xl=C((qM,gy)=>{"use strict";var VA=Object.freeze({loose:!0}),GA=Object.freeze({}),KA=n=>n?typeof n!="object"?VA:n:GA;gy.exports=KA});var hp=C((HM,wy)=>{"use strict";var yy=/^[0-9]+$/,by=(n,e)=>{let t=yy.test(n),r=yy.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},WA=(n,e)=>by(e,n);wy.exports={compareIdentifiers:by,rcompareIdentifiers:WA}});var Be=C((VM,vy)=>{"use strict";var Ql=io(),{MAX_LENGTH:_y,MAX_SAFE_INTEGER:eu}=ao(),{safeRe:tu,t:ru}=ga(),JA=Xl(),{compareIdentifiers:ya}=hp(),mp=class n{constructor(e,t){if(t=JA(t),e instanceof n){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>_y)throw new TypeError(`version is longer than ${_y} characters`);Ql("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?tu[ru.LOOSE]:tu[ru.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>eu||this.major<0)throw new TypeError("Invalid major version");if(this.minor>eu||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>eu||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let a=+s;if(a>=0&&a<eu)return a}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Ql("SemVer.compare",this.version,this.options,e),!(e instanceof n)){if(typeof e=="string"&&e===this.version)return 0;e=new n(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof n||(e=new n(e,this.options)),ya(this.major,e.major)||ya(this.minor,e.minor)||ya(this.patch,e.patch)}comparePre(e){if(e instanceof n||(e=new n(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],s=e.prerelease[t];if(Ql("prerelease compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return ya(r,s)}while(++t)}compareBuild(e){e instanceof n||(e=new n(e,this.options));let t=0;do{let r=this.build[t],s=e.build[t];if(Ql("build compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return ya(r,s)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?tu[ru.PRERELEASELOOSE]:tu[ru.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let a=[t,s];r===!1&&(a=[t]),ya(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};vy.exports=mp});var os=C((GM,Ay)=>{"use strict";var xy=Be(),ZA=(n,e,t=!1)=>{if(n instanceof xy)return n;try{return new xy(n,e)}catch(r){if(!t)return null;throw r}};Ay.exports=ZA});var Iy=C((KM,Ey)=>{"use strict";var YA=os(),XA=(n,e)=>{let t=YA(n,e);return t?t.version:null};Ey.exports=XA});var Py=C((WM,Oy)=>{"use strict";var QA=os(),eE=(n,e)=>{let t=QA(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Oy.exports=eE});var Cy=C((JM,Sy)=>{"use strict";var Ty=Be(),tE=(n,e,t,r,s)=>{typeof t=="string"&&(s=r,r=t,t=void 0);try{return new Ty(n instanceof Ty?n.version:n,t).inc(e,r,s).version}catch{return null}};Sy.exports=tE});var Ny=C((ZM,Ry)=>{"use strict";var ky=os(),rE=(n,e)=>{let t=ky(n,null,!0),r=ky(e,null,!0),s=t.compare(r);if(s===0)return null;let a=s>0,i=a?t:r,o=a?r:t,l=!!i.prerelease.length;if(!!o.prerelease.length&&!l){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}let c=l?"pre":"";return t.major!==r.major?c+"major":t.minor!==r.minor?c+"minor":t.patch!==r.patch?c+"patch":"prerelease"};Ry.exports=rE});var My=C((YM,$y)=>{"use strict";var nE=Be(),sE=(n,e)=>new nE(n,e).major;$y.exports=sE});var Ly=C((XM,jy)=>{"use strict";var aE=Be(),iE=(n,e)=>new aE(n,e).minor;jy.exports=iE});var Fy=C((QM,Dy)=>{"use strict";var oE=Be(),lE=(n,e)=>new oE(n,e).patch;Dy.exports=lE});var By=C((ej,Uy)=>{"use strict";var uE=os(),cE=(n,e)=>{let t=uE(n,e);return t&&t.prerelease.length?t.prerelease:null};Uy.exports=cE});var Ct=C((tj,qy)=>{"use strict";var zy=Be(),dE=(n,e,t)=>new zy(n,t).compare(new zy(e,t));qy.exports=dE});var Vy=C((rj,Hy)=>{"use strict";var pE=Ct(),fE=(n,e,t)=>pE(e,n,t);Hy.exports=fE});var Ky=C((nj,Gy)=>{"use strict";var hE=Ct(),mE=(n,e)=>hE(n,e,!0);Gy.exports=mE});var nu=C((sj,Jy)=>{"use strict";var Wy=Be(),gE=(n,e,t)=>{let r=new Wy(n,t),s=new Wy(e,t);return r.compare(s)||r.compareBuild(s)};Jy.exports=gE});var Yy=C((aj,Zy)=>{"use strict";var yE=nu(),bE=(n,e)=>n.sort((t,r)=>yE(t,r,e));Zy.exports=bE});var Qy=C((ij,Xy)=>{"use strict";var wE=nu(),_E=(n,e)=>n.sort((t,r)=>wE(r,t,e));Xy.exports=_E});var oo=C((oj,eb)=>{"use strict";var vE=Ct(),xE=(n,e,t)=>vE(n,e,t)>0;eb.exports=xE});var su=C((lj,tb)=>{"use strict";var AE=Ct(),EE=(n,e,t)=>AE(n,e,t)<0;tb.exports=EE});var gp=C((uj,rb)=>{"use strict";var IE=Ct(),OE=(n,e,t)=>IE(n,e,t)===0;rb.exports=OE});var yp=C((cj,nb)=>{"use strict";var PE=Ct(),TE=(n,e,t)=>PE(n,e,t)!==0;nb.exports=TE});var au=C((dj,sb)=>{"use strict";var SE=Ct(),CE=(n,e,t)=>SE(n,e,t)>=0;sb.exports=CE});var iu=C((pj,ab)=>{"use strict";var kE=Ct(),RE=(n,e,t)=>kE(n,e,t)<=0;ab.exports=RE});var bp=C((fj,ib)=>{"use strict";var NE=gp(),$E=yp(),ME=oo(),jE=au(),LE=su(),DE=iu(),FE=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return NE(n,t,r);case"!=":return $E(n,t,r);case">":return ME(n,t,r);case">=":return jE(n,t,r);case"<":return LE(n,t,r);case"<=":return DE(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};ib.exports=FE});var lb=C((hj,ob)=>{"use strict";var UE=Be(),BE=os(),{safeRe:ou,t:lu}=ga(),zE=(n,e)=>{if(n instanceof UE)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?ou[lu.COERCEFULL]:ou[lu.COERCE]);else{let l=e.includePrerelease?ou[lu.COERCERTLFULL]:ou[lu.COERCERTL],u;for(;(u=l.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||u.index+u[0].length!==t.index+t[0].length)&&(t=u),l.lastIndex=u.index+u[1].length+u[2].length;l.lastIndex=-1}if(t===null)return null;let r=t[2],s=t[3]||"0",a=t[4]||"0",i=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return BE(`${r}.${s}.${a}${i}${o}`,e)};ob.exports=zE});var cb=C((mj,ub)=>{"use strict";var wp=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};ub.exports=wp});var kt=C((gj,hb)=>{"use strict";var qE=/\s+/g,_p=class n{constructor(e,t){if(t=VE(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof vp)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(qE," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(s=>!pb(s[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&XE(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let r=0;r<t.length;r++)r>0&&(this.formatted+=" "),this.formatted+=t[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&ZE)|(this.options.loose&&YE))+":"+e,s=db.get(r);if(s)return s;let a=this.options.loose,i=a?it[We.HYPHENRANGELOOSE]:it[We.HYPHENRANGE];e=e.replace(i,lI(this.options.includePrerelease)),te("hyphen replace",e),e=e.replace(it[We.COMPARATORTRIM],KE),te("comparator trim",e),e=e.replace(it[We.TILDETRIM],WE),te("tilde trim",e),e=e.replace(it[We.CARETTRIM],JE),te("caret trim",e);let o=e.split(" ").map(d=>QE(d,this.options)).join(" ").split(/\s+/).map(d=>oI(d,this.options));a&&(o=o.filter(d=>(te("loose invalid filter",d,this.options),!!d.match(it[We.COMPARATORLOOSE])))),te("range list",o);let l=new Map,u=o.map(d=>new vp(d,this.options));for(let d of u){if(pb(d))return[d];l.set(d.value,d)}l.size>1&&l.has("")&&l.delete("");let c=[...l.values()];return db.set(r,c),c}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>fb(r,t)&&e.set.some(s=>fb(s,t)&&r.every(a=>s.every(i=>a.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new GE(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(uI(this.set[t],e,this.options))return!0;return!1}};hb.exports=_p;var HE=cb(),db=new HE,VE=Xl(),vp=lo(),te=io(),GE=Be(),{safeRe:it,t:We,comparatorTrimReplace:KE,tildeTrimReplace:WE,caretTrimReplace:JE}=ga(),{FLAG_INCLUDE_PRERELEASE:ZE,FLAG_LOOSE:YE}=ao(),pb=n=>n.value==="<0.0.0-0",XE=n=>n.value==="",fb=(n,e)=>{let t=!0,r=n.slice(),s=r.pop();for(;t&&r.length;)t=r.every(a=>s.intersects(a,e)),s=r.pop();return t},QE=(n,e)=>(te("comp",n,e),n=rI(n,e),te("caret",n),n=eI(n,e),te("tildes",n),n=sI(n,e),te("xrange",n),n=iI(n,e),te("stars",n),n),Je=n=>!n||n.toLowerCase()==="x"||n==="*",eI=(n,e)=>n.trim().split(/\s+/).map(t=>tI(t,e)).join(" "),tI=(n,e)=>{let t=e.loose?it[We.TILDELOOSE]:it[We.TILDE];return n.replace(t,(r,s,a,i,o)=>{te("tilde",n,r,s,a,i,o);let l;return Je(s)?l="":Je(a)?l=`>=${s}.0.0 <${+s+1}.0.0-0`:Je(i)?l=`>=${s}.${a}.0 <${s}.${+a+1}.0-0`:o?(te("replaceTilde pr",o),l=`>=${s}.${a}.${i}-${o} <${s}.${+a+1}.0-0`):l=`>=${s}.${a}.${i} <${s}.${+a+1}.0-0`,te("tilde return",l),l})},rI=(n,e)=>n.trim().split(/\s+/).map(t=>nI(t,e)).join(" "),nI=(n,e)=>{te("caret",n,e);let t=e.loose?it[We.CARETLOOSE]:it[We.CARET],r=e.includePrerelease?"-0":"";return n.replace(t,(s,a,i,o,l)=>{te("caret",n,s,a,i,o,l);let u;return Je(a)?u="":Je(i)?u=`>=${a}.0.0${r} <${+a+1}.0.0-0`:Je(o)?a==="0"?u=`>=${a}.${i}.0${r} <${a}.${+i+1}.0-0`:u=`>=${a}.${i}.0${r} <${+a+1}.0.0-0`:l?(te("replaceCaret pr",l),a==="0"?i==="0"?u=`>=${a}.${i}.${o}-${l} <${a}.${i}.${+o+1}-0`:u=`>=${a}.${i}.${o}-${l} <${a}.${+i+1}.0-0`:u=`>=${a}.${i}.${o}-${l} <${+a+1}.0.0-0`):(te("no pr"),a==="0"?i==="0"?u=`>=${a}.${i}.${o}${r} <${a}.${i}.${+o+1}-0`:u=`>=${a}.${i}.${o}${r} <${a}.${+i+1}.0-0`:u=`>=${a}.${i}.${o} <${+a+1}.0.0-0`),te("caret return",u),u})},sI=(n,e)=>(te("replaceXRanges",n,e),n.split(/\s+/).map(t=>aI(t,e)).join(" ")),aI=(n,e)=>{n=n.trim();let t=e.loose?it[We.XRANGELOOSE]:it[We.XRANGE];return n.replace(t,(r,s,a,i,o,l)=>{te("xRange",n,r,s,a,i,o,l);let u=Je(a),c=u||Je(i),d=c||Je(o),p=d;return s==="="&&p&&(s=""),l=e.includePrerelease?"-0":"",u?s===">"||s==="<"?r="<0.0.0-0":r="*":s&&p?(c&&(i=0),o=0,s===">"?(s=">=",c?(a=+a+1,i=0,o=0):(i=+i+1,o=0)):s==="<="&&(s="<",c?a=+a+1:i=+i+1),s==="<"&&(l="-0"),r=`${s+a}.${i}.${o}${l}`):c?r=`>=${a}.0.0${l} <${+a+1}.0.0-0`:d&&(r=`>=${a}.${i}.0${l} <${a}.${+i+1}.0-0`),te("xRange return",r),r})},iI=(n,e)=>(te("replaceStars",n,e),n.trim().replace(it[We.STAR],"")),oI=(n,e)=>(te("replaceGTE0",n,e),n.trim().replace(it[e.includePrerelease?We.GTE0PRE:We.GTE0],"")),lI=n=>(e,t,r,s,a,i,o,l,u,c,d,p)=>(Je(r)?t="":Je(s)?t=`>=${r}.0.0${n?"-0":""}`:Je(a)?t=`>=${r}.${s}.0${n?"-0":""}`:i?t=`>=${t}`:t=`>=${t}${n?"-0":""}`,Je(u)?l="":Je(c)?l=`<${+u+1}.0.0-0`:Je(d)?l=`<${u}.${+c+1}.0-0`:p?l=`<=${u}.${c}.${d}-${p}`:n?l=`<${u}.${c}.${+d+1}-0`:l=`<=${l}`,`${t} ${l}`.trim()),uI=(n,e,t)=>{for(let r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let r=0;r<n.length;r++)if(te(n[r].semver),n[r].semver!==vp.ANY&&n[r].semver.prerelease.length>0){let s=n[r].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var lo=C((yj,_b)=>{"use strict";var uo=Symbol("SemVer ANY"),Ep=class n{static get ANY(){return uo}constructor(e,t){if(t=mb(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Ap("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===uo?this.value="":this.value=this.operator+this.semver.version,Ap("comp",this)}parse(e){let t=this.options.loose?gb[yb.COMPARATORLOOSE]:gb[yb.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new bb(r[2],this.options.loose):this.semver=uo}toString(){return this.value}test(e){if(Ap("Comparator.test",e,this.options.loose),this.semver===uo||e===uo)return!0;if(typeof e=="string")try{e=new bb(e,this.options)}catch{return!1}return xp(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new wb(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new wb(this.value,t).test(e.semver):(t=mb(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||xp(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||xp(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};_b.exports=Ep;var mb=Xl(),{safeRe:gb,t:yb}=ga(),xp=bp(),Ap=io(),bb=Be(),wb=kt()});var co=C((bj,vb)=>{"use strict";var cI=kt(),dI=(n,e,t)=>{try{e=new cI(e,t)}catch{return!1}return e.test(n)};vb.exports=dI});var Ab=C((wj,xb)=>{"use strict";var pI=kt(),fI=(n,e)=>new pI(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));xb.exports=fI});var Ib=C((_j,Eb)=>{"use strict";var hI=Be(),mI=kt(),gI=(n,e,t)=>{let r=null,s=null,a=null;try{a=new mI(e,t)}catch{return null}return n.forEach(i=>{a.test(i)&&(!r||s.compare(i)===-1)&&(r=i,s=new hI(r,t))}),r};Eb.exports=gI});var Pb=C((vj,Ob)=>{"use strict";var yI=Be(),bI=kt(),wI=(n,e,t)=>{let r=null,s=null,a=null;try{a=new bI(e,t)}catch{return null}return n.forEach(i=>{a.test(i)&&(!r||s.compare(i)===1)&&(r=i,s=new yI(r,t))}),r};Ob.exports=wI});var Cb=C((xj,Sb)=>{"use strict";var Ip=Be(),_I=kt(),Tb=oo(),vI=(n,e)=>{n=new _I(n,e);let t=new Ip("0.0.0");if(n.test(t)||(t=new Ip("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){let s=n.set[r],a=null;s.forEach(i=>{let o=new Ip(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||Tb(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),a&&(!t||Tb(t,a))&&(t=a)}return t&&n.test(t)?t:null};Sb.exports=vI});var Rb=C((Aj,kb)=>{"use strict";var xI=kt(),AI=(n,e)=>{try{return new xI(n,e).range||"*"}catch{return null}};kb.exports=AI});var uu=C((Ej,jb)=>{"use strict";var EI=Be(),Mb=lo(),{ANY:II}=Mb,OI=kt(),PI=co(),Nb=oo(),$b=su(),TI=iu(),SI=au(),CI=(n,e,t,r)=>{n=new EI(n,r),e=new OI(e,r);let s,a,i,o,l;switch(t){case">":s=Nb,a=TI,i=$b,o=">",l=">=";break;case"<":s=$b,a=SI,i=Nb,o="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(PI(n,e,r))return!1;for(let u=0;u<e.set.length;++u){let c=e.set[u],d=null,p=null;if(c.forEach(f=>{f.semver===II&&(f=new Mb(">=0.0.0")),d=d||f,p=p||f,s(f.semver,d.semver,r)?d=f:i(f.semver,p.semver,r)&&(p=f)}),d.operator===o||d.operator===l||(!p.operator||p.operator===o)&&a(n,p.semver))return!1;if(p.operator===l&&i(n,p.semver))return!1}return!0};jb.exports=CI});var Db=C((Ij,Lb)=>{"use strict";var kI=uu(),RI=(n,e,t)=>kI(n,e,">",t);Lb.exports=RI});var Ub=C((Oj,Fb)=>{"use strict";var NI=uu(),$I=(n,e,t)=>NI(n,e,"<",t);Fb.exports=$I});var qb=C((Pj,zb)=>{"use strict";var Bb=kt(),MI=(n,e,t)=>(n=new Bb(n,t),e=new Bb(e,t),n.intersects(e,t));zb.exports=MI});var Vb=C((Tj,Hb)=>{"use strict";var jI=co(),LI=Ct();Hb.exports=(n,e,t)=>{let r=[],s=null,a=null,i=n.sort((c,d)=>LI(c,d,t));for(let c of i)jI(c,e,t)?(a=c,s||(s=c)):(a&&r.push([s,a]),a=null,s=null);s&&r.push([s,null]);let o=[];for(let[c,d]of r)c===d?o.push(c):!d&&c===i[0]?o.push("*"):d?c===i[0]?o.push(`<=${d}`):o.push(`${c} - ${d}`):o.push(`>=${c}`);let l=o.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return l.length<u.length?l:e}});var Yb=C((Sj,Zb)=>{"use strict";var Gb=kt(),Pp=lo(),{ANY:Op}=Pp,po=co(),Tp=Ct(),DI=(n,e,t={})=>{if(n===e)return!0;n=new Gb(n,t),e=new Gb(e,t);let r=!1;e:for(let s of n.set){for(let a of e.set){let i=UI(s,a,t);if(r=r||i!==null,i)continue e}if(r)return!1}return!0},FI=[new Pp(">=0.0.0-0")],Kb=[new Pp(">=0.0.0")],UI=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===Op){if(e.length===1&&e[0].semver===Op)return!0;t.includePrerelease?n=FI:n=Kb}if(e.length===1&&e[0].semver===Op){if(t.includePrerelease)return!0;e=Kb}let r=new Set,s,a;for(let f of n)f.operator===">"||f.operator===">="?s=Wb(s,f,t):f.operator==="<"||f.operator==="<="?a=Jb(a,f,t):r.add(f.semver);if(r.size>1)return null;let i;if(s&&a){if(i=Tp(s.semver,a.semver,t),i>0)return null;if(i===0&&(s.operator!==">="||a.operator!=="<="))return null}for(let f of r){if(s&&!po(f,String(s),t)||a&&!po(f,String(a),t))return null;for(let h of e)if(!po(f,String(h),t))return!1;return!0}let o,l,u,c,d=a&&!t.includePrerelease&&a.semver.prerelease.length?a.semver:!1,p=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let f of e){if(c=c||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",s){if(p&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===p.major&&f.semver.minor===p.minor&&f.semver.patch===p.patch&&(p=!1),f.operator===">"||f.operator===">="){if(o=Wb(s,f,t),o===f&&o!==s)return!1}else if(s.operator===">="&&!po(s.semver,String(f),t))return!1}if(a){if(d&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===d.major&&f.semver.minor===d.minor&&f.semver.patch===d.patch&&(d=!1),f.operator==="<"||f.operator==="<="){if(l=Jb(a,f,t),l===f&&l!==a)return!1}else if(a.operator==="<="&&!po(a.semver,String(f),t))return!1}if(!f.operator&&(a||s)&&i!==0)return!1}return!(s&&u&&!a&&i!==0||a&&c&&!s&&i!==0||p||d)},Wb=(n,e,t)=>{if(!n)return e;let r=Tp(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},Jb=(n,e,t)=>{if(!n)return e;let r=Tp(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};Zb.exports=DI});var tw=C((Cj,ew)=>{"use strict";var Sp=ga(),Xb=ao(),BI=Be(),Qb=hp(),zI=os(),qI=Iy(),HI=Py(),VI=Cy(),GI=Ny(),KI=My(),WI=Ly(),JI=Fy(),ZI=By(),YI=Ct(),XI=Vy(),QI=Ky(),eO=nu(),tO=Yy(),rO=Qy(),nO=oo(),sO=su(),aO=gp(),iO=yp(),oO=au(),lO=iu(),uO=bp(),cO=lb(),dO=lo(),pO=kt(),fO=co(),hO=Ab(),mO=Ib(),gO=Pb(),yO=Cb(),bO=Rb(),wO=uu(),_O=Db(),vO=Ub(),xO=qb(),AO=Vb(),EO=Yb();ew.exports={parse:zI,valid:qI,clean:HI,inc:VI,diff:GI,major:KI,minor:WI,patch:JI,prerelease:ZI,compare:YI,rcompare:XI,compareLoose:QI,compareBuild:eO,sort:tO,rsort:rO,gt:nO,lt:sO,eq:aO,neq:iO,gte:oO,lte:lO,cmp:uO,coerce:cO,Comparator:dO,Range:pO,satisfies:fO,toComparators:hO,maxSatisfying:mO,minSatisfying:gO,minVersion:yO,validRange:bO,outside:wO,gtr:_O,ltr:vO,intersects:xO,simplifyRange:AO,subset:EO,SemVer:BI,re:Sp.re,src:Sp.src,tokens:Sp.t,SEMVER_SPEC_VERSION:Xb.SEMVER_SPEC_VERSION,RELEASE_TYPES:Xb.RELEASE_TYPES,compareIdentifiers:Qb.compareIdentifiers,rcompareIdentifiers:Qb.rcompareIdentifiers}});function rw(n,e){let t=(0,Cp.parse)(n),r=(0,Cp.parse)(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function Rr(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);let[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){let[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${n}`);return[s,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}var Cp,nw=g(()=>{Cp=At(tw(),1)});async function G(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();let s=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new kp(s):new Error(s)}var kp,sw=g(()=>{kp=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}});function OO(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function ls(n,e,t,r){try{return JSON.stringify(n,e,t)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=OO()),Np(n,"",0,[],void 0,0,r);var s;try{ba.length===0?s=JSON.stringify(n,e,t):s=JSON.stringify(n,PO(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;cu.length!==0;){var a=cu.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return s}}function Rp(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),cu.push([r,t,e,s])):ba.push([e,t,n]):(r[t]=n,cu.push([r,t,e]))}function Np(n,e,t,r,s,a,i){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){Rp(IO,n,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Rp(aw,n,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){Rp(aw,n,e,s);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)Np(n[o],o,o,r,n,a,i);else{var l=Object.keys(n);for(o=0;o<l.length;o++){var u=l[o];Np(n[u],u,o,r,n,a,i)}}r.pop()}}function PO(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(ba.length>0)for(var r=0;r<ba.length;r++){var s=ba[r];if(s[1]===e&&s[0]===t){t=s[2],ba.splice(r,1);break}}return n.call(this,e,t)}}var aw,IO,cu,ba,iw=g(()=>{aw="[...]",IO={result:"[Circular]"},cu=[],ba=[]});function ow(n){let e=fu(),t=lw(),r=n.extra??{},s=r.metadata;return n.extra={...r,runtime:{...e,...r?.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...s}},n}async function CO(n){let e=[];for await(let t of n)e.push(t);return e}function $p(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var TO,SO,kO,Mp,RO,NO,us,jp=g(()=>{ql();uy();cy();hu();pu();dy();dp();nw();sw();Jl();iw();TO=()=>{let n=Nr("TRACING_SAMPLING_RATE");if(n===void 0)return;let e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},SO=n=>{let t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};kO=async n=>{if(n?.status===429){let e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1},Mp=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,r=new Promise(a=>{t=a}),s=ls(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let s=this.items.shift();s&&(t.push(s),r+=s.size,this.sizeBytes-=s.size)}if(t.length===0&&this.items.length>0){let s=this.items.shift();t.push(s),r+=s.size,this.sizeBytes-=s.size}return[t.map(s=>({action:s.action,item:s.payload})),()=>t.forEach(s=>s.itemPromiseResolve())]}},RO=20971520,NO=1e3,us=class n{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Mp}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=n.getDefaultClientConfig();this.tracingSampleRate=TO(),this.apiUrl=$p(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=$p(e.apiKey??t.apiKey),this.webUrl=$p(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new so(e.callerOptions??{}),this.batchIngestCaller=new so({...e.callerOptions??{},onFailedResponseHook:kO}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=Nr("API_KEY"),t=Nr("ENDPOINT")??"https://api.smith.langchain.com",r=Nr("HIDE_INPUTS")==="true",s=Nr("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:SO(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${du}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(j(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));let i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(j(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(o,`Failed to fetch ${e}`);let l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){let a=t?{...t}:{};for(;;){let o=await(await this.caller.call(j(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];let l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let r=[];for(let s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{let r=[];for(let s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??RO}async drainAutoBatchQueue(){for(;this.autoBatchQueue.items.length>=0;){let[e,t]=this.autoBatchQueue.pop(await this._getBatchSizeLimitBytes());if(!e.length){t();return}try{let r={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)};(await this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(r):await this.batchIngestRuns(r)}finally{t()}}}async processRunOperation(e,t){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=ow(e.item));let s=this.autoBatchQueue.push(e),a=await this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>a)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){let e=await j()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(NO),...this.fetchOptions});return await G(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}let a=ow(s),i=await this.caller.call(j(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:ls(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=e?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[],s=t?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[];if(r.length>0&&s.length>0){let l=r.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),u=[];for(let c of s)c.id!==void 0&&l[c.id]?l[c.id]={...l[c.id],...c}:u.push(c);r=Object.values(l),s=u}let a={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!a.post.length&&!a.patch.length)return;if((await this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(let l of a.post)await this.createRun(l);for(let l of a.patch)l.id!==void 0&&await this.updateRun(l.id,l);return}let o={post:[],patch:[]};for(let l of["post","patch"]){let u=l,c=a[u].reverse(),d=c.pop();for(;d!==void 0;)o[u].push(d),d=c.pop()}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(ls(o))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(j(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r={},s=[];for(let c of e??[]){let d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(let c of t??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(s.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){let c=s.reduce((p,f)=>(f.id&&(p[f.id]=f),p),{}),d=[];for(let p of a)p.id!==void 0&&c[p.id]?c[p.id]={...c[p.id],...p}:d.push(p);s=Object.values(c),a=d}if(s.length===0&&a.length===0)return;let l=[],u=[];for(let[c,d]of[["post",s],["patch",a]])for(let p of d){let{inputs:f,outputs:h,events:m,...y}=p,x={inputs:f,outputs:h,events:m},w=ls(y);u.push({name:`${c}.${y.id}`,payload:new Blob([w],{type:`application/json; length=${w.length}`})});for(let[A,M]of Object.entries(x)){if(M===void 0)continue;let N=ls(M);u.push({name:`${c}.${y.id}.${A}`,payload:new Blob([N],{type:`application/json; length=${N.length}`})})}if(y.id!==void 0){let A=r[y.id];if(A){delete r[y.id];for(let[M,[N,R]]of Object.entries(A))u.push({name:`attachment.${y.id}.${M}`,payload:new Blob([R],{type:`${N}; length=${R.length}`})})}}l.push(`trace=${y.trace_id},id=${y.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,t){try{let r=new FormData;for(let s of e)r.append(s.name,s.payload);await this.batchIngestCaller.call(j(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers},body:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})}catch(r){let s="Failed to multipart ingest runs";r instanceof Error?s+=`: ${r.stack||r.message}`:s+=`: ${String(r)}`,console.warn(`${s.trim()}

Context: ${t}`)}}async updateRun(e,t){J(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}let s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(j(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:ls(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){J(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r?.projectName?s=(await this.readProject({projectName:r?.projectName})).id:r?.projectId?s=r?.projectId:s=(await this.readProject({projectName:Nr("PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await CO(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort((a,i)=>(a?.dotted_order??"").localeCompare(i?.dotted_order??""));for(let a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=r[e.id]||[];for(let a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){let{projectId:t,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:p,query:f,filter:h,traceFilter:m,treeFilter:y,limit:x,select:w}=e,A=[];if(t&&(A=Array.isArray(t)?t:[t]),r){let U=Array.isArray(r)?r:[r],T=await Promise.all(U.map(re=>this.readProject({projectName:re}).then(oe=>oe.id)));A.push(...T)}let M=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],N={session:A.length?A:null,run_type:c,reference_example:i,query:f,filter:h,trace_filter:m,tree_filter:y,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:p,limit:x,trace:a,select:w||M,is_root:u},R=0;for await(let U of this._getCursorPaginatedList("/runs/query",N))if(x){if(R>=x)break;if(U.length+R>x){yield*U.slice(0,x-R);break}R+=U.length,yield*U}else yield*U}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:p,traceFilter:f,treeFilter:h,isRoot:m,dataSourceType:y}){let x=i||[];a&&(x=[...i||[],...await Promise.all(a.map(R=>this.readProject({projectName:R}).then(U=>U.id)))]);let A=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:x,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:p,trace_filter:f,tree_filter:h,is_root:m,data_source_type:y}).filter(([R,U])=>U!==void 0));return await(await this.caller.call(j(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(A),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||is()};J(e);let a=await(await this.caller.call(j(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){J(e);let t=await this.caller.call(j(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(t,"unshare run",!0)}async readRunSharedLink(e){J(e);let r=await(await this.caller.call(j(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(t!==void 0)for(let i of t)r.append("id",i);return J(e),await(await this.caller.call(j(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),J(e);let s=await(await this.caller.call(j(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};J(e);let a=await(await this.caller.call(j(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){J(e);let t=await this.caller.call(j(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(t,"unshare dataset",!0)}async readSharedDataset(e){return J(e),await(await this.caller.call(j(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let s=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>s.append(o,u)):s.append(o,l)});let a=await this.caller.call(j(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){let o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=a||{};r&&(u.metadata=r);let c={name:e,extra:u,description:t};i!==null&&(c.reference_dataset_id=i);let d=await this.caller.call(j(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){let o=`${this.apiUrl}/sessions/${e}`,l=a;s&&(l={...l||{},metadata:s});let u={name:t,extra:l,description:r,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(j(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)J(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let a=await this.caller.call(j(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions",a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)J(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());let i=await this._get(s,a),o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){let l=new URLSearchParams;if(e!==void 0)for(let u of e)l.append("id",u);if(t!==void 0&&l.append("name",t),r!==void 0&&l.append("name_contains",r),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){let u=await this.readDataset({datasetName:a});l.append("reference_dataset",u.id)}i!==void 0&&l.append("reference_free",i.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(let u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,J(r);let s=await this.caller.call(j(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(s,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){let l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(p=>{u.append("input_keys",p)}),s.forEach(p=>{u.append("output_keys",p)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o);let c=await this.caller.call(j(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){let o={name:e,description:t,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);let l=await this.caller.call(j(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets",s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)J(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let a=await this._get(r,s),i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);let i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){let o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(let u of r)l.append("id",u);s!==void 0&&l.append("name",s),a!==void 0&&l.append("name_contains",a),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(let u of this._getPaginated(o,l))yield*u}async updateDataset(e){let{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;J(a);let i=await this.caller.call(j(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(i,"update dataset"),await i.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)J(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");let a=await this.caller.call(j(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),J(s);let a={tag:r},i=await this.caller.call(j(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(i,"index dataset"),await i.json()}async similarExamples(e,t,r,{filter:s}={}){let a={limit:r,inputs:e};s!==void 0&&(a.filter=s),J(t);let i=await this.caller.call(j(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:a,exampleId:i,metadata:o,split:l,sourceRunId:u}){let c=r;if(c===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:s})).id);let p={dataset_id:c,inputs:e,outputs:t,created_at:(a||new Date)?.toISOString(),id:i,metadata:o,split:l,source_run_id:u},f=await this.caller.call(j(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(p),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(f,"create example"),await f.json()}async createExamples(e){let{inputs:t,outputs:r,metadata:s,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:l}=e,u=o;if(u===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:l})).id);let c=t.map((f,h)=>({dataset_id:u,inputs:f,outputs:r?r[h]:void 0,metadata:s?s[h]:void 0,split:e.splits?e.splits[h]:void 0,id:i?i[h]:void 0,source_run_id:a?a[h]:void 0})),d=await this.caller.call(j(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let s=e.map(i=>up(i)?cp(i):i),a=up(t)?cp(t):t;return this.createExample({input:s},{output:a},r)}async readExample(e){J(e);let t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:l,offset:u,filter:c}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:d}),f=s?typeof s=="string"?s:s?.toISOString():void 0;f&&p.append("as_of",f);let h=i??!0;if(p.append("inline_s3_urls",h.toString()),r!==void 0)for(let y of r)p.append("id",y);if(a!==void 0)for(let y of a)p.append("splits",y);if(o!==void 0){let y=JSON.stringify(o);p.append("metadata",y)}l!==void 0&&p.append("limit",l.toString()),u!==void 0&&p.append("offset",u.toString()),c!==void 0&&p.append("filter",c);let m=0;for await(let y of this._getPaginated("/examples",p)){for(let x of y)yield x,m++;if(l!==void 0&&m>=l)break}}async deleteExample(e){J(e);let t=`/examples/${e}`,r=await this.caller.call(j(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(r,`delete ${t}`),await r.json()}async updateExample(e,t){J(e);let r=await this.caller.call(j(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(r,"update example"),await r.json()}async updateExamples(e){let t=await this.caller.call(j(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,J(s);let a=new URLSearchParams,i=r?typeof r=="string"?r:r?.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,J(i);let o={split_name:r,examples:s.map(u=>(J(u),u)),remove:a},l=await this.caller.call(j(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){Yl("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));let o=await t.evaluateRun(i,a),[l,u]=await this._logEvaluationFeedback(o,i,r);return u[0]}async createFeedback(e,t,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:p,comparativeExperimentId:f}){if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");let h={type:l??"api",metadata:o??{}};u!==void 0&&h?.metadata!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:u}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&J(h.metadata.__run.run_id);let m={id:c??is(),run_id:e,key:t,score:r,value:s,correction:a,comment:i,feedback_source:h,comparative_experiment_id:f,feedbackConfig:d,session_id:p},y=`${this.apiUrl}/feedback`,x=await this.caller.call(j(),y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(x,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:s,comment:a}){let i={};t!=null&&(i.score=t),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),J(e);let o=await this.caller.call(j(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(o,"update feedback",!0)}async readFeedback(e){J(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){J(e);let t=`/feedback/${e}`,r=await this.caller.call(j(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(let a of t)s.append("key",a);if(r)for(let a of r)s.append("source",a);for await(let a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){let a={run_id:e,feedback_key:t,feedback_config:s};return r?typeof r=="string"?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(j(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");let l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(s??new Date)?.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(j(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){J(e);let t=new URLSearchParams({run_id:e});for await(let r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){let s=this._selectEvalResults(e),a=[];for(let i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let l=null;i.targetRunId?l=i.targetRunId:t&&(l=t.id),a.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,r){let[s]=await this._logEvaluationFeedback(e,t,r);return s}async*listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((l,u)=>{J(l,`queueIds[${u}]`),i.append("ids",l)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(let l of this._getPaginated("/annotation-queues",i))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:s}=e,a={name:t,description:r,id:s||is()},i=await this.caller.call(j(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){let t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){let{name:r,description:s}=t,a=await this.caller.call(j(),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(a,"update annotation queue")}async deleteAnnotationQueue(e){let t=await this.caller.call(j(),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){let r=await this.caller.call(j(),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,a)=>J(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${J(e,"queueId")}/run`,s=await this.caller.call(j(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(s,"get run from annotation queue"),await s.json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(j(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){let s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,s,a]=Rr(e),i=await this.caller.call(j(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){let[t,r,s]=Rr(e);if(await this._currentTenantIsOwner(t)){let a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(let r of this._getPaginated("/repos",t,s=>s.repos))yield*r}async getPrompt(e){let[t,r,s]=Rr(e),a=await this.caller.call(j(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await G(a,"get prompt");let i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[s,a,i]=Rr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);let o={repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},l=await this.caller.call(j(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(l,"create prompt");let{repo:u}=await l.json();return u}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[s,a,i]=Rr(e),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?await this._getLatestCommitHash(`${s}/${a}`):r?.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(j(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(u,"create commit");let c=await u.json();return this._getPromptUrl(`${s}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[r,s]=Rr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");let i=await this.caller.call(j(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await G(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[t,r,s]=Rr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(j(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){let[r,s,a]=Rr(e),i=await this._getServerInfo(),o=rw(i.version,"0.5.23"),l=a;if(!o&&a==="latest"){let d=await this._getLatestCommitHash(`${r}/${s}`);if(d)l=d;else throw new Error("No commits found")}let u=await this.caller.call(j(),`${this.apiUrl}/commits/${r}/${s}/${l}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await G(u,"pull prompt commit");let c=await u.json();return{owner:r,repo:s,commit_hash:c.commit_hash,manifest:c.manifest,examples:c.examples}}async _pullPrompt(e,t){let r=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,r),o=new n({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(i),u=s||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}let c=await o.listSharedExamples(i),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(p=>p.inputs),outputs:c.flatMap(p=>p.outputs?[p.outputs]:[]),datasetId:d.id})}catch(p){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),p}}parseTokenOrUrl(e,t,r=2,s="dataset"){try{return J(e),[t,e]}catch{}try{let i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){let o=i[i.length-r];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}}});var du,pu=g(()=>{jp();mu();Jl();du="0.1.68"});function fu(){if(Lp===void 0){let n=DO(),e=UO();Lp={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:du,...e}}return Lp}function lw(){let n=FO()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[r,s]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function FO(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function on(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}function Nr(n){return on(`LANGSMITH_${n}`)||on(`LANGCHAIN_${n}`)}function UO(){if(Dp!==void 0)return Dp;let n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of n){let r=on(t);r!==void 0&&(e[t]=r)}return Dp=e,e}var $r,$O,MO,jO,uw,LO,DO,Lp,Dp,hu=g(()=>{pu();$O=()=>typeof window<"u"&&typeof window.document<"u",MO=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",jO=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),uw=()=>typeof Deno<"u",LO=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!uw(),DO=()=>$r||($O()?$r="browser":LO()?$r="node":MO()?$r="webworker":jO()?$r="jsdom":uw()?$r="deno":$r="other",$r)});var cw,dw=g(()=>{hu();cw=n=>n!==void 0?n:!!["TRACING_V2","TRACING"].find(t=>Nr(t)==="true")});var gu,pw=g(()=>{gu=Symbol.for("lc:context_variables")});function BO(n){return n.replace(/[-:.]/g,"")}function zO(n,e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return BO(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Fp(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function hw(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function fw(n){return Array.isArray(n)&&n.some(e=>hw(e))}function qO(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function HO(n){return n!==void 0&&typeof n.callbacks=="object"&&(fw(n.callbacks?.handlers)||fw(n.callbacks))}var yu,an,mu=g(()=>{ql();hu();jp();dw();dp();pw();yu=class n{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),r={},s=[];for(let a of t){let[i,o]=a.split("="),l=decodeURIComponent(o);i==="langsmith-metadata"?r=JSON.parse(l):i==="langsmith-tags"&&(s=l.split(","))}return new n(r,s)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},an=class n{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Fp(e)){Object.assign(this,{...e});return}let t=n.getDefaultConfig(),{metadata:r,...s}=e,a=s.client??n.getSharedClient(),i={...r,...s?.extra?.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let o=zO(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o}}static getDefaultConfig(){return{id:is(),run_type:"chain",project_name:on("LANGCHAIN_PROJECT")??on("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:on("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:on("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return n.sharedClient||(n.sharedClient=new us),n.sharedClient}createChild(e){let t=this.child_execution_order+1,r=new n({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});gu in this&&(r[gu]=this[gu]);let s=Symbol.for("lc:child_config"),a=e.extra?.[s]??this.extra[s];if(HO(a)){let l={...a},u=qO(l.callbacks)?l.callbacks.copy?.():void 0;u&&(Object.assign(u,{_parentRunId:r.id}),u.handlers?.find(hw)?.updateFromRunTree?.(r),l.callbacks=u),r.extra[s]=l}let i=new Set,o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,r=!0){let s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(let[l,u]of Object.entries(t))s.runtime[l]||(s.runtime[l]=u);let a,i;return r?(i=e.parent_run?.id,a=[]):(a=e.child_runs.map(l=>this._convertToCreate(l,t,r)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){try{let t=fu(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){Yl("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let r=e?.callbacks,s,a,i,o=cw();if(r){let u=r?.getParentRunId?.()??"",c=r?.handlers?.find(d=>d?.name=="langchain_tracer");s=c?.getRun?.(u),a=c?.projectName,i=c?.client,o=o||!!c}return s?new n({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set((s?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...s?.extra?.metadata,...e?.metadata}}}).createChild(t):new n({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;let a=s.trim(),i=a.split(".").map(u=>{let[c,d]=u.split("Z");return{strTime:c,time:Date.parse(c+"Z"),uuid:d}}),o=i[0].uuid,l={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){let u=yu.fromHeader(r.baggage);l.metadata=u.metadata,l.tags=u.tags}return new n(l)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new yu(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[r,s]of Object.entries(t))e.set(r,s);return t}};Object.defineProperty(an,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})});function bu(n){return typeof n=="function"&&"langsmith:traceable"in n}var Bp,Up,VO,zp,GO,mw,lL,gw=g(()=>{mu();Bp=class{getStore(){}run(e,t){return t()}},Up=Symbol.for("ls:tracing_async_local_storage"),VO=new Bp,zp=class{getInstance(){return globalThis[Up]??VO}initializeGlobalInstance(e){globalThis[Up]===void 0&&(globalThis[Up]=e)}},GO=new zp,mw=()=>{let n=GO.getInstance().getStore();if(!Fp(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n},lL=Symbol.for("langsmith:traceable:root")});var qp=g(()=>{gw()});function _u(n,e){return KO.call(n,e)}function vu(n){if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)_u(n,t)&&e.push(t);return e}function ze(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function xu(n){let e=0,t=n.length,r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function nr(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function fo(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function wu(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(wu(n[t]))return!0}else if(typeof n=="object"){let t=vu(n),r=t.length;for(var e=0;e<r;e++)if(wu(n[t[e]]))return!0}}return!1}function yw(n,e){let t=[n];for(let r in e){let s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&t.push(`${r}: ${s}`)}return t.join(`
`)}var KO,cs,ho=g(()=>{KO=Object.prototype.hasOwnProperty;cs=class extends Error{constructor(e,t,r,s,a){super(yw(e,{name:t,index:r,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=yw(e,{name:t,index:r,operation:s,tree:a})}}});var Hp={};Gi(Hp,{JsonPatchError:()=>ue,_areEquals:()=>mo,applyOperation:()=>ds,applyPatch:()=>ln,applyReducer:()=>ZO,deepClone:()=>WO,getValueByPointer:()=>Au,validate:()=>bw,validator:()=>Eu});function Au(n,e){if(e=="")return n;var t={op:"_get",path:e};return ds(n,t),t.value}function ds(n,e,t=!1,r=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):Eu(e,0)),e.path===""){let i={newDocument:n};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=n,i;if(e.op==="move"||e.op==="copy")return i.newDocument=Au(n,e.from),e.op==="move"&&(i.removed=n),i;if(e.op==="test"){if(i.test=mo(n,e.value),i.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return i.newDocument=n,i}else{if(e.op==="remove")return i.removed=n,i.newDocument=null,i;if(e.op==="_get")return e.value=n,i;if(t)throw new ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return i}}else{r||(n=ze(n));let o=(e.path||"").split("/"),l=n,u=1,c=o.length,d,p,f;for(typeof t=="function"?f=t:f=Eu;;){if(p=o[u],p&&p.indexOf("~")!=-1&&(p=fo(p)),s&&(p=="__proto__"||p=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[p]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&f(e,0,n,d)),u++,Array.isArray(l)){if(p==="-")p=l.length;else{if(t&&!xu(p))throw new ue("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);xu(p)&&(p=~~p)}if(u>=c){if(t&&e.op==="add"&&p>l.length)throw new ue("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);let h=JO[e.op].call(e,l,p,n);if(h.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return h}}else if(u>=c){let h=wa[e.op].call(e,l,p,n);if(h.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return h}if(l=l[p],t&&u<c&&(!l||typeof l!="object"))throw new ue("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function ln(n,e,t,r=!0,s=!0){if(t&&!Array.isArray(e))throw new ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=ze(n));let a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=ds(n,e[i],t,!0,s,i),n=a[i].newDocument;return a.newDocument=n,a}function ZO(n,e,t){let r=ds(n,e);if(r.test===!1)throw new ue("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function Eu(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new ue("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(wa[n.op]){if(typeof n.path!="string")throw new ue("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new ue('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new ue("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&wu(n.value))throw new ue("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var s=n.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new ue("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new ue("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var i={op:"_get",path:n.from,value:void 0},o=bw([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ue("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new ue("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function bw(n,e,t){try{if(!Array.isArray(n))throw new ue("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)ln(ze(e),ze(n),t||!0);else{t=t||Eu;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(s){if(s instanceof ue)return s;throw s}}function mo(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),s,a,i;if(t&&r){if(a=n.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!mo(n[s],e[s]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!mo(n[i],e[i]))return!1;return!0}return n!==n&&e!==e}var ue,WO,wa,JO,Iu=g(()=>{ho();ue=cs,WO=ze,wa={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Au(t,this.path);r&&(r=ze(r));let s=ds(t,{op:"remove",path:this.from}).removed;return ds(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(n,e,t){let r=Au(t,this.from);return ds(t,{op:"add",path:this.path,value:ze(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:mo(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},JO={add:function(n,e,t){return xu(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:wa.move,copy:wa.copy,test:wa.test,_get:wa._get}});function ww(n,e,t,r,s){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=vu(e),i=vu(n),o=!1,l=!1,u=i.length-1;u>=0;u--){var c=i[u],d=n[c];if(_u(e,c)&&!(e[c]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var p=e[c];typeof d=="object"&&d!=null&&typeof p=="object"&&p!=null&&Array.isArray(d)===Array.isArray(p)?ww(d,p,t,r+"/"+nr(c),s):d!==p&&(o=!0,s&&t.push({op:"test",path:r+"/"+nr(c),value:ze(d)}),t.push({op:"replace",path:r+"/"+nr(c),value:ze(p)}))}else Array.isArray(n)===Array.isArray(e)?(s&&t.push({op:"test",path:r+"/"+nr(c),value:ze(d)}),t.push({op:"remove",path:r+"/"+nr(c)}),l=!0):(s&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}),o=!0)}if(!(!l&&a.length==i.length))for(var u=0;u<a.length;u++){var c=a[u];!_u(n,c)&&e[c]!==void 0&&t.push({op:"add",path:r+"/"+nr(c),value:ze(e[c])})}}}function Ou(n,e,t=!1){var r=[];return ww(n,e,r,"",t),r}var _w=g(()=>{ho();Iu();});var bL,Vp=g(()=>{Iu();_w();ho();Iu();ho();bL={...Hp,JsonPatchError:cs,deepClone:ze,escapePathComponent:nr,unescapePathComponent:fo}});async function xw(){return Gp===void 0&&(Gp={library:"langchain-js",runtime:tP()}),Gp}function Q(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}var YO,XO,QO,vw,eP,tP,Gp,_a=g(()=>{YO=()=>typeof window<"u"&&typeof window.document<"u",XO=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",QO=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),vw=()=>typeof Deno<"u",eP=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!vw(),tP=()=>{let n;return YO()?n="browser":eP()?n="node":XO()?n="webworker":QO()?n="jsdom":vw()?n="deno":n="other",n}});var Kp,ps,Wp=g(()=>{ro();da();_a();Kp=class{},ps=class n extends Kp{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Wd(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Q("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return mt.prototype.toJSON.call(this)}toJSONNotImplemented(){return mt.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends n{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:at()}),Object.assign(this,e)}}return new t}}});function Jp(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function rP(n){return n.replace(/[-:.]/g,"")}function nP(n,e,t){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return rP(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function va(n){return typeof n._addRunToRunMap=="function"}var Rt,fs=g(()=>{Wp();Rt=class extends ps{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=nP(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){let s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,s,a,i,o,l){let u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,p={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(p)}async handleLLMStart(e,t,r,s,a,i,o,l){let u=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,s,a,i,o,l);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}_createRunForChatModelStart(e,t,r,s,a,i,o,l){let u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,p={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(p)}async handleChatModelStart(e,t,r,s,a,i,o,l){let u=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,s,a,i,o,l);return await this.onRunCreate?.(u),await this.onLLMStart?.(u),u}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}_createRunForChainStart(e,t,r,s,a,i,o,l){let u=this._getExecutionOrder(s),c=Date.now(),d={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,r,s,a,i,o,l){let u=this.runMap.get(r)??this._createRunForChainStart(e,t,r,s,a,i,o,l);return await this.onRunCreate?.(u),await this.onChainStart?.(u),u}async handleChainEnd(e,t,r,s,a){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=Jp(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=Jp(a.inputs,"input")),await this.onChainEnd?.(i),await this._endTrace(i),i}async handleChainError(e,t,r,s,a){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=Jp(a.inputs,"input")),await this.onChainError?.(i),await this._endTrace(i),i}_createRunForToolStart(e,t,r,s,a,i,o){let l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,r,s,a,i,o){let l=this.runMap.get(r)??this._createRunForToolStart(e,t,r,s,a,i,o);return await this.onRunCreate?.(l),await this.onToolStart?.(l),l}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")return;let s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r)}async handleAgentEnd(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,s,a,i,o){let l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,r,s,a,i,o){let l=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,s,a,i,o);return await this.onRunCreate?.(l),await this.onRetrieverStart?.(l),l}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,s,a,i){let o=this.runMap.get(r);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(o,e,{chunk:i?.chunk}),o}}});var Zp=g(()=>{pu()});var Ow=C((kL,Iw)=>{"use strict";var Aw=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,Ew=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`;function sP(){let n=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,r]of Object.entries(e)){for(let[s,a]of Object.entries(r))e[s]={open:`\x1B[${a[0]}m`,close:`\x1B[${a[1]}m`},r[s]=e[s],n.set(a[0],a[1]);Object.defineProperty(e,t,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:n,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=Aw(),e.color.ansi16m=Ew(),e.bgColor.ansi256=Aw(10),e.bgColor.ansi16m=Ew(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,r,s)=>t===r&&r===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!r)return[0,0,0];let{colorString:s}=r.groups;s.length===3&&(s=s.split("").map(i=>i+i).join(""));let a=Number.parseInt(s,16);return[a>>16&255,a>>8&255,a&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(Iw,"exports",{enumerable:!0,get:sP})});function Ze(n,e){return`${n.open}${e}${n.close}`}function Nt(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Pw(n){return typeof n=="string"?n.trim():n==null?n:Nt(n,n.toString())}function un(n){if(!n.end_time)return"";let e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var Yp,ot,go,Tw=g(()=>{Yp=At(Ow(),1);fs();({color:ot}=Yp.default),go=class extends Rt{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((s,a,i)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?Ze(Yp.default.bold,o):o}).join(" > ");return Ze(ot.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Nt(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.cyan,"[chain/end]")} [${t}] [${un(e)}] Exiting Chain run with output: ${Nt(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.red,"[chain/error]")} [${t}] [${un(e)}] Chain run errored with error: ${Nt(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Ze(ot.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Nt(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.cyan,"[llm/end]")} [${t}] [${un(e)}] Exiting LLM run with output: ${Nt(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.red,"[llm/error]")} [${t}] [${un(e)}] LLM run errored with error: ${Nt(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Pw(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.cyan,"[tool/end]")} [${t}] [${un(e)}] Exiting Tool run with output: "${Pw(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.red,"[tool/error]")} [${t}] [${un(e)}] Tool run errored with error: ${Nt(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Nt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.cyan,"[retriever/end]")} [${t}] [${un(e)}] Exiting Retriever run with output: ${Nt(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Ze(ot.red,"[retriever/error]")} [${t}] [${un(e)}] Retriever run errored with error: ${Nt(e.error,"[error]")}`)}onAgentAction(e){let t=e,r=this.getBreadcrumbs(e);console.log(`${Ze(ot.blue,"[agent/action]")} [${r}] Agent selected action: ${Nt(t.actions[t.actions.length-1],"[action]")}`)}}});var Sw=g(()=>{mu()});var xa,Cw=g(()=>{Zp();Sw();qp();_a();fs();xa=class n extends Rt{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:s}=e;this.projectName=r??Q("LANGCHAIN_PROJECT")??Q("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new us({});let a=n.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await xw()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();let s=[t];for(;s.length>0;){let a=s.shift();!a||r.has(a.id)||(r.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let t={},r=[];for(let[s,a]of this.runMap){let i=new an({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=i,r.push([s,a.dotted_order])}r.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(let[s]of r){let a=this.runMap.get(s),i=t[s];if(!(!a||!i)&&a.parent_run_id){let o=t[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return mw()}catch{return}}}});function aP(){let n="default"in Pu.default?Pu.default.default:Pu.default;return new n({autoStart:!0,concurrency:1})}async function pe(n,e){e===!0?await n():(typeof Xp>"u"&&(Xp=aP()),Xp.add(n))}var Pu,Xp,kw=g(()=>{Pu=At(Wl(),1)});var Qp,Rw=g(()=>{_a();Qp=n=>n!==void 0?n:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Q(t)==="true")});function Nw(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}function yo(n){return"name"in n?n:ps.fromMethods(n)}var ef,Aa,tf,Tu,rf,nf,Ne,Ea=g(()=>{ro();Wp();Tw();sn();_a();Cw();kw();Rw();fs();Qp()&&Q("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);ef=class{setHandler(e){return this.setHandlers([e])}},Aa=class{constructor(e,t,r,s,a,i,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>pe(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,s,a){await Promise.all(this.handlers.map(i=>pe(async()=>{try{await i.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}},tf=class extends Aa{getChild(e){let t=new Ne(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw r}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}},Tu=class extends Aa{async handleLLMNewToken(e,t,r,s,a,i){await Promise.all(this.handlers.map(o=>pe(async()=>{if(!o.ignoreLLM)try{await o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},rf=class extends Aa{getChild(e){let t=new Ne(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,a){await Promise.all(this.handlers.map(i=>pe(async()=>{if(!i.ignoreChain)try{await i.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleChainEnd(e,t,r,s,a){await Promise.all(this.handlers.map(i=>pe(async()=>{if(!i.ignoreChain)try{await i.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},nf=class extends Aa{getChild(e){let t=new Ne(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>pe(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},Ne=class n extends ef{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{let d=c===0&&r?r:at();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return va(p)&&p._createRunForLLMStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),pe(async()=>{try{await p.handleLLMStart?.(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l)}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new Tu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(u,c)=>{let d=c===0&&r?r:at();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return va(p)&&p._createRunForChatModelStart(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l),pe(async()=>{try{if(p.handleChatModelStart)await p.handleChatModelStart?.(e,[u],d,this._parentRunId,a,this.tags,this.metadata,l);else if(p.handleLLMStart){let f=eo(u);await p.handleLLMStart?.(e,[f],d,this._parentRunId,a,this.tags,this.metadata,l)}}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new Tu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=at(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return va(l)&&l._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,s,o),pe(async()=>{try{await l.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s,o)}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new rf(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=at(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return va(l)&&l._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),pe(async()=>{try{await l.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new nf(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=at(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return va(l)&&l._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),pe(async()=>{try{await l.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(u){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${u}`),l.raiseError)throw u}},l.awaitHandlers)})),new tf(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,s,a){await Promise.all(this.handlers.map(i=>pe(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new n(this._parentRunId);for(let s of this.handlers){let a=this.inheritableHandlers.includes(s);r.addHandler(s,a)}for(let s of this.tags){let a=this.inheritableTags.includes(s);r.addTags([s],a)}for(let s of Object.keys(this.metadata)){let a=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},a)}for(let s of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends ps{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:at()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,a,i,o){return this._configureSync(e,t,r,s,a,i,o)}static _configureSync(e,t,r,s,a,i,o){let l;(e||t)&&(Array.isArray(e)||!e?(l=new n,l.setHandlers(e?.map(yo)??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(yo):t?.handlers,!1));let u=Q("LANGCHAIN_VERBOSE")==="true"||o?.verbose,c=xa.getTraceableRunTree()?.tracingEnabled||Qp(),d=c||(Q("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new n),u&&!l.handlers.some(p=>p.name===go.prototype.name)){let p=new go;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&c){let p=new xa;l.addHandler(p,!0),l._parentRunId=xa.getTraceableRunTree()?.id??l._parentRunId}}return(r||s)&&l&&(l.addTags(r??[]),l.addTags(s??[],!1)),(a||i)&&l&&(l.addMetadata(a??{}),l.addMetadata(i??{},!1)),l}}});var af,iP,sf,$w,of,$t,Ia=g(()=>{Zp();Ea();af=class{getStore(){}run(e,t){return t()}},iP=new af,sf=Symbol.for("ls:tracing_async_local_storage"),$w=Symbol.for("lc:child_config"),of=class{getInstance(){return globalThis[sf]??iP}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[$w]}runWithConfig(e,t,r){let s=Ne._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),a=this.getInstance(),i=s?.getParentRunId(),o=s?.handlers?.find(u=>u?.name==="langchain_tracer"),l;return o&&i?l=o.convertToRunTree(i):r||(l=new an({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[$w]:e}),a.run(l,t)}initializeGlobalInstance(e){globalThis[sf]===void 0&&(globalThis[sf]=e)}},$t=new of});async function sr(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!e?.aborted)throw r}),new Promise((r,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}var lf=g(()=>{});function uf(n,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){let a=await n.next();for(let i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function qe(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){let t={...n};for(let[r,s]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=qe(t[r],s):t[r]=s;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}async function Mw(n,e,t,r,...s){let a=new Mr({generator:e,startSetup:t,signal:r}),i=await a.setup;return{output:n(a,i,...s),setup:i}}var Ee,Mr,ar=g(()=>{Ia();lf();Ee=class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new n({start(r){return s();function s(){return t.read().then(({done:a,value:i})=>{if(a){r.close();return}return r.enqueue(i),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({async pull(t){let{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}};Mr=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{$t.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(s=>t(void 0),r)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?$t.runWithConfig(this.config,this.signal?async()=>sr(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}});async function jw(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input}async function Lw(n,e){let{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t}function oP(n){return n!==void 0&&n.message!==void 0}var qt,bo,_o,wo,Su=g(()=>{Vp();fs();ar();rs();qt=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=ln({},t);return new bo({ops:t,state:r[r.length-1].newDocument})}},bo=class n extends qt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=ln(this.state,e.ops);return new n({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=ln({},e.ops);return new n({ops:e.ops,state:t[t.length-1].newDocument})}},_o=n=>n.name==="log_stream_tracer";wo=class extends Rt{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ee.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(s=>!this.excludeTags?.includes(s))),r}async*tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let s=this.keyMapByRunId[e];s&&await this.writer.write(new qt({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new qt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await jw(e,this._schemaFormat)),await this.writer.write(new qt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await jw(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Lw(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new qt({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){let t=new qt({ops:[{op:"replace",path:"/final_output",value:await Lw(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let a=e.inputs.messages!==void 0,i;a?oP(r?.chunk)?i=r?.chunk:i=new le({id:`run-${e.id}`,content:t}):i=t;let o=new qt({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}});var Cu,Ht,Ie,Oa=g(()=>{Cu="__run",Ht=class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Ie=class n extends Ht{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}});function ku({name:n,serialized:e}){return n!==void 0?n:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var vo,Ru,Nu=g(()=>{fs();ar();rs();Oa();vo=n=>n.name==="event_stream_tracer",Ru=class extends Rt{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ee.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(s=>!this.excludeTags?.includes(s))),r}async*tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function a(o,l){return o==="llm"&&typeof l=="string"?new Ht({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(l=>{o=l}),this.tappedPromises.set(e,i);try{let l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:a(s.runType,r.value)}},s),yield r.value;for await(let u of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:a(s.runType,u)}},s),yield u}finally{o()}}else{yield r.value;for await(let o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=ku(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);let a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onLLMNewToken(e,t,r){let s=this.runInfoMap.get(e.id),a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",r?.chunk===void 0?a=new le({content:t,id:`run-${e.id}`}):a=r.chunk.message;else if(s.runType==="llm")i="on_llm_stream",r?.chunk===void 0?a=new Ht({text:t}):a=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let s=e.outputs?.generations,a;if(t.runType==="chat_model"){for(let i of s??[]){if(a!==void 0)break;a=i[0]?.message}r="on_chat_model_end"}else if(t.runType==="llm")a={generations:s?.map(i=>i.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){let t=ku(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=ku(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=ku(e),s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}});async function lt(n){return Ne._configureSync(n?.callbacks,void 0,n?.tags,void 0,n?.metadata)}function Mu(...n){let e={};for(let t of n.filter(r=>!!r))for(let r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){let s=e[r]??[];e[r]=[...new Set(s.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){let s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{let i=s.copy();for(let o of a)i.addHandler(yo(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){let i=a.copy();for(let o of s)i.addHandler(yo(o),!0);e.callbacks=i}else e.callbacks=new Ne(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{let s=r;e[s]=t[s]??e[s]}return e}function Z(n){let e=$t.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:r,runName:s,...a}=e;t=Object.entries(a).reduce((i,[o,l])=>(l!==void 0&&(i[o]=l),i),t)}if(n&&(t=Object.entries(n).reduce((r,[s,a])=>(a!==void 0&&(r[s]=a),r),t)),t?.configurable)for(let r of Object.keys(t.configurable))lP.has(typeof t.configurable[r])&&!t.metadata?.[r]&&(t.metadata||(t.metadata={}),t.metadata[r]=t.configurable[r]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let r=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,r])):t.signal=r,delete t.timeout}return t}function fe(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:s,configurable:a,runId:i}={}){let o=Z(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}var $u,lP,hs=g(()=>{Ea();Ia();$u=25;lP=new Set(["string","number","boolean"])});var Dw,ju,uP,cP,jr,xo=g(()=>{Dw=At(Dl(),1),ju=At(Wl(),1),uP=[400,401,402,403,404,405,406,407,409],cP=n=>{if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||n?.code==="ECONNABORTED")throw n;let e=n?.response?.status??n?.status;if(e&&uP.includes(+e))throw n;if(n?.error?.code==="insufficient_quota"){let t=new Error(n?.message);throw t.name="InsufficientQuotaError",t}},jr=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??cP;let t="default"in ju.default?ju.default.default:ju.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Dw.default)(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}});var Ao,Fw=g(()=>{fs();Ao=class extends Rt{constructor({config:e,onStart:t,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}});function Eo(n){return n?n.lc_runnable:!1}var Lu,cf=g(()=>{Lu=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||s.some(a=>this.includeTags?.includes(a))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&s.every(a=>!this.excludeTags?.includes(a))),r}}});function df(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function dP(n,e){let t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function pP(n){let e="";for(let[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function Uw(n,e,t){let{firstNodeLabel:r,lastNodeLabel:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{},u=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){let d="default",p={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(p[r]="{0}[{0}]:::startclass"),s!==void 0&&(p[s]="{0}[{0}]:::endclass");for(let f of Object.values(n)){let h=p[f]??p[d],m=df(f),y=f.split(":"),x=y[y.length-1];u+=`	${h.replace(/\{0\}/g,m).replace(/\{1\}/g,x)};
`}}let c="";for(let d of e){let p=d.source.includes(":")?d.source.split(":")[0]:void 0,f=d.target.includes(":")?d.target.split(":")[0]:void 0;c!==""&&(c!==p||c!==f)&&(u+=`	end
`,c=""),c===""&&p!==void 0&&p===f&&(u=`	subgraph ${p}
`,c=p);let[h,m]=dP(d,n),y="";if(d.data!==void 0){let x=d.data,w=x.split(" ");w.length>l&&(x=w.reduce((A,M,N)=>(N%l===0&&A.push(""),A[A.length-1]+=` ${M}`,A),[]).join("<br>")),d.conditional?y=` -. ${x} .-> `:y=` -- ${x} --> `}else d.conditional?y=" -.-> ":y=" --> ";u+=`	${df(h)}${y}${df(m)};
`}return c!==""&&(u+=`end
`),i&&a!==void 0&&(u+=pP(a)),u}async function Bw(n,e){let{backgroundColor:t="white"}=e??{},r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let s=`https://mermaid.ink/img/${r}?bgColor=${t}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}var zw=g(()=>{});function pf(n){if(to(n.id))if(Eo(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>qw&&(e=`${e.substring(0,qw)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function fP(n){return Eo(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...Fe(n.data.schema),title:n.data.name}}}var qw,Io,Hw=g(()=>{Pr();ro();cf();zw();qw=42;Io=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=to(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...fP(t)})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let r=t||at(),s={id:r,data:e};return this.nodes[r]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let a={source:e.id,target:t.id,data:r,conditional:s};return this.edges.push(a),a}firstNode(){let e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(u=>u.id).every(to)&&(r="");let a=u=>r?`${r}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[a(u)]={...c,id:a(u)}});let i=e.edges.map(u=>({...u,source:a(u.source),target:a(u.target)}));this.edges=[...this.edges,...i];let o=e.firstNode(),l=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,l?{id:a(l.id),data:l.data}:void 0]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:s={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:a}=e??{},i={};for(let d of Object.values(this.nodes))i[d.id]=pf(d);let o=this.firstNode(),l=o?pf(o):void 0,u=this.lastNode(),c=u?pf(u):void 0;return Uw(i,this.edges,{firstNodeLabel:l,lastNodeLabel:c,withStyles:t,curveStyle:r,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){let t=this.drawMermaid(e);return Bw(t,{backgroundColor:e?.backgroundColor})}}});function Vw(n){let e=new TextEncoder,t=new ReadableStream({async start(r){for await(let s of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Ee.fromReadableStream(t)}var Gw=g(()=>{ar()});function ff(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}function Du(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*hf(n,e){for(;;){let{value:t,done:r}=$t.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}async function*mf(n,e){let t=e[Symbol.asyncIterator]();for(;;){let{value:r,done:s}=await $t.runWithConfig(n,t.next.bind(e),!0);if(s)break;yield r}}var Kw,Ww=g(()=>{Ia();Kw=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function"});function we(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}function hP(n){if(bu(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}function Lr(n){if(typeof n=="function")return new or({func:n});if(X.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){let e={};for(let[t,r]of Object.entries(n))e[t]=Lr(r);return new cn({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}function mP(n,e){let t=e.name??n.getName(),r=e.description??e.schema?.description;return e.schema.constructor===rt.ZodString?new Oo({name:t,description:r,schema:rt.object({input:rt.string()}).transform(s=>s.input),bound:n}):new Oo({name:t,description:r,schema:e.schema,bound:n})}var gf,X,ir,Fu,Uu,gt,cn,yf,or,Bu,Pa,zu,Oo,Mt=g(()=>{es();gf=At(Dl(),1);ro();qp();Su();Nu();da();ar();lf();hs();xo();Fw();cf();Ia();Hw();Gw();Ww();Ml();X=class extends mt{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new ir({bound:this,kwargs:e,config:{}})}map(){return new Fu({bound:this})}withRetry(e){return new Uu({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new ir({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new Bu({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Z);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>Z(a===0?e:r))}return Array.from({length:t},()=>Z(e))}async batch(e,t,r){let s=this._getOptionsList(t??{},e.length),a=s[0]?.maxConcurrency??r?.maxConcurrency,i=new jr({maxConcurrency:a,onFailedAttempt:l=>{throw l}}),o=e.map((l,u)=>i.call(async()=>{try{return await this.invoke(l,s[u])}catch(c){if(r?.returnExceptions)return c;throw c}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=Z(t),s=new Mr({generator:this._streamIterator(e,r),config:r});return await s.setup,Ee.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Z(e):t=Z({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let s=Z(r),i=await(await lt(s))?.handleChainStart(this.toJSON(),we(t,"input"),s.runId,s?.runType,void 0,void 0,s?.runName??this.getName());delete s.runId;let o;try{let l=e.call(this,t,s,i);o=await sr(l,r?.signal)}catch(l){throw await i?.handleChainError(l),l}return await i?.handleChainEnd(we(o,"output")),o}async _batchWithConfig(e,t,r,s){let a=this._getOptionsList(r??{},t.length),i=await Promise.all(a.map(lt)),o=await Promise.all(i.map(async(u,c)=>{let d=await u?.handleChainStart(this.toJSON(),we(t[c],"input"),a[c].runId,a[c].runType,void 0,void 0,a[c].runName??this.getName());return delete a[c].runId,d})),l;try{let u=e.call(this,t,a,o,s);l=await sr(u,a?.[0]?.signal)}catch(u){throw await Promise.all(o.map(c=>c?.handleChainError(u))),u}return await Promise.all(o.map(u=>u?.handleChainEnd(we(l,"output")))),l}async*_transformStreamWithConfig(e,t,r){let s,a=!0,i,o=!0,l=Z(r),u=await lt(l);async function*c(){for await(let p of e){if(a)if(s===void 0)s=p;else try{s=qe(s,p)}catch{s=void 0,a=!1}yield p}}let d;try{let p=await Mw(t.bind(this),c(),async()=>u?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,d=p.setup;let f=d?.handlers.find(vo),h=p.output;f!==void 0&&d!==void 0&&(h=f.tapOutputIterable(d.runId,h));let m=d?.handlers.find(_o);m!==void 0&&d!==void 0&&(h=m.tapOutputIterable(d.runId,h));for await(let y of h)if(yield y,o)if(i===void 0)i=y;else try{i=qe(i,y)}catch{i=void 0,o=!1}}catch(p){throw await d?.handleChainError(p,void 0,void 0,void 0,{inputs:we(s,"input")}),p}await d?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:we(s,"input")})}getGraph(e){let t=new Io,r=t.addNode({name:`${this.getName()}Input`,schema:rt.any()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:rt.any()});return t.addEdge(r,s),t.addEdge(s,a),t}pipe(e){return new gt({first:this,last:Lr(e)})}pick(e){return this.pipe(new zu(e))}assign(e){return this.pipe(new Pa(new cn({steps:e})))}async*transform(e,t){let r;for await(let s of e)r===void 0?r=s:r=qe(r,s);yield*this._streamIterator(r,Z(t))}async*streamLog(e,t,r){let s=new wo({...r,autoClose:!1,_schemaFormat:"original"}),a=Z(t);yield*this._streamLog(e,s,a)}async*_streamLog(e,t,r){let{callbacks:s}=r;if(s===void 0)r.callbacks=[t];else if(Array.isArray(s))r.callbacks=s.concat([t]);else{let l=s.copy();l.addHandler(t,!0),r.callbacks=l}let a=this.stream(e,r);async function i(){try{let l=await a;for await(let u of l){let c=new qt({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(c)}}finally{await t.writer.close()}}let o=i();try{for await(let l of t)yield l}finally{await o}}streamEvents(e,t,r){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,r);else if(t.version==="v2")s=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?Vw(s):Ee.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,r){let s=new Ru({...r,autoClose:!1}),a=Z(t),i=a.runId??at();a.runId=i;let o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{let f=o.copy();f.addHandler(s,!0),a.callbacks=f}let l=this;async function u(){try{let f=await l.stream(e,a),h=s.tapOutputIterable(i,f);for await(let m of h);}finally{await s.finish()}}let c=u(),d=!1,p;try{for await(let f of s){if(!d){f.data.input=e,d=!0,p=f.run_id,yield f;continue}f.run_id===p&&f.event.endsWith("_end")&&f.data?.input&&delete f.data.input,yield f}}finally{await c}}async*_streamEventsV1(e,t,r){let s,a=!1,i=Z(t),o=i.tags??[],l=i.metadata??{},u=i.runName??this.getName(),c=new wo({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Lu({...r}),p=this._streamLog(e,c,i);for await(let h of p){if(s?s=s.concat(h):s=bo.fromRunLogPatch(h),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;let w={...s.state},A={run_id:w.id,event:`on_${w.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(A,w.type)&&(yield A)}let m=h.ops.filter(w=>w.path.startsWith("/logs/")).map(w=>w.path.split("/")[2]),y=[...new Set(m)];for(let w of y){let A,M={},N=s.state.logs[w];if(N.end_time===void 0?N.streamed_output.length>0?A="stream":A="start":A="end",A==="start")N.inputs!==void 0&&(M.input=N.inputs);else if(A==="end")N.inputs!==void 0&&(M.input=N.inputs),M.output=N.final_output;else if(A==="stream"){let R=N.streamed_output.length;if(R!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${R} instead. Encountered in: "${N.name}"`);M={chunk:N.streamed_output[0]},N.streamed_output=[]}yield{event:`on_${N.type}_${A}`,name:N.name,run_id:N.id,tags:N.tags,metadata:N.metadata,data:M}}let{state:x}=s;if(x.streamed_output.length>0){let w=x.streamed_output.length;if(w!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${w} instead. Encountered in: "${x.name}"`);let A={chunk:x.streamed_output[0]};x.streamed_output=[];let M={event:`on_${x.type}_stream`,run_id:x.id,tags:o,metadata:l,name:u,data:A};d.includeEvent(M,x.type)&&(yield M)}}let f=s?.state;if(f!==void 0){let h={event:`on_${f.type}_end`,name:u,run_id:f.id,tags:o,metadata:l,data:{output:f.final_output}};d.includeEvent(h,f.type)&&(yield h)}}static isRunnable(e){return Eo(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new ir({bound:this,config:{},configFactories:[s=>({callbacks:[new Ao({config:s,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return mP(this,e)}},ir=class n extends X{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=Mu(this.config,...e);return Mu(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Z(t),this.kwargs))}async batch(e,t,r){let s=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Z(a),this.kwargs))):await this._mergeConfig(Z(t),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Z(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Z(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Z(t),this.kwargs))}streamEvents(e,t,r){let s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(Z(t),s.kwargs),version:t.version},r)};return Ee.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&X.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new Ao({config:s,onStart:e,onEnd:t,onError:r})]})]})}},Fu=class n extends X{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new n({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,fe(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}},Uu=class extends ir{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let s=e>1?`retry:attempt:${e}`:void 0;return fe(t,{callbacks:r?.getChild(s)})}async _invoke(e,t,r){return(0,gf.default)(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,s){let a={};try{await(0,gf.default)(async i=>{let o=e.map((p,f)=>f).filter(p=>a[p.toString()]===void 0||a[p.toString()]instanceof Error),l=o.map(p=>e[p]),u=o.map(p=>this._patchConfigForRetry(i,t?.[p],r?.[p])),c=await super.batch(l,u,{...s,returnExceptions:!0}),d;for(let p=0;p<c.length;p+=1){let f=c[p],h=o[p];f instanceof Error&&d===void 0&&(d=f,d.input=l[p]),a[h.toString()]=f}if(d)throw d;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if(s?.returnExceptions!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},gt=class n extends X{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r=Z(t),a=await(await lt(r))?.handleChainStart(this.toJSON(),we(e,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i=e,o;try{let l=[this.first,...this.middle];for(let u=0;u<l.length;u+=1){let d=l[u].invoke(i,fe(r,{callbacks:a?.getChild(`seq:step:${u+1}`)}));i=await sr(d,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=await this.last.invoke(i,fe(r,{callbacks:a?.getChild(`seq:step:${this.steps.length}`)}))}catch(l){throw await a?.handleChainError(l),l}return await a?.handleChainEnd(we(o,"output")),o}async batch(e,t,r){let s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(lt)),i=await Promise.all(a.map(async(l,u)=>{let c=await l?.handleChainStart(this.toJSON(),we(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName);return delete s[u].runId,c})),o=e;try{for(let l=0;l<this.steps.length;l+=1){let c=this.steps[l].batch(o,i.map((d,p)=>{let f=d?.getChild(`seq:step:${l+1}`);return fe(s[p],{callbacks:f})}),r);o=await sr(c,s[0]?.signal)}}catch(l){throw await Promise.all(i.map(u=>u?.handleChainError(l))),l}return await Promise.all(i.map(l=>l?.handleChainEnd(we(o,"output")))),o}async*_streamIterator(e,t){let r=await lt(t),{runId:s,...a}=t??{},i=await r?.handleChainStart(this.toJSON(),we(e,"input"),s,void 0,void 0,void 0,a?.runName),o=[this.first,...this.middle,this.last],l=!0,u;async function*c(){yield e}try{let d=o[0].transform(c(),fe(a,{callbacks:i?.getChild("seq:step:1")}));for(let p=1;p<o.length;p+=1)d=await o[p].transform(d,fe(a,{callbacks:i?.getChild(`seq:step:${p+1}`)}));for await(let p of d)if(t?.signal?.throwIfAborted(),yield p,l)if(u===void 0)u=p;else try{u=qe(u,p)}catch{u=void 0,l=!1}}catch(d){throw await i?.handleChainError(d),d}await i?.handleChainEnd(we(u,"output"))}getGraph(e){let t=new Io,r=null;return this.steps.forEach((s,a)=>{let i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&t.addEdge(r,o),r=i.lastNode()}),t}pipe(e){return n.isRunnableSequence(e)?new n({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new n({first:this.first,middle:[...this.middle,this.last],last:Lr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&X.isRunnable(e)}static from([e,...t],r){return new n({first:Lr(e),middle:t.slice(0,-1).map(Lr),last:Lr(t[t.length-1]),name:r})}},cn=class n extends X{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,r]of Object.entries(e.steps))this.steps[t]=Lr(r)}static from(e){return new n({steps:e})}async invoke(e,t){let r=Z(t),a=await(await lt(r))?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i={};try{let o=Object.entries(this.steps).map(async([l,u])=>{i[l]=await u.invoke(e,fe(r,{callbacks:a?.getChild(`map:key:${l}`)}))});await sr(Promise.all(o),t?.signal)}catch(o){throw await a?.handleChainError(o),o}return await a?.handleChainEnd(i),i}async*_transform(e,t,r){let s={...this.steps},a=uf(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,l],u)=>{let c=l.transform(a[u],fe(r,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;i.size;){let o=Promise.race(i.values()),{key:l,result:u,gen:c}=await sr(o,r?.signal);i.delete(l),u.done||(yield{[l]:u.value},i.set(l,c.next().then(d=>({key:l,gen:c,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Z(t),a=new Mr({generator:this.transform(r(),s),config:s});return await a.setup,Ee.fromAsyncGenerator(a)}},yf=class n extends X{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!bu(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),s=await lt(r),a=this.func(fe(r,{callbacks:s}),e);return sr(a,r?.signal)}async*_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(Du(s)){for await(let a of s)r?.signal?.throwIfAborted(),yield a;return}if(Kw(s)){for(;;){r?.signal?.throwIfAborted();let a=s.next();if(a.done)break;yield a.value}return}yield s}static from(e){return new n({func:e})}};or=class n extends X{static lc_name(){return"RunnableLambda"}constructor(e){if(bu(e.func))return yf.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),hP(e.func),this.func=e.func}static from(e){return new n({func:e})}async _invoke(e,t,r){return new Promise((s,a)=>{let i=fe(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??$u)-1});$t.runWithConfig(i,async()=>{try{let o=await this.func(e,{...i,config:i});if(o&&X.isRunnable(o)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...i,recursionLimit:(i.recursionLimit??$u)-1})}else if(Du(o)){let l;for await(let u of mf(i,o))if(t?.signal?.throwIfAborted(),l===void 0)l=u;else try{l=qe(l,u)}catch{l=u}o=l}else if(ff(o)){let l;for(let u of hf(i,o))if(t?.signal?.throwIfAborted(),l===void 0)l=u;else try{l=qe(l,u)}catch{l=u}o=l}s(o)}catch(o){a(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let s;for await(let o of e)if(s===void 0)s=o;else try{s=qe(s,o)}catch{s=o}let a=fe(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??$u)-1}),i=await new Promise((o,l)=>{$t.runWithConfig(a,async()=>{try{let u=await this.func(s,{...a,config:a});o(u)}catch(u){l(u)}})});if(i&&X.isRunnable(i)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");let o=await i.stream(s,a);for await(let l of o)yield l}else if(Du(i))for await(let o of mf(a,i))r?.signal?.throwIfAborted(),yield o;else if(ff(i))for(let o of hf(a,i))r?.signal?.throwIfAborted(),yield o;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Z(t),a=new Mr({generator:this.transform(r(),s),config:s});return await a.setup,Ee.fromAsyncGenerator(a)}},Bu=class extends X{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let r=Z(t),s=await lt(t),{runId:a,...i}=r,o=await s?.handleChainStart(this.toJSON(),we(e,"input"),a,void 0,void 0,void 0,i?.runName),l;for(let u of this.runnables()){r?.signal?.throwIfAborted();try{let c=await u.invoke(e,fe(i,{callbacks:o?.getChild()}));return await o?.handleChainEnd(we(c,"output")),c}catch(c){l===void 0&&(l=c)}}throw l===void 0?new Error("No error stored at end of fallback."):(await o?.handleChainError(l),l)}async*_streamIterator(e,t){let r=Z(t),s=await lt(t),{runId:a,...i}=r,o=await s?.handleChainStart(this.toJSON(),we(e,"input"),a,void 0,void 0,void 0,i?.runName),l,u;for(let d of this.runnables()){r?.signal?.throwIfAborted();let p=fe(i,{callbacks:o?.getChild()});try{u=await d.stream(e,p);break}catch(f){l===void 0&&(l=f)}}if(u===void 0){let d=l??new Error("No error stored at end of fallback.");throw await o?.handleChainError(d),d}let c;try{for await(let d of u){yield d;try{c=c===void 0?c:qe(c,d)}catch{c=void 0}}}catch(d){throw await o?.handleChainError(d),d}await o?.handleChainEnd(we(c,"output"))}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(l=>lt(l))),i=await Promise.all(a.map(async(l,u)=>{let c=await l?.handleChainStart(this.toJSON(),we(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName);return delete s[u].runId,c})),o;for(let l of this.runnables()){s[0].signal?.throwIfAborted();try{let u=await l.batch(e,i.map((c,d)=>fe(s[d],{callbacks:c?.getChild()})),r);return await Promise.all(i.map((c,d)=>c?.handleChainEnd(we(u[d],"output")))),u}catch(u){o===void 0&&(o=u)}}throw o?(await Promise.all(i.map(l=>l?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};Pa=class extends X{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof cn&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){let s=this.mapper.getStepsKeys(),[a,i]=uf(e),o=this.mapper.transform(i,fe(r,{callbacks:t?.getChild()})),l=o.next();for await(let u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);let c=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(let u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Z(t),a=new Mr({generator:this.transform(r(),s),config:s});return await a.setup,Ee.fromAsyncGenerator(a)}},zu=class extends X{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Z(t),a=new Mr({generator:this.transform(r(),s),config:s});return await a.setup,Ee.fromAsyncGenerator(a)}},Oo=class extends ir{constructor(e){let t=gt.from([or.from(async r=>{let s;if(ma(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new ha("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}});var bf=g(()=>{Bt()});var Jw=g(()=>{Mt();rs();Rl();Nl();Qi();bf();$l();fa();sn()});var ms=g(()=>{rs();Bt();Rl();Nl();Qi();$l();sn();Jw();bf();fa()});var Po,Ta,Sa,Hu,To=g(()=>{da();Qi();sn();Po=class extends mt{},Ta=class extends Po{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new be(this.value)]}},Sa=class extends Po{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return eo(this.messages)}toChatMessages(){return this.messages}},Hu=class extends Po{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new be({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}});var Qw=C(Vu=>{"use strict";Vu.byteLength=_P;Vu.toByteArray=xP;Vu.fromByteArray=IP;var lr=[],jt=[],wP=typeof Uint8Array<"u"?Uint8Array:Array,vf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(gs=0,Yw=vf.length;gs<Yw;++gs)lr[gs]=vf[gs],jt[vf.charCodeAt(gs)]=gs;var gs,Yw;jt[45]=62;jt[95]=63;function Xw(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function _P(n){var e=Xw(n),t=e[0],r=e[1];return(t+r)*3/4-r}function vP(n,e,t){return(e+t)*3/4-t}function xP(n){var e,t=Xw(n),r=t[0],s=t[1],a=new wP(vP(n,r,s)),i=0,o=s>0?r-4:r,l;for(l=0;l<o;l+=4)e=jt[n.charCodeAt(l)]<<18|jt[n.charCodeAt(l+1)]<<12|jt[n.charCodeAt(l+2)]<<6|jt[n.charCodeAt(l+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=jt[n.charCodeAt(l)]<<2|jt[n.charCodeAt(l+1)]>>4,a[i++]=e&255),s===1&&(e=jt[n.charCodeAt(l)]<<10|jt[n.charCodeAt(l+1)]<<4|jt[n.charCodeAt(l+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function AP(n){return lr[n>>18&63]+lr[n>>12&63]+lr[n>>6&63]+lr[n&63]}function EP(n,e,t){for(var r,s=[],a=e;a<t;a+=3)r=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(n[a+2]&255),s.push(AP(r));return s.join("")}function IP(n){for(var e,t=n.length,r=t%3,s=[],a=16383,i=0,o=t-r;i<o;i+=a)s.push(EP(n,i,i+a>o?o:i+a));return r===1?(e=n[t-1],s.push(lr[e>>2]+lr[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(lr[e>>10]+lr[e>>4&63]+lr[e<<2&63]+"=")),s.join("")}});var Fr,Mo=g(()=>{To();Na();Fr=class extends Ur{async formatPromptValue(e){let t=await this.format(e);return new Ta(t)}}});function Of(n){return typeof n=="function"}function hT(n){return Ma(n)?"array":typeof n}function If(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o_(n,e){return n!=null&&typeof n=="object"&&e in n}function mT(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}function yT(n,e){return gT.call(n,e)}function wT(n){return!yT(bT,n)}function vT(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return _T[t]})}function OT(n,e){if(!n)return[];var t=!1,r=[],s=[],a=[],i=!1,o=!1,l="",u=0;function c(){if(i&&!o)for(;a.length;)delete s[a.pop()];else a=[];i=!1,o=!1}var d,p,f;function h(T){if(typeof T=="string"&&(T=T.split(AT,2)),!Ma(T)||T.length!==2)throw new Error("Invalid tags: "+T);d=new RegExp(If(T[0])+"\\s*"),p=new RegExp("\\s*"+If(T[1])),f=new RegExp("\\s*"+If("}"+T[1]))}h(e||Lt.tags);for(var m=new Lo(n),y,x,w,A,M,N;!m.eos();){if(y=m.pos,w=m.scanUntil(d),w)for(var R=0,U=w.length;R<U;++R)A=w.charAt(R),wT(A)?(a.push(s.length),l+=A):(o=!0,t=!0,l+=" "),s.push(["text",A,y,y+1]),y+=1,A===`
`&&(c(),l="",u=0,t=!1);if(!m.scan(d))break;if(i=!0,x=m.scan(IT)||"name",m.scan(xT),x==="="?(w=m.scanUntil(l_),m.scan(l_),m.scanUntil(p)):x==="{"?(w=m.scanUntil(f),m.scan(ET),m.scanUntil(p),x="&"):w=m.scanUntil(p),!m.scan(p))throw new Error("Unclosed tag at "+m.pos);if(x==">"?M=[x,w,y,m.pos,l,u,t]:M=[x,w,y,m.pos],u++,s.push(M),x==="#"||x==="^")r.push(M);else if(x==="/"){if(N=r.pop(),!N)throw new Error('Unopened section "'+w+'" at '+y);if(N[1]!==w)throw new Error('Unclosed section "'+N[1]+'" at '+y)}else x==="name"||x==="{"||x==="&"?o=!0:x==="="&&h(w)}if(c(),N=r.pop(),N)throw new Error('Unclosed section "'+N[1]+'" at '+m.pos);return TT(PT(s))}function PT(n){for(var e=[],t,r,s=0,a=n.length;s<a;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function TT(n){for(var e=[],t=e,r=[],s,a,i=0,o=n.length;i<o;++i)switch(s=n[i],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":a=r.pop(),a[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function Lo(n){this.string=n,this.tail=n,this.pos=0}function $a(n,e){this.view=n,this.cache={".":this.view},this.parent=e}function Ye(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}var fT,Ma,gT,bT,_T,xT,AT,l_,ET,IT,Lt,jo,Yu,u_=g(()=>{fT=Object.prototype.toString,Ma=Array.isArray||function(e){return fT.call(e)==="[object Array]"};gT=RegExp.prototype.test;bT=/\S/;_T={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};xT=/\s*/,AT=/\s+/,l_=/\s*=/,ET=/\s*\}/,IT=/#|\^|\/|>|\{|&|=|!/;Lo.prototype.eos=function(){return this.tail===""};Lo.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Lo.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};$a.prototype.push=function(e){return new $a(e,this)};$a.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,a,i,o,l=!1;s;){if(e.indexOf(".")>0)for(a=s.view,i=e.split("."),o=0;a!=null&&o<i.length;)o===i.length-1&&(l=o_(a,i[o])||mT(a,i[o])),a=a[i[o++]];else a=s.view[e],l=o_(s.view,e);if(l){r=a;break}s=s.parent}t[e]=r}return Of(r)&&(r=r.call(this.view)),r};Ye.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Ye.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||Lt.tags).join(":"),a=typeof r<"u",i=a?r.get(s):void 0;return i==null&&(i=OT(e,t),a&&r.set(s,i)),i};Ye.prototype.render=function(e,t,r,s){var a=this.getConfigTags(s),i=this.parse(e,a),o=t instanceof $a?t:new $a(t,void 0);return this.renderTokens(i,o,r,e,s)};Ye.prototype.renderTokens=function(e,t,r,s,a){for(var i="",o,l,u,c=0,d=e.length;c<d;++c)u=void 0,o=e[c],l=o[0],l==="#"?u=this.renderSection(o,t,r,s,a):l==="^"?u=this.renderInverted(o,t,r,s,a):l===">"?u=this.renderPartial(o,t,r,a):l==="&"?u=this.unescapedValue(o,t):l==="name"?u=this.escapedValue(o,t,a):l==="text"&&(u=this.rawValue(o)),u!==void 0&&(i+=u);return i};Ye.prototype.renderSection=function(e,t,r,s,a){var i=this,o="",l=t.lookup(e[1]);function u(p){return i.render(p,t,r,a)}if(l){if(Ma(l))for(var c=0,d=l.length;c<d;++c)o+=this.renderTokens(e[4],t.push(l[c]),r,s,a);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],t.push(l),r,s,a);else if(Of(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(t.view,s.slice(e[3],e[5]),u),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],t,r,s,a);return o}};Ye.prototype.renderInverted=function(e,t,r,s,a){var i=t.lookup(e[1]);if(!i||Ma(i)&&i.length===0)return this.renderTokens(e[4],t,r,s,a)};Ye.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),a=e.split(`
`),i=0;i<a.length;i++)a[i].length&&(i>0||!r)&&(a[i]=s+a[i]);return a.join(`
`)};Ye.prototype.renderPartial=function(e,t,r,s){if(r){var a=this.getConfigTags(s),i=Of(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],l=e[5],u=e[4],c=i;l==0&&u&&(c=this.indentPartial(i,u,o));var d=this.parse(c,a);return this.renderTokens(d,t,r,c,s)}}};Ye.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};Ye.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||Lt.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&s===Lt.escape?String(a):s(a)};Ye.prototype.rawValue=function(e){return e[1]};Ye.prototype.getConfigTags=function(e){return Ma(e)?e:e&&typeof e=="object"?e.tags:void 0};Ye.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ma(e))return e.escape};Lt={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){jo.templateCache=n},get templateCache(){return jo.templateCache}},jo=new Ye;Lt.clearCache=function(){return jo.clearCache()};Lt.parse=function(e,t){return jo.parse(e,t)};Lt.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+hT(e)+'" was given as the first argument for mustache#render(template, view, partials)');return jo.render(e,t,r,s)};Lt.escape=vT;Lt.Scanner=Lo;Lt.Context=$a;Lt.Writer=Ye;Yu=Lt});function c_(){Yu.escape=n=>n}var Do,ST,Xu,CT,kT,Pf,RT,Kt,d_,ws,ja=g(()=>{u_();Do=n=>{let e=n.split(""),t=[],r=(a,i)=>{for(let o=i;o<e.length;o+=1)if(a.includes(e[o]))return o;return-1},s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){let a=r("}",s);if(a<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,a).join("")}),s=a+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{let a=r("{}",s),i=(a<0?e.slice(s):e.slice(s,a)).join("");t.push({type:"literal",text:i}),s=a<0?e.length:a}}return t},ST=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Xu=n=>{c_();let e=Yu.parse(n);return ST(e)},CT=(n,e)=>Do(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),kT=(n,e)=>(c_(),Yu.render(n,e)),Pf={"f-string":CT,mustache:kT},RT={"f-string":Do,mustache:Xu},Kt=(n,e,t)=>Pf[e](n,t),d_=(n,e)=>RT[e](n),ws=(n,e,t)=>{if(!(e in Pf)){let r=Object.keys(Pf);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{let r=t.reduce((s,a)=>(s[a]="foo",s),{});Array.isArray(n)?n.forEach(s=>{if(s.type==="text")Kt(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")Kt(s.image_url,e,r);else{let a=s.image_url.url;Kt(a,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):Kt(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}}});var Tf={};Gi(Tf,{PromptTemplate:()=>Wt});var Wt,La=g(()=>{Mo();ja();Wt=class n extends Fr{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),ws(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return Kt(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,a=""){let i=[a,...e,t].join(s);return new n({inputVariables:r,template:i})}static fromTemplate(e,t){let{templateFormat:r="f-string",...s}=t??{},a=new Set;return d_(e,r).forEach(i=>{i.type==="variable"&&a.add(i.name)}),new n({inputVariables:[...a],templateFormat:r,template:e,...s})}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new n({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}});var Da,Sf=g(()=>{To();Na();ja();Da=class n extends Ur{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),ws([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}async format(e){let t={};for(let[i,o]of Object.entries(this.template))typeof o=="string"?t[i]=Kt(o,this.templateFormat,e):t[i]=o;let r=e.url||t.url,s=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");let a={url:r};return s&&(a.detail=s),a}async formatPromptValue(e){let t=await this.format(e);return new Hu(t)}}});function NT(n){return typeof n.formatMessages=="function"}function $T(n,e){if(NT(n)||st(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){let s=n[1];if(typeof s!="string"||s[0]!=="{"||s[s.length-1]!=="}")throw new Error(`Invalid placeholder template: "${n[1]}". Expected a variable name surrounded by curly braces.`);let a=s.slice(1,-1);return new Cf({variableName:a,optional:!0})}let t=zt(n),r;if(typeof t.content=="string"?r=t.content:r=t.content.map(s=>"text"in s?{...s,text:s.text}:"image_url"in s?{...s,image_url:s.image_url}:s),t._getType()==="human")return Qu.fromTemplate(r,e);if(t._getType()==="ai")return Nf.fromTemplate(r,e);if(t._getType()==="system")return $f.fromTemplate(r,e);if(Ce.isInstance(t))return Rf.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function MT(n){return n.constructor.lc_name()==="MessagesPlaceholder"}var Fo,Cf,kf,Uo,Rf,Bo,Qu,Nf,$f,Fa,zo=g(()=>{ms();To();Mt();Mo();Na();La();Sf();ja();Fo=class extends X{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}},Cf=class extends Fo{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){let t=e[this.variableName];if(this.optional&&!t)return[];if(!t){let s=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw s.name="InputFormatError",s}let r;try{Array.isArray(t)?r=t.map(zt):r=[zt(t)]}catch(s){let a=typeof t=="string"?t:JSON.stringify(t,null,2),i=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${a}`,`Additional message: ${s.message}`].join(`

`));throw i.name="InputFormatError",i}return r}},kf=class extends Fo{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},Uo=class extends Ur{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new Sa(t)}},Rf=class extends kf{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new Ce(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(Wt.fromTemplate(e,{templateFormat:r?.templateFormat}),t)}},Bo=class extends Fo{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(s=>{"inputVariables"in s&&(r=r.concat(s.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){let t=this.constructor;if(t._messageClass()){let r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){let r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(Wt.fromTemplate(e,t));let r=[];for(let s of e)if(typeof s=="string"||typeof s=="object"&&"text"in s){let a="";typeof s=="string"?a=s:typeof s.text=="string"&&(a=s.text??"");let i={...t,...typeof s!="string"?{additionalContentFields:s}:{}};r.push(Wt.fromTemplate(a,i))}else if(typeof s=="object"&&"image_url"in s){let a=s.image_url??"",i,o=[];if(typeof a=="string"){let l;t?.templateFormat==="mustache"?l=Xu(a):l=Do(a);let u=l.flatMap(c=>c.type==="variable"?[c.name]:[]);if((u?.length??0)>0){if(u.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${u}
From: ${a}`);o=[u[0]]}else o=[];a={url:a},i=new Da({template:a,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:s})}else if(typeof a=="object"){if("url"in a){let l;t?.templateFormat==="mustache"?l=Xu(a.url):l=Do(a.url),o=l.flatMap(u=>u.type==="variable"?[u.name]:[])}else o=[];i=new Da({template:a,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:s})}else throw new Error("Invalid image template");r.push(i)}return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof Fr){let t=await this.prompt.format(e);return this.createMessage(t)}else{let t=[];for(let r of this.prompt){let s={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(let a of r.inputVariables)s||(s={[a]:e[a]}),s={...s,[a]:e[a]};if(r instanceof Fr){let a=await r.format(s),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"text",text:a})}else if(r instanceof Da){let a=await r.format(s),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"image_url",image_url:a})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}},Qu=class extends Bo{static _messageClass(){return be}static lc_name(){return"HumanMessagePromptTemplate"}},Nf=class extends Bo{static _messageClass(){return se}static lc_name(){return"AIMessagePromptTemplate"}},$f=class extends Bo{static _messageClass(){return ss}static lc_name(){return"SystemMessagePromptTemplate"}};Fa=class n extends Uo{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){let t=new Set;for(let o of this.promptMessages)if(!(o instanceof ye))for(let l of o.inputVariables)t.add(l);let r=this.inputVariables,s=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),a=new Set([...s].filter(o=>!t.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);let i=new Set([...t].filter(o=>!s.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;let r=await Promise.all(e.content.map(async s=>{if(s.type!=="image_url")return s;let a="";typeof s.image_url=="string"?a=s.image_url:a=s.image_url.url;let o=await Wt.fromTemplate(a,{templateFormat:this.templateFormat}).format(t);return typeof s.image_url!="string"&&"url"in s.image_url?s.image_url.url=o:s.image_url=o,s}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let s of this.promptMessages)if(s instanceof ye)r.push(await this._parseImagePrompts(s,t));else{let a=s.inputVariables.reduce((o,l)=>{if(!(l in t)&&!(MT(s)&&s.optional))throw new Error(`Missing value for input variable \`${l.toString()}\``);return o[l]=t[l],o},{}),i=await s.formatMessages(a);r=r.concat(i)}return r}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}static fromTemplate(e,t){let r=Wt.fromTemplate(e,t),s=new Qu({prompt:r});return this.fromMessages([s])}static fromMessages(e,t){let r=e.reduce((i,o)=>i.concat(o instanceof n?o.promptMessages:[$T(o,t)]),[]),s=e.reduce((i,o)=>o instanceof n?Object.assign(i,o.partialVariables):i,Object.create(null)),a=new Set;for(let i of r)if(!(i instanceof ye))for(let o of i.inputVariables)o in s||a.add(o);return new this({...t,inputVariables:[...a],promptMessages:r,partialVariables:s,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}});var p_={};Gi(p_,{FewShotChatMessagePromptTemplate:()=>jf,FewShotPromptTemplate:()=>Mf});var Mf,jf,Lf=g(()=>{Mo();ja();La();zo();Mf=class n extends Fr{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),ws(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=await Promise.all(r.map(i=>this.examplePrompt.format(i))),a=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return Kt(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");let r=await Wt.deserialize(t),s;if(Array.isArray(e.examples))s=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new n({inputVariables:e.input_variables,examplePrompt:r,examples:s,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}},jf=class n extends Uo{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),ws(this.prefix+this.suffix,this.templateFormat,t)}}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t);r=r.map(a=>{let i={};return this.examplePrompt.inputVariables.forEach(o=>{i[o]=a[o]}),i});let s=[];for(let a of r){let i=await this.examplePrompt.formatMessages(a);s.push(...i)}return s}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=(await Promise.all(r.map(o=>this.examplePrompt.formatMessages(o)))).flat().map(o=>o.content),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return Kt(i,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}}});var Ur,Na=g(()=>{Mt();Ur=class extends X{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[a,i]of Object.entries(t))typeof i=="string"?r[a]=i:r[a]=await i();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(()=>(La(),Tf));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(()=>(La(),Tf));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>(Lf(),p_));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}});var Wv=C((b8,Kv)=>{Kv.exports=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,t=[],r=0;r<n.rangeCount;r++)t.push(n.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||t.forEach(function(s){n.addRange(s)}),e&&e.focus()}}});var Yv=C((w8,Zv)=>{"use strict";var Ek=Wv(),Jv={"text/plain":"Text","text/html":"Url",default:"Text"},Ik="Copy to clipboard: #{key}, Enter";function Ok(n){var e=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return n.replace(/#{\s*key\s*}/g,e)}function Pk(n,e){var t,r,s,a,i,o,l=!1;e||(e={}),t=e.debug||!1;try{s=Ek(),a=document.createRange(),i=document.getSelection(),o=document.createElement("span"),o.textContent=n,o.ariaHidden="true",o.style.all="unset",o.style.position="fixed",o.style.top=0,o.style.clip="rect(0, 0, 0, 0)",o.style.whiteSpace="pre",o.style.webkitUserSelect="text",o.style.MozUserSelect="text",o.style.msUserSelect="text",o.style.userSelect="text",o.addEventListener("copy",function(c){if(c.stopPropagation(),e.format)if(c.preventDefault(),typeof c.clipboardData>"u"){t&&console.warn("unable to use e.clipboardData"),t&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var d=Jv[e.format]||Jv.default;window.clipboardData.setData(d,n)}else c.clipboardData.clearData(),c.clipboardData.setData(e.format,n);e.onCopy&&(c.preventDefault(),e.onCopy(c.clipboardData))}),document.body.appendChild(o),a.selectNodeContents(o),i.addRange(a);var u=document.execCommand("copy");if(!u)throw new Error("copy command was unsuccessful");l=!0}catch(c){t&&console.error("unable to copy using execCommand: ",c),t&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",n),e.onCopy&&e.onCopy(window.clipboardData),l=!0}catch(d){t&&console.error("unable to copy using clipboardData: ",d),t&&console.error("falling back to prompt"),r=Ok("message"in e?e.message:Ik),window.prompt(r,n)}}finally{i&&(typeof i.removeRange=="function"?i.removeRange(a):i.removeAllRanges()),o&&document.body.removeChild(o),s()}return l}Zv.exports=Pk});var id={id:"acode.plugin.chatgpt",name:"AI Assistant Beta",main:"dist/main.js",version:"2.0.0",readme:"readme.md",icon:"icon.png",minVersionCode:290,files:["assets/ai_assistant.svg","assets/user_avatar.png","assets/insert-context.svg","assets/github-dark.css","assets/highlight.min.js","assets/markdown-it.min.js"],price:0,author:{name:"Raunak",email:"bajrangcoders@gmail.com",github:"bajrangCoder"}};var pm=`/*---------------------------------------*\\
 * Styles For Image generator
 * DALL-E
\\*---------------------------------------*/
.main-sidebar-cont * {
  box-sizing: border-box;
}
.main-sidebar-cont .sidebar-ai-heading {
  text-align: center;
  padding-bottom: 15px;
}
.main-sidebar-cont .prompt-area {
  width: 100%;
  font: initial;
  font-size: 0.9rem;
  padding: 10px;
  border-radius: 5px;
  border: 1px solid gray;
  outline: none;
  color: var(--primary-text-color);
  resize: none;
  margin-bottom: 8px;
  background: transparent;
}
.main-sidebar-cont .prompt-area:focus-visible {
  border-color: var(--button-background-color);
}
.main-sidebar-cont .size-selector {
  width: 100%;
  margin-bottom: 16px;
  background: transparent;
  padding: 10px;
  border-radius: 5px;
  border: 1px solid gray;
  outline: none;
  color: var(--primary-text-color);
}
.main-sidebar-cont .size-selector:focus-visible {
  border-color: var(--button-background-color);
}
.main-sidebar-cont .generatorBtn {
  border: none;
  background: var(--button-background-color);
  color: var(--button-text-color);
  padding: 10px 16px;
  border-top-left-radius: 15px;
  border-bottom-right-radius: 15px;
  font-weight: 600;
  font-size: 16px;
}
.main-sidebar-cont .img-fluid {
  max-width: 100%;
  margin-top: 10px;
}

/*---------------------------------------*\\
 * Styles For Text Generator
 * AI Assistant
\\*---------------------------------------*/
#acode-ai-assistant * {
  box-sizing: border-box;
}
#acode-ai-assistant .mainApp {
  position: absolute;
  left: 0;
  width: 100%;
  height: calc(100% - 80px);
  background: var(--primary-color);
}
#acode-ai-assistant .chatBox {
  height: 100%;
  width: 100%;
  white-space: pre-wrap;
  overflow-y: auto;
}
#acode-ai-assistant {
  /**
    * Display User input in chatBox
    */
}
#acode-ai-assistant .wrapper {
  padding-block: 12px;
  padding-inline: 10px;
}
#acode-ai-assistant .wrapper .chat {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}
#acode-ai-assistant .wrapper .chat .profile {
  height: 35px;
  width: 35px;
  border-radius: 8px;
  background: #5436da;
  display: flex;
  align-items: center;
  justify-content: center;
}
#acode-ai-assistant .wrapper .chat .profile img {
  width: 60%;
}
#acode-ai-assistant .wrapper .chat .message {
  flex: 1;
  color: var(--primary-text-color);
  font-size: 16px;
  line-height: 1.5;
  user-select: text;
}
#acode-ai-assistant {
  /**
    * Displat Ai response in chatBox
    */
}
#acode-ai-assistant .ai_wrapper {
  padding-block: 12px 30px;
  padding-inline: 10px;
  background-color: var(--secondary-color);
}
#acode-ai-assistant .ai_wrapper .ai_chat {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}
#acode-ai-assistant .ai_wrapper .ai_chat .ai_profile {
  height: 35px;
  width: 35px;
  border-radius: 8px;
  background: #10a37f;
  display: flex;
  align-items: center;
  justify-content: center;
}
#acode-ai-assistant .ai_wrapper .ai_chat .ai_profile img {
  width: 60%;
}
#acode-ai-assistant {
  /**
    * Highlights Code AREA
    * In Ai response
    */
}
#acode-ai-assistant .ai_wrapper .ai_message {
  flex: 1;
  color: var(--secondary-text-color);
  font-size: 16px;
  line-height: 1.5;
  overflow: hidden;
  user-select: text;
  /*
    code block in ai response
    */
}
#acode-ai-assistant .ai_wrapper .ai_message .codeBlock {
  border: 2px solid var(--border-color);
  width: 100%;
  border-radius: 5px;
  overflow-x: auto;
  position: relative;
}
#acode-ai-assistant .ai_wrapper .ai_message .codeBlock .copy-button {
  position: absolute;
  top: 4px;
  right: 8px;
  border: none;
  outline: none;
  border-radius: 8px;
  height: 24px;
  width: 28px;
  color: lightgray;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  background: rgb(26, 34, 46);
  box-shadow: 0 4px 0 #1b232f;
  transition: all 0.3s ease-in-out;
}
#acode-ai-assistant .ai_wrapper .ai_message .codeBlock .copy-button:active {
  box-shadow: 0;
  color: gray;
}
#acode-ai-assistant .ai_wrapper .ai_message .codeBlock .codesArea {
  box-sizing: border-box;
  padding: 12px;
  margin-bottom: 0;
}
#acode-ai-assistant .ai_wrapper .ai_message .codeBlock .codesArea::-webkit-scrollbar {
  height: 10px;
}
#acode-ai-assistant .ai_wrapper .ai_message .codeBlock .codesArea::-webkit-scrollbar-thumb {
  background: lightgray;
  border-radius: 4px;
}
#acode-ai-assistant .ai_wrapper .ai_message hr {
  margin: 1rem 0;
  color: inherit;
  border: 0;
  border-top: 1px solid;
  opacity: 0.25;
}
#acode-ai-assistant .ai_wrapper .ai_message h6,
#acode-ai-assistant .ai_wrapper .ai_message h5,
#acode-ai-assistant .ai_wrapper .ai_message h4,
#acode-ai-assistant .ai_wrapper .ai_message h3,
#acode-ai-assistant .ai_wrapper .ai_message h2,
#acode-ai-assistant .ai_wrapper .ai_message h1 {
  margin-top: 0;
  margin-bottom: 0.5rem;
  font-weight: 500;
  line-height: 1.2;
  color: inherit;
}
#acode-ai-assistant .ai_wrapper .ai_message h1 {
  font-size: calc(1.375rem + 1.5vw);
}
#acode-ai-assistant .ai_wrapper .ai_message h2 {
  font-size: calc(1.325rem + 0.9vw);
}
#acode-ai-assistant .ai_wrapper .ai_message h3 {
  font-size: calc(1.3rem + 0.6vw);
}
#acode-ai-assistant .ai_wrapper .ai_message h4 {
  font-size: calc(1.275rem + 0.3vw);
}
#acode-ai-assistant .ai_wrapper .ai_message h5 {
  font-size: 1.25rem;
}
#acode-ai-assistant .ai_wrapper .ai_message h6 {
  font-size: 1rem;
}
#acode-ai-assistant .ai_wrapper .ai_message p {
  margin-top: 0;
  margin-bottom: 1rem;
}
#acode-ai-assistant .ai_wrapper .ai_message ul,
#acode-ai-assistant .ai_wrapper .ai_message ol {
  margin: 1em 0;
  padding: 0 0 0 2em;
}
#acode-ai-assistant .ai_wrapper .ai_message ul {
  list-style-type: disc;
}
#acode-ai-assistant .ai_wrapper .ai_message li p:last-child {
  margin: 0;
}
#acode-ai-assistant .ai_wrapper .ai_message dt {
  font-weight: 700;
}
#acode-ai-assistant .ai_wrapper .ai_message dd {
  margin-bottom: 0.5rem;
  margin-left: 0;
}
#acode-ai-assistant .ai_wrapper .ai_message blockquote {
  margin: 0 0 1rem;
}
#acode-ai-assistant .ai_wrapper .ai_message b,
#acode-ai-assistant .ai_wrapper .ai_message strong {
  font-weight: bolder;
}
#acode-ai-assistant .ai_wrapper .ai_message small,
#acode-ai-assistant .ai_wrapper .ai_message .small {
  font-size: 0.875em;
}
#acode-ai-assistant .ai_wrapper .ai_message pre,
#acode-ai-assistant .ai_wrapper .ai_message code,
#acode-ai-assistant .ai_wrapper .ai_message kbd,
#acode-ai-assistant .ai_wrapper .ai_message samp {
  font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 1em;
}
#acode-ai-assistant .ai_wrapper .ai_message pre {
  display: block;
  margin-top: 0;
  margin-bottom: 1rem;
  overflow: auto;
  font-size: 0.875em;
}
#acode-ai-assistant .ai_wrapper .ai_message pre code {
  font-size: inherit;
  color: inherit;
}
#acode-ai-assistant .ai_wrapper .ai_message code {
  font-size: 0.875em;
  color: var(--link-text-color);
  word-wrap: break-word;
}
#acode-ai-assistant .ai_wrapper .ai_message a > code {
  color: inherit;
}
#acode-ai-assistant .ai_wrapper .ai_message kbd {
  padding: 0.1875rem 0.375rem;
  font-size: 0.875em;
  color: var(--primary-text-color);
  background-color: var(--popup-background-color);
  border-radius: 0.25rem;
}
#acode-ai-assistant .ai_wrapper .ai_message kbd kbd {
  padding: 0;
  font-size: 1em;
}
#acode-ai-assistant {
  /**
    * Error In ai response
    */
}
#acode-ai-assistant .error-box {
  border: 1px solid var(--error-text-color);
  color: var(--error-text-color);
  font-weight: 700;
  padding: 8px;
  white-space: pre-wrap;
  word-break: break-word;
  border-radius: 10px;
}
#acode-ai-assistant {
  /**
    * PROMPT AREA For CHATGPT
    */
}
#acode-ai-assistant .inputBox {
  position: fixed;
  bottom: 0;
  width: 100%;
  height: 80px;
  padding: 8px;
  display: flex;
  background-color: var(--popup-background-color);
  box-shadow: 0px -2px 4px var(--box-shadow-color);
  z-index: 1;
}
#acode-ai-assistant .chatTextarea {
  flex: 1;
  height: 100%;
  resize: none;
  border: none;
  outline: none;
  background: none;
  font: initial;
  font-size: 1.1rem;
  color: var(--primary-text-color);
  padding-inline-end: 8px;
}
#acode-ai-assistant .sendBtn {
  height: 40px;
  width: 40px;
  border-radius: 8px;
  border: none;
  outline: none;
  background-color: rgba(0, 0, 0, 0.2);
  color: gray;
  display: grid;
  place-items: center;
}
#acode-ai-assistant .sendBtn:active {
  background-color: var(--button-background-color);
  color: var(--primary-text-color);
}
#acode-ai-assistant .stopGenerationBtn {
  height: 40px;
  width: 40px;
  border-radius: 8px;
  border: none;
  outline: none;
  background-color: var(--button-background-color);
  color: var(--primary-text-color);
  display: grid;
  place-items: center;
}
#acode-ai-assistant .stopGenerationBtn:active {
  background-color: rgba(0, 0, 0, 0.2);
}
#acode-ai-assistant .hide {
  display: none;
}
#acode-ai-assistant .terminal-container {
  font-family: "Courier New", monospace;
  background: #1e1e1e;
  color: #00ff00;
  padding: 15px;
  border-radius: 8px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-all;
}
#acode-ai-assistant .multi-ai-container .active-ais {
  background: var(--secondary-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 15px;
  font-size: 14px;
}
#acode-ai-assistant .multi-ai-container .responses-container {
  background: var(--primary-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  max-height: 400px;
  overflow-y: auto;
}
#acode-ai-assistant .multi-ai-container .ai-response {
  border-bottom: 1px solid var(--border-color);
  padding: 12px;
}
#acode-ai-assistant .multi-ai-container .ai-response:last-child {
  border-bottom: none;
}
#acode-ai-assistant .multi-ai-container .ai-response .ai-header {
  font-weight: bold;
  color: var(--link-text-color);
  margin-bottom: 8px;
}
#acode-ai-assistant .multi-ai-container .ai-response .ai-content {
  color: var(--primary-text-color);
  line-height: 1.5;
}
#acode-ai-assistant .security-tools-container .scan-results {
  font-family: "Courier New", monospace;
  background: #0d1117;
  color: #58a6ff;
  border-radius: 8px;
  padding: 15px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-all;
}
#acode-ai-assistant .security-tools-container .tool-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}
#acode-ai-assistant .security-tools-container .tool-controls input, #acode-ai-assistant .security-tools-container .tool-controls select, #acode-ai-assistant .security-tools-container .tool-controls button {
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: var(--primary-color);
  color: var(--primary-text-color);
}
#acode-ai-assistant .security-tools-container .tool-controls button {
  cursor: pointer;
  transition: background-color 0.2s;
}
#acode-ai-assistant .security-tools-container .tool-controls button:hover {
  background: var(--button-background-color);
  color: var(--button-text-color);
}
#acode-ai-assistant .icon.terminal,
#acode-ai-assistant .icon.multi-ai,
#acode-ai-assistant .icon.security {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: 4px;
  transition: background-color 0.2s;
}
#acode-ai-assistant .icon.terminal:hover,
#acode-ai-assistant .icon.multi-ai:hover,
#acode-ai-assistant .icon.security:hover {
  background: rgba(255, 255, 255, 0.1);
}
#acode-ai-assistant .icon.terminal svg,
#acode-ai-assistant .icon.multi-ai svg,
#acode-ai-assistant .icon.security svg {
  width: 18px;
  height: 18px;
  fill: currentColor;
}
#acode-ai-assistant .code-execution-indicator {
  background: #ffeaa7;
  color: #2d3436;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  margin: 4px 0;
  display: inline-block;
}
#acode-ai-assistant .consensus-result {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px;
  border-radius: 8px;
  margin: 10px 0;
}
#acode-ai-assistant .consensus-result .consensus-header {
  font-weight: bold;
  margin-bottom: 10px;
}
#acode-ai-assistant .consensus-result .consensus-stats {
  display: flex;
  gap: 20px;
  margin-bottom: 10px;
  font-size: 14px;
}
#acode-ai-assistant .consensus-result .consensus-stats .stat {
  background: rgba(255, 255, 255, 0.2);
  padding: 4px 8px;
  border-radius: 4px;
}
#acode-ai-assistant .loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--link-text-color);
  animation: spin 1s ease-in-out infinite;
}
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
@media (max-width: 768px) {
  #acode-ai-assistant .multi-ai-container .tool-controls,
  #acode-ai-assistant .security-tools-container .tool-controls {
    flex-direction: column;
  }
}`;var fm;(function(n){n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(fm||(fm={}));var pl;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(pl||(pl={}));var fl;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(fl||(fl={}));var hm;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(hm||(hm={}));var mm;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(mm||(mm={}));var hl;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.OTHER="OTHER"})(hl||(hl={}));var gm;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(gm||(gm={}));var ym;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(ym||(ym={}));var bm;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(bm||(bm={}));var sR=[hl.RECITATION,hl.SAFETY];Pr();ms();Oa();var gP=typeof window=="object"?window:{},V="0123456789abcdef".split(""),yP=[-2147483648,8388608,32768,128],Vt=[24,16,8,0];var Oe=[];function Gt(n){n?(Oe[0]=Oe[16]=Oe[1]=Oe[2]=Oe[3]=Oe[4]=Oe[5]=Oe[6]=Oe[7]=Oe[8]=Oe[9]=Oe[10]=Oe[11]=Oe[12]=Oe[13]=Oe[14]=Oe[15]=0,this.blocks=Oe):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Gt.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===gP.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,s,a=n.length||0,i=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;r<a&&s<64;++r)i[s>>2]|=n[r]<<Vt[s++&3];else for(s=this.start;r<a&&s<64;++r)t=n.charCodeAt(r),t<128?i[s>>2]|=t<<Vt[s++&3]:t<2048?(i[s>>2]|=(192|t>>6)<<Vt[s++&3],i[s>>2]|=(128|t&63)<<Vt[s++&3]):t<55296||t>=57344?(i[s>>2]|=(224|t>>12)<<Vt[s++&3],i[s>>2]|=(128|t>>6&63)<<Vt[s++&3],i[s>>2]|=(128|t&63)<<Vt[s++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),i[s>>2]|=(240|t>>18)<<Vt[s++&3],i[s>>2]|=(128|t>>12&63)<<Vt[s++&3],i[s>>2]|=(128|t>>6&63)<<Vt[s++&3],i[s>>2]|=(128|t&63)<<Vt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Gt.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=yP[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};Gt.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4,a,i,o,l=this.blocks;for(i=16;i<80;++i)o=l[i-3]^l[i-8]^l[i-14]^l[i-16],l[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&t|~e&r,o=n<<5|n>>>27,s=o+a+s+1518500249+l[i]<<0,e=e<<30|e>>>2,a=n&e|~n&t,o=s<<5|s>>>27,r=o+a+r+1518500249+l[i+1]<<0,n=n<<30|n>>>2,a=s&n|~s&e,o=r<<5|r>>>27,t=o+a+t+1518500249+l[i+2]<<0,s=s<<30|s>>>2,a=r&s|~r&n,o=t<<5|t>>>27,e=o+a+e+1518500249+l[i+3]<<0,r=r<<30|r>>>2,a=t&r|~t&s,o=e<<5|e>>>27,n=o+a+n+1518500249+l[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)a=e^t^r,o=n<<5|n>>>27,s=o+a+s+1859775393+l[i]<<0,e=e<<30|e>>>2,a=n^e^t,o=s<<5|s>>>27,r=o+a+r+1859775393+l[i+1]<<0,n=n<<30|n>>>2,a=s^n^e,o=r<<5|r>>>27,t=o+a+t+1859775393+l[i+2]<<0,s=s<<30|s>>>2,a=r^s^n,o=t<<5|t>>>27,e=o+a+e+1859775393+l[i+3]<<0,r=r<<30|r>>>2,a=t^r^s,o=e<<5|e>>>27,n=o+a+n+1859775393+l[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)a=e&t|e&r|t&r,o=n<<5|n>>>27,s=o+a+s-1894007588+l[i]<<0,e=e<<30|e>>>2,a=n&e|n&t|e&t,o=s<<5|s>>>27,r=o+a+r-1894007588+l[i+1]<<0,n=n<<30|n>>>2,a=s&n|s&e|n&e,o=r<<5|r>>>27,t=o+a+t-1894007588+l[i+2]<<0,s=s<<30|s>>>2,a=r&s|r&n|s&n,o=t<<5|t>>>27,e=o+a+e-1894007588+l[i+3]<<0,r=r<<30|r>>>2,a=t&r|t&s|r&s,o=e<<5|e>>>27,n=o+a+n-1894007588+l[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)a=e^t^r,o=n<<5|n>>>27,s=o+a+s-899497514+l[i]<<0,e=e<<30|e>>>2,a=n^e^t,o=s<<5|s>>>27,r=o+a+r-899497514+l[i+1]<<0,n=n<<30|n>>>2,a=s^n^e,o=r<<5|r>>>27,t=o+a+t-899497514+l[i+2]<<0,s=s<<30|s>>>2,a=r^s^n,o=t<<5|t>>>27,e=o+a+e-899497514+l[i+3]<<0,r=r<<30|r>>>2,a=t^r^s,o=e<<5|e>>>27,n=o+a+n-899497514+l[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};Gt.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return V[n>>28&15]+V[n>>24&15]+V[n>>20&15]+V[n>>16&15]+V[n>>12&15]+V[n>>8&15]+V[n>>4&15]+V[n&15]+V[e>>28&15]+V[e>>24&15]+V[e>>20&15]+V[e>>16&15]+V[e>>12&15]+V[e>>8&15]+V[e>>4&15]+V[e&15]+V[t>>28&15]+V[t>>24&15]+V[t>>20&15]+V[t>>16&15]+V[t>>12&15]+V[t>>8&15]+V[t>>4&15]+V[t&15]+V[r>>28&15]+V[r>>24&15]+V[r>>20&15]+V[r>>16&15]+V[r>>12&15]+V[r>>8&15]+V[r>>4&15]+V[r&15]+V[s>>28&15]+V[s>>24&15]+V[s>>20&15]+V[s>>16&15]+V[s>>12&15]+V[s>>8&15]+V[s>>4&15]+V[s&15]};Gt.prototype.toString=Gt.prototype.hex;Gt.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};Gt.prototype.array=Gt.prototype.digest;Gt.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};var wf=n=>new Gt(!0).update(n).hex();sn();var Zw=(...n)=>wf(n.join("_"));var _f=class{},bP=new Map,qu=class n extends _f{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Zw(e,t))??null)}async update(e,t,r){this.cache.set(Zw(e,t),r)}static global(){return new n(bP)}};To();sn();xo();var e_=At(Qw(),1),OP=Object.defineProperty,PP=(n,e,t)=>e in n?OP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,TP=(n,e,t)=>(PP(n,typeof e!="symbol"?e+"":e,t),t);function SP(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){let a=n.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){let s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function CP(n,e){return n.length===1?[e.get(n.join(","))]:SP(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function kP(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var xf=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(n,e){this.patStr=n.pat_str;let t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{let[a,i,...o]=s.split(" "),l=Number.parseInt(i,10);return o.forEach((u,c)=>r[u]=l+c),r},{});for(let[r,s]of Object.entries(t)){let a=e_.default.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){let r=new RegExp(this.patStr,"ug"),s=xf.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):t);if(o.size>0){let u=xf.specialTokenRegex([...o]),c=n.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;s.lastIndex=c,u=s.exec(n),!(u==null||i.has(u[0]));)c=u.index+1;let d=u?.index??n.length;for(let f of n.substring(l,d).matchAll(r)){let h=this.textEncoder.encode(f[0]),m=this.rankMap.get(h.join(","));if(m!=null){a.push(m);continue}a.push(...CP(h,this.rankMap))}if(u==null)break;let p=this.specialTokens[u[0]];a.push(p),l=u.index+u[0].length}return a}decode(n){let e=[],t=0;for(let a=0;a<n.length;++a){let i=n[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}let r=new Uint8Array(t),s=0;for(let a of e)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},Gu=xf;TP(Gu,"specialTokenRegex",n=>new RegExp(n.map(e=>kP(e)).join("|"),"g"));function Af(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}xo();var Ku={},RP=new jr({});async function NP(n){return n in Ku||(Ku[n]=RP.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new Gu(e)).catch(e=>{throw delete Ku[n],e})),await Ku[n]}async function t_(n){return NP(Af(n))}Mt();var $P=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;var MP=()=>!1,So=class extends X{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??MP(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},Co=class extends So{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=qu.global():this.cache=void 0,this.caller=new jr(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await t_("modelName"in this?$P(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new Ta(e):Array.isArray(e)?new Sa(e.map(zt)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){let r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};Ea();Mt();Nu();Su();ar();ar();Mt();hs();var $e=class extends X{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let r=Z(t);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,t){let r=Z(t),s,a=!0;for await(let i of this._transformStreamWithConfig(e,o=>o,r))if(yield i,a)if(s===void 0)s=i;else try{s=qe(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new Pa(new cn({steps:e}))}};function ur(n){return typeof n?.parse=="function"}var Dr=class n extends Co{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){let r=n._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===n.prototype._streamResponseChunks)yield this.invoke(e,t);else{let s=n._convertInputToPromptValue(e).toChatMessages(),[a,i]=this._separateRunnableConfigFromCallOptionsCompat(t),o={...a.metadata,...this.getLsParams(i)},l=await Ne.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this?.invocationParams(i),batch_size:1},c=await l?.handleChatModelStart(this.toJSON(),[s],a.runId,void 0,u,void 0,void 0,a.runName),d;try{for await(let p of this._streamResponseChunks(s,i,c?.[0])){if(p.message.id==null){let f=c?.at(0)?.runId;f!=null&&p.message._updateId(`run-${f}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,d?d=d.concat(p):d=p}}catch(p){throw await Promise.all((c??[]).map(f=>f?.handleLLMError(p))),p}await Promise.all((c??[]).map(p=>p?.handleLLMEnd({generations:[[d]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,t,r){let s=e.map(f=>f.map(zt)),a={...r.metadata,...this.getLsParams(t)},i=await Ne.configure(r.callbacks,this.callbacks,r.tags,this.tags,a,this.metadata,{verbose:this.verbose}),o={options:t,invocation_params:this?.invocationParams(t),batch_size:1},l=await i?.handleChatModelStart(this.toJSON(),s,r.runId,void 0,o,void 0,void 0,r.runName),u=[],c=[];if(!!l?.[0].handlers.find(f=>vo(f)||_o(f))&&s.length===1&&this._streamResponseChunks!==n.prototype._streamResponseChunks)try{let f=await this._streamResponseChunks(s[0],t,l?.[0]),h;for await(let m of f){if(m.message.id==null){let y=l?.at(0)?.runId;y!=null&&m.message._updateId(`run-${y}`)}h===void 0?h=m:h=qe(h,m)}if(h===void 0)throw new Error("Received empty response from chat model call.");u.push([h]),await l?.[0].handleLLMEnd({generations:u,llmOutput:{}})}catch(f){throw await l?.[0].handleLLMError(f),f}else{let f=await Promise.allSettled(s.map((h,m)=>this._generate(h,{...t,promptIndex:m},l?.[m])));await Promise.all(f.map(async(h,m)=>{if(h.status==="fulfilled"){let y=h.value;for(let x of y.generations){if(x.message.id==null){let w=l?.at(0)?.runId;w!=null&&x.message._updateId(`run-${w}`)}x.message.response_metadata={...x.generationInfo,...x.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),u[m]=y.generations,c[m]=y.llmOutput,l?.[m]?.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await l?.[m]?.handleLLMError(h.reason),Promise.reject(h.reason)}))}let p={generations:u,llmOutput:c.length?this._combineLLMOutput?.(...c):void 0};return Object.defineProperty(p,Cu,{value:l?{runIds:l?.map(f=>f.runId)}:void 0,configurable:!0}),p}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:a}){let i=e.map(y=>y.map(zt)),o={...a.metadata,...this.getLsParams(s)},l=await Ne.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this?.invocationParams(s),batch_size:1,cached:!0},c=await l?.handleChatModelStart(this.toJSON(),i,a.runId,void 0,u,void 0,void 0,a.runName),d=[],f=(await Promise.allSettled(i.map(async(y,x)=>{let w=n._convertInputToPromptValue(y).toString(),A=await t.lookup(w,r);return A==null&&d.push(x),A}))).map((y,x)=>({result:y,runManager:c?.[x]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),h=[];await Promise.all(f.map(async({result:y,runManager:x},w)=>{if(y.status==="fulfilled"){let A=y.value;return h[w]=A,A.length&&await x?.handleLLMNewToken(A[0].text),x?.handleLLMEnd({generations:[A]})}else return await x?.handleLLMError(y.reason),Promise.reject(y.reason)}));let m={generations:h,missingPromptIndices:d};return Object.defineProperty(m,Cu,{value:c?{runIds:c?.map(y=>y.runId)}:void 0,configurable:!0}),m}async generate(e,t,r){let s;Array.isArray(t)?s={stop:t}:s=t;let a=e.map(f=>f.map(zt)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,o,i);let{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:i}),p={};if(d.length>0){let f=await this._generateUncached(d.map(h=>a[h]),o,i);await Promise.all(f.generations.map(async(h,m)=>{let y=d[m];c[y]=h;let x=n._convertInputToPromptValue(a[y]).toString();return l.update(x,u,h)})),p=f.llmOutput??{}}return{generations:c,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let s=e.map(a=>a.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(zt)],t,r)).generations[0][0].message}async callPrompt(e,t,r){let s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let s=new be(e),a=await this.call([s],t,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');let r=e,s=t?.name,a=r.description??"A function available to call.",i=t?.method,o=t?.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",u;ur(r)?u=[{type:"function",function:{name:l,description:a,parameters:Fe(r)}}]:("name"in r&&(l=r.name),u=[{type:"function",function:{name:l,description:a,parameters:r}}]);let c=this.bindTools(u),d=or.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");let y=m.tool_calls.find(x=>x.name===l);if(!y)throw new Error(`No tool call found with name ${l}.`);return y.args});if(!o)return c.pipe(d).withConfig({runName:"StructuredOutput"});let p=$e.assign({parsed:(m,y)=>d.invoke(m.raw,y)}),f=$e.assign({parsed:()=>null}),h=p.withFallbacks({fallbacks:[f]});return gt.from([{raw:c},h]).withConfig({runName:"StructuredOutputRunnable"})}},Wu=class extends Dr{async _generate(e,t,r){let s=await this._call(e,t,r),a=new se(s);if(typeof a.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:a.content,message:a}]}}};ms();Oa();ar();async function*r_(n,e,t){let r=n;r.startsWith("http://localhost:")&&(r=r.replace("http://localhost:","http://127.0.0.1:"));let s=await fetch(r,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",...t.headers},signal:t.signal});if(!s.ok){let l,u=await s.text();try{let c=JSON.parse(u);l=new Error(`Ollama call failed with status code ${s.status}: ${c.error}`)}catch{l=new Error(`Ollama call failed with status code ${s.status}: ${u}`)}throw l.response=s,l}if(!s.body)throw new Error("Could not begin Ollama stream. Please check the given URL and try again.");let a=Ee.fromReadableStream(s.body),i=new TextDecoder,o="";for await(let l of a){let c=(o+i.decode(l)).split(`
`);o=c.pop()||"";for(let d of c)try{yield JSON.parse(d)}catch{console.warn(`Received a non-JSON parseable chunk: ${d}`)}}}async function*n_(n,e,t){yield*r_(`${n}/api/generate`,e,t)}async function*s_(n,e,t){yield*r_(`${n}/api/chat`,e,t)}var Ju=class extends Wu{static lc_name(){return"ChatOllama"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama2"}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://localhost:11434"}),Object.defineProperty(this,"keepAlive",{enumerable:!0,configurable:!0,writable:!0,value:"5m"}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16KV",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGqa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model??this.model,this.baseUrl=e.baseUrl?.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl??this.baseUrl,this.keepAlive=e.keepAlive??this.keepAlive,this.embeddingOnly=e.embeddingOnly,this.f16KV=e.f16KV,this.frequencyPenalty=e.frequencyPenalty,this.headers=e.headers,this.logitsAll=e.logitsAll,this.lowVram=e.lowVram,this.mainGpu=e.mainGpu,this.mirostat=e.mirostat,this.mirostatEta=e.mirostatEta,this.mirostatTau=e.mirostatTau,this.numBatch=e.numBatch,this.numCtx=e.numCtx,this.numGpu=e.numGpu,this.numGqa=e.numGqa,this.numKeep=e.numKeep,this.numPredict=e.numPredict,this.numThread=e.numThread,this.penalizeNewline=e.penalizeNewline,this.presencePenalty=e.presencePenalty,this.repeatLastN=e.repeatLastN,this.repeatPenalty=e.repeatPenalty,this.ropeFrequencyBase=e.ropeFrequencyBase,this.ropeFrequencyScale=e.ropeFrequencyScale,this.temperature=e.temperature,this.stop=e.stop,this.tfsZ=e.tfsZ,this.topK=e.topK,this.topP=e.topP,this.typicalP=e.typicalP,this.useMLock=e.useMLock,this.useMMap=e.useMMap,this.vocabOnly=e.vocabOnly,this.format=e.format}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"ollama",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.temperature??void 0,ls_stop:this.stop,ls_max_tokens:t.options.num_predict}}_llmType(){return"ollama"}invocationParams(e){return{model:this.model,format:this.format,keep_alive:this.keepAlive,options:{embedding_only:this.embeddingOnly,f16_kv:this.f16KV,frequency_penalty:this.frequencyPenalty,logits_all:this.logitsAll,low_vram:this.lowVram,main_gpu:this.mainGpu,mirostat:this.mirostat,mirostat_eta:this.mirostatEta,mirostat_tau:this.mirostatTau,num_batch:this.numBatch,num_ctx:this.numCtx,num_gpu:this.numGpu,num_gqa:this.numGqa,num_keep:this.numKeep,num_predict:this.numPredict,num_thread:this.numThread,penalize_newline:this.penalizeNewline,presence_penalty:this.presencePenalty,repeat_last_n:this.repeatLastN,repeat_penalty:this.repeatPenalty,rope_frequency_base:this.ropeFrequencyBase,rope_frequency_scale:this.ropeFrequencyScale,temperature:this.temperature,stop:e?.stop??this.stop,tfs_z:this.tfsZ,top_k:this.topK,top_p:this.topP,typical_p:this.typicalP,use_mlock:this.useMLock,use_mmap:this.useMMap,vocab_only:this.vocabOnly}}}_combineLLMOutput(){return{}}async*_streamResponseChunksLegacy(e,t,r){let s=n_(this.baseUrl,{...this.invocationParams(t),prompt:this._formatMessagesAsPrompt(e)},{...t,headers:this.headers});for await(let a of s)a.done?yield new Ie({text:"",message:new le({content:""}),generationInfo:{model:a.model,total_duration:a.total_duration,load_duration:a.load_duration,prompt_eval_count:a.prompt_eval_count,prompt_eval_duration:a.prompt_eval_duration,eval_count:a.eval_count,eval_duration:a.eval_duration}}):(yield new Ie({text:a.response,message:new le({content:a.response})}),await r?.handleLLMNewToken(a.response??""))}async*_streamResponseChunks(e,t,r){try{let s=await this.caller.call(async()=>s_(this.baseUrl,{...this.invocationParams(t),messages:this._convertMessagesToOllamaMessages(e)},{...t,headers:this.headers}));for await(let a of s)a.done?yield new Ie({text:"",message:new le({content:""}),generationInfo:{model:a.model,total_duration:a.total_duration,load_duration:a.load_duration,prompt_eval_count:a.prompt_eval_count,prompt_eval_duration:a.prompt_eval_duration,eval_count:a.eval_count,eval_duration:a.eval_duration}}):(yield new Ie({text:a.message.content,message:new le({content:a.message.content})}),await r?.handleLLMNewToken(a.message.content??""))}catch(s){if(s.response?.status===404)console.warn("[WARNING]: It seems you are using a legacy version of Ollama. Please upgrade to a newer version for better chat support."),yield*this._streamResponseChunksLegacy(e,t,r);else throw s}}_convertMessagesToOllamaMessages(e){return e.map(t=>{let r;if(t._getType()==="human")r="user";else if(t._getType()==="ai")r="assistant";else if(t._getType()==="system")r="system";else throw new Error(`Unsupported message type for Ollama: ${t._getType()}`);let s="",a=[];if(typeof t.content=="string")s=t.content;else for(let i of t.content)if(i.type==="text")s=`${s}
${i.text}`;else if(i.type==="image_url"&&typeof i.image_url=="string"){let o=i.image_url.split(",");a.push(o[1]??o[0])}else throw new Error('Unsupported message content type. Must either have type "text" or type "image_url" with a string "image_url" field.');return{role:r,content:s,images:a}})}_formatMessagesAsPrompt(e){return e.map(r=>{let s;return r._getType()==="human"?s=`[INST] ${r.content} [/INST]`:r._getType()==="ai"?s=r.content:r._getType()==="system"?s=`<<SYS>> ${r.content} <</SYS>>`:Ce.isInstance(r)?s=`

${r.role[0].toUpperCase()}${r.role.slice(1)}: ${r.content}`:(console.warn(`Unsupported message type passed to Ollama: "${r._getType()}"`),s=""),s}).join(`
`)}async _call(e,t,r){let s=[];for await(let a of this._streamResponseChunks(e,t,r))s.push(a.message.content);return s.join("")}};da();ms();var Ef=class extends mt{addUserMessage(e){return this.addMessage(new be(e))}addAIChatMessage(e){return this.addMessage(new se(e))}addAIMessage(e){return this.addMessage(new se(e))}async addMessages(e){for(let t of e)await this.addMessage(t)}clear(){throw new Error("Not implemented.")}},ko=class extends Ef{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}};Mt();hs();Mt();hs();Mt();hs();ar();ms();Mt();var Ro=class extends ir{constructor(e){let t=or.from((i,o)=>this._enterHistory(i,o??{})).withConfig({runName:"loadHistory"}),r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=$e.assign({[r]:t}).withConfig({runName:"insertHistory"}));let s=t.pipe(e.runnable.withListeners({onEnd:(i,o)=>this._exitHistory(i,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),a=e.config??{};super({...e,config:a,bound:s}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!st(e)){let r;this.inputMessagesKey?r=this.inputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="input",Array.isArray(e[r])&&Array.isArray(e[r][0])?t=e[r][0]:t=e[r]}else t=e;if(typeof t=="string")return[new be(t)];if(Array.isArray(t))return t;if(st(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!st(e)&&typeof e!="string"){let r;this.outputMessagesKey!==void 0?r=this.outputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[r]}else t=e;if(typeof t=="string")return[new se(t)];if(Array.isArray(t))return t;if(st(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){let s=await(t?.configurable?.messageHistory).getMessages();return this.historyMessagesKey===void 0?s.concat(this._getInputMessages(e)):s}async _exitHistory(e,t){let r=t.configurable?.messageHistory,s;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?s=e.inputs[0]:s=e.inputs;let a=this._getInputMessages(s);if(this.historyMessagesKey===void 0){let l=await r.getMessages();a=a.slice(l.length)}let i=e.outputs;if(!i)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);let o=this._getOutputMessages(i);await r.addMessages([...a,...o])}async _mergeConfig(...e){let t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){let s={[this.inputMessagesKey??"input"]:"foo"},a={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(s)}, ${JSON.stringify(a)})`)}let{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}};var No=class extends X{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s?.callbacks),e,{...t,runType:"parser"})}},Ca=class extends No{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}},cr=class extends Error{constructor(e,t,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=s,s&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}};Bt();sn();Oa();function $o(n,e){let t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;let r=n.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!$o(n[s],e[s]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;let r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(let i of r)if(!$o(n[i],e[i]))return!1;return!0}return n===e}var oU=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");var LP=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,DP=[0,31,28,31,30,31,30,31,31,30,31,30,31],FP=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,UP=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,BP=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,zP=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,qP=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,HP=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,VP=/^(?:\/(?:[^~/]|~0|~1)*)*$/,GP=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,KP=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,WP=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,JP=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,ZP=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,YP=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,XP=n=>{if(n[0]==='"')return!1;let[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},QP=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,eT=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,tT=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function ut(n){return n.test.bind(n)}var rT={date:a_,time:i_.bind(void 0,!1),"date-time":iT,duration:tT,uri:uT,"uri-reference":ut(BP),"uri-template":ut(zP),url:ut(qP),email:XP,hostname:ut(UP),ipv4:ut(QP),ipv6:ut(eT),regex:dT,uuid:ut(HP),"json-pointer":ut(VP),"json-pointer-uri-fragment":ut(GP),"relative-json-pointer":ut(KP)},nT={...rT,date:ut(WP),time:ut(JP),"date-time":ut(ZP),"uri-reference":ut(YP)};function sT(n){return n%4===0&&(n%100!==0||n%400===0)}function a_(n){let e=n.match(LP);if(!e)return!1;let t=+e[1],r=+e[2],s=+e[3];return r>=1&&r<=12&&s>=1&&s<=(r==2&&sT(t)?29:DP[r])}function i_(n,e){let t=e.match(FP);if(!t)return!1;let r=+t[1],s=+t[2],a=+t[3],i=!!t[5];return(r<=23&&s<=59&&a<=59||r==23&&s==59&&a==60)&&(!n||i)}var aT=/t|\s/i;function iT(n){let e=n.split(aT);return e.length==2&&a_(e[0])&&i_(!0,e[1])}var oT=/\/|:/,lT=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function uT(n){return oT.test(n)&&lT.test(n)}var cT=/[^\\]\\Z/;function dT(n){if(cT.test(n))return!1;try{return new RegExp(n),!0}catch{return!1}}var ys=class extends Ca{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},bs=class extends ys{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,r;for await(let s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(Sg(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ie({message:s,text:s.content})}else if(st(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ie({message:Zd(s),text:s.content})}else a=new Ht({text:s});r===void 0?r=a:r=r.concat(a);let i=await this.parsePartialResult([r]);i!=null&&!$o(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}};var Zu=class extends ys{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,r)=>t+this._messageContentComplexToString(r),"")}};es();Pr();var ka=class extends Ca{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=rt.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,rt.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Fe(this.schema))}
\`\`\`
`}async parse(e){try{let r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(t){throw new cr(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};Vp();Gd();var Ra=class extends bs{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?Ou(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Vd(e[0].text)}async parse(e){return Vd(e,JSON.parse)}getFormatInstructions(){return""}};Na();zo();Lf();Na();zo();La();Mo();ja();Sf();zo();var f_=["user","model","function","system"],h_;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(h_||(h_={}));var m_;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(m_||(m_={}));var g_;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(g_||(g_={}));var y_;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(y_||(y_={}));var tc;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.OTHER="OTHER"})(tc||(tc={}));var b_;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(b_||(b_={}));var w_;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(w_||(w_={}));var __;(function(n){n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(__||(__={}));var Xe=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},dn=class extends Xe{constructor(e,t){super(e),this.response=t}};var jT="https://generativelanguage.googleapis.com",LT="v1beta",DT="0.7.1",FT="genai-js",_s;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(_s||(_s={}));var rc=class{constructor(e,t,r,s,a){this.model=e,this.task=t,this.apiKey=r,this.stream=s,this.requestOptions=a}toString(){var e,t;let r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||LT,a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||jT}/${r}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}};function UT(n){let e=[];return n?.apiClient&&e.push(n.apiClient),e.push(`${FT}/${DT}`),e.join(" ")}async function BT(n){let e=new Headers;return e.append("Content-Type","application/json"),e.append("x-goog-api-client",UT(n.requestOptions)),e.append("x-goog-api-key",n.apiKey),e}async function zT(n,e,t,r,s,a){let i=new rc(n,e,t,r,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},HT(a)),{method:"POST",headers:await BT(i),body:s})}}async function Vo(n,e,t,r,s,a){return qT(n,e,t,r,s,a,fetch)}async function qT(n,e,t,r,s,a,i=fetch){let o=new rc(n,e,t,r,a),l;try{let u=await zT(n,e,t,r,s,a);if(l=await i(u.url,u.fetchOptions),!l.ok){let c="";try{let d=await l.json();c=d.error.message,d.error.details&&(c+=` ${JSON.stringify(d.error.details)}`)}catch{}throw new Error(`[${l.status} ${l.statusText}] ${c}`)}}catch(u){let c=new Xe(`Error fetching from ${o.toString()}: ${u.message}`);throw c.stack=u.stack,c}return l}function HT(n){let e={};if(n?.timeout>=0){let t=new AbortController,r=t.signal;setTimeout(()=>t.abort(),n.timeout),e.signal=r}return e}function Bf(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ec(n.candidates[0]))throw new dn(`${pn(n)}`,n);return VT(n)}else if(n.promptFeedback)throw new dn(`Text not available. ${pn(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ec(n.candidates[0]))throw new dn(`${pn(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),v_(n)[0]}else if(n.promptFeedback)throw new dn(`Function call not available. ${pn(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ec(n.candidates[0]))throw new dn(`${pn(n)}`,n);return v_(n)}else if(n.promptFeedback)throw new dn(`Function call not available. ${pn(n)}`,n)},n}function VT(n){var e,t,r,s;return!((s=(r=(t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0?void 0:t.parts)===null||r===void 0?void 0:r[0])===null||s===void 0)&&s.text?n.candidates[0].content.parts.map(({text:a})=>a).join(""):""}function v_(n){var e,t,r,s;let a=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let i of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)i.functionCall&&a.push(i.functionCall);if(a.length>0)return a}var GT=[tc.RECITATION,tc.SAFETY];function ec(n){return!!n.finishReason&&GT.includes(n.finishReason)}function pn(n){var e,t,r;let s="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)s+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){let a=n.candidates[0];ec(a)&&(s+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(s+=`: ${a.finishMessage}`))}return s}function qo(n){return this instanceof qo?(this.v=n,this):new qo(n)}function KT(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,a=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(p){r[p]&&(s[p]=function(f){return new Promise(function(h,m){a.push([p,f,h,m])>1||o(p,f)})})}function o(p,f){try{l(r[p](f))}catch(h){d(a[0][3],h)}}function l(p){p.value instanceof qo?Promise.resolve(p.value.v).then(u,c):d(a[0][2],p)}function u(p){o("next",p)}function c(p){o("throw",p)}function d(p,f){p(f),a.shift(),a.length&&o(a[0][0],a[0][1])}}var x_=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function WT(n){let e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=YT(e),[r,s]=t.tee();return{stream:ZT(r),response:JT(s)}}async function JT(n){let e=[],t=n.getReader();for(;;){let{done:r,value:s}=await t.read();if(r)return Bf(XT(e));e.push(s)}}function ZT(n){return KT(this,arguments,function*(){let t=n.getReader();for(;;){let{value:r,done:s}=yield qo(t.read());if(s)break;yield yield qo(Bf(r))}})}function YT(n){let e=n.getReader();return new ReadableStream({start(r){let s="";return a();function a(){return e.read().then(({value:i,done:o})=>{if(o){if(s.trim()){r.error(new Xe("Failed to parse stream"));return}r.close();return}s+=i;let l=s.match(x_),u;for(;l;){try{u=JSON.parse(l[1])}catch{r.error(new Xe(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(u),s=s.substring(l[0].length),l=s.match(x_)}return a()})}}})}function XT(n){let e=n[n.length-1],t={promptFeedback:e?.promptFeedback};for(let r of n)if(r.candidates)for(let s of r.candidates){let a=s.index;if(t.candidates||(t.candidates=[]),t.candidates[a]||(t.candidates[a]={index:s.index}),t.candidates[a].citationMetadata=s.citationMetadata,t.candidates[a].finishReason=s.finishReason,t.candidates[a].finishMessage=s.finishMessage,t.candidates[a].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[a].content||(t.candidates[a].content={role:s.content.role||"user",parts:[]});let i={};for(let o of s.content.parts)o.text&&(i.text=o.text),o.functionCall&&(i.functionCall=o.functionCall),Object.keys(i).length===0&&(i.text=""),t.candidates[a].content.parts.push(i)}}return t}async function O_(n,e,t,r){let s=await Vo(e,_s.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return WT(s)}async function P_(n,e,t,r){let a=await(await Vo(e,_s.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:Bf(a)}}function nc(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(let t of n)typeof t=="string"?e.push({text:t}):e.push(t);return QT(e)}function QT(n){let e={role:"user",parts:[]},t={role:"function",parts:[]},r=!1,s=!1;for(let a of n)"functionResponse"in a?(t.parts.push(a),s=!0):(e.parts.push(a),r=!0);if(r&&s)throw new Xe("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new Xe("No content is provided for sending chat message.");return r?e:t}function Df(n){return n.contents?n:{contents:[nc(n)]}}function eS(n){return typeof n=="string"||Array.isArray(n)?{content:nc(n)}:n}var A_=["text","inlineData","functionCall","functionResponse"],tS={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall"],system:["text"]},E_={user:["model"],function:["model"],model:["user","function"],system:[]};function rS(n){let e;for(let t of n){let{role:r,parts:s}=t;if(!e&&r!=="user")throw new Xe(`First content should be with role 'user', got ${r}`);if(!f_.includes(r))throw new Xe(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(f_)}`);if(!Array.isArray(s))throw new Xe("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new Xe("Each Content should have at least one part");let a={text:0,inlineData:0,functionCall:0,functionResponse:0};for(let o of s)for(let l of A_)l in o&&(a[l]+=1);let i=tS[r];for(let o of A_)if(!i.includes(o)&&a[o]>0)throw new Xe(`Content with role '${r}' can't contain '${o}' part`);if(e&&!E_[r].includes(e.role))throw new Xe(`Content with role '${r}' can't follow '${e.role}'. Valid previous roles: ${JSON.stringify(E_)}`);e=t}}var I_="SILENT_ERROR",Ff=class{constructor(e,t,r,s){this.model=t,this.params=r,this.requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r?.history&&(rS(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,r,s,a,i;await this._sendPromise;let o=nc(e),l={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(i=this.params)===null||i===void 0?void 0:i.systemInstruction,contents:[...this._history,o]},u;return this._sendPromise=this._sendPromise.then(()=>P_(this._apiKey,this.model,l,this.requestOptions)).then(c=>{var d;if(c.response.candidates&&c.response.candidates.length>0){this._history.push(o);let p=Object.assign({parts:[],role:"model"},(d=c.response.candidates)===null||d===void 0?void 0:d[0].content);this._history.push(p)}else{let p=pn(c.response);p&&console.warn(`sendMessage() was unsuccessful. ${p}. Inspect response object for details.`)}u=c}),await this._sendPromise,u}async sendMessageStream(e){var t,r,s,a,i;await this._sendPromise;let o=nc(e),l={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(i=this.params)===null||i===void 0?void 0:i.systemInstruction,contents:[...this._history,o]},u=O_(this._apiKey,this.model,l,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>u).catch(c=>{throw new Error(I_)}).then(c=>c.response).then(c=>{if(c.candidates&&c.candidates.length>0){this._history.push(o);let d=Object.assign({},c.candidates[0].content);d.role||(d.role="model"),this._history.push(d)}else{let d=pn(c);d&&console.warn(`sendMessageStream() was unsuccessful. ${d}. Inspect response object for details.`)}}).catch(c=>{c.message!==I_&&console.error(c)}),u}};async function nS(n,e,t,r){return(await Vo(e,_s.COUNT_TOKENS,n,!1,JSON.stringify(Object.assign(Object.assign({},t),{model:e})),r)).json()}async function sS(n,e,t,r){return(await Vo(e,_s.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function aS(n,e,t,r){let s=t.requests.map(i=>Object.assign(Object.assign({},i),{model:e}));return(await Vo(e,_s.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:s}),r)).json()}var Uf=class{constructor(e,t,r){this.apiKey=e,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=t.systemInstruction,this.requestOptions=r||{}}async generateContent(e){let t=Df(e);return P_(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}async generateContentStream(e){let t=Df(e);return O_(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}startChat(e){return new Ff(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}async countTokens(e){let t=Df(e);return nS(this.apiKey,this.model,t,this.requestOptions)}async embedContent(e){let t=eS(e);return sS(this.apiKey,this.model,t,this.requestOptions)}async batchEmbedContents(e){return aS(this.apiKey,this.model,e,this.requestOptions)}};var Ho=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new Xe("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Uf(this.apiKey,e,t)}};_a();Pr();function T_(n){let e={...n};if(Object.hasOwn(e,"additionalProperties")&&delete e.additionalProperties,e.properties){let t=Object.keys(e.properties);S_(e.properties,t,0)}return e}function S_(n,e,t){if(t>=e.length||!n)return;let r=e[t];n[r]=T_(n[r]),S_(n,e,t+1)}function sc(n){let e=T_(Fe(n)),{$schema:t,...r}=e;return r}Pr();Mt();function C_(n,e){let t=typeof e=="number"?void 0:e;return{name:n.name,description:n.description,parameters:Fe(n.schema),...t?.strict!==void 0?{strict:t.strict}:{}}}function Ua(n,e){let t=typeof e=="number"?void 0:e,r;return lS(n)?r={type:"function",function:C_(n)}:r=n,t?.strict!==void 0&&(r.function.strict=t.strict),r}function zf(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function iS(n){return n!==void 0&&X.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function oS(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&ur(n.schema)}function lS(n){return oS(n)||iS(n)||zf(n)}function uS(n){let e=n._getType();return Ce.isInstance(n)?n.role:n.name??e}function cS(n){switch(n){case"ai":case"model":return"model";case"system":case"human":return"user";default:throw new Error(`Unknown / unsupported author: ${n}`)}}function dS(n){if("mimeType"in n&&"data"in n)return{inlineData:{mimeType:n.mimeType,data:n.data}};throw new Error("Invalid media content")}function pS(n,e){return typeof n=="string"?[{text:n}]:n.map(t=>{if(t.type==="text")return{text:t.text};if(t.type==="image_url"){if(!e)throw new Error("This model does not support images");let r;if(typeof t.image_url=="string")r=t.image_url;else if(typeof t.image_url=="object"&&"url"in t.image_url)r=t.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");let[s,a]=r.split(",");if(!s.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");let[i,o]=s.replace(/^data:/,"").split(";");if(o!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:a,mimeType:i}}}else if(t.type==="media")return dS(t);throw new Error(`Unknown content type ${t.type}`)})}function qf(n,e){return n.reduce((t,r,s)=>{if(!st(r))throw new Error("Unsupported message input");let a=uS(r);if(a==="system"&&s!==0)throw new Error("System message should be the first one");let i=cS(a),o=t.content[t.content.length];if(!t.mergeWithPreviousContent&&o&&o.role===i)throw new Error("Google Generative AI requires alternate messages between authors");let l=pS(r.content,e);if(t.mergeWithPreviousContent){let c=t.content[t.content.length-1];if(!c)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return c.parts.push(...l),{mergeWithPreviousContent:!1,content:t.content}}let u={role:i,parts:l};return{mergeWithPreviousContent:a==="system",content:[...t.content,u]}},{content:[],mergeWithPreviousContent:!1}).content}function k_(n){if(!n.candidates||n.candidates.length===0||!n.candidates[0])return{generations:[],llmOutput:{filters:n.promptFeedback}};let e=n.functionCalls(),[t]=n.candidates,{content:r,...s}=t,a=r?.parts[0]?.text??"";return{generations:[{text:a,message:new se({content:a,tool_calls:e,additional_kwargs:{...s}}),generationInfo:s}]}}function R_(n){if(!n.candidates||n.candidates.length===0)return null;let[e]=n.candidates,{content:t,...r}=e,s=t?.parts[0]?.text??"";return new Ie({text:s,message:new le({content:s,name:t?t.role:void 0,additional_kwargs:{}}),generationInfo:r})}function Hf(n){return n.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?n:[{functionDeclarations:n.map(e=>{if(zf(e)){let t=sc(e.schema);return{name:e.name,description:e.description,parameters:t}}return e})}]}var Go=class extends No{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new cr(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){let t=e.flatMap(a=>{let{message:i}=a;return!("tool_calls"in i)||!Array.isArray(i.tool_calls)?[]:i.tool_calls});if(t[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");let[r]=t;return await this._validateResult(r.args)}};var ac=class extends Dr{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=e?.model?.replace(/^models\//,"")??e?.modelName?.replace(/^models\//,"")??this.model,this.model=this.modelName,this.maxOutputTokens=e?.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e?.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>1))throw new Error("`temperature` must be in the range of [0.0,1.0]");if(this.topP=e?.topP??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=e?.topK??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=e?.stopSequences??this.stopSequences,this.apiKey=e?.apiKey??Q("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e?.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(r=>r.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=e?.streaming??this.streaming,this.client=new Ho(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK}},{apiVersion:e?.apiVersion,baseUrl:e?.baseUrl})}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){return this.bind({tools:Hf(e),...t})}invocationParams(e){let t=e?.tools;return Array.isArray(t)&&!t.some(r=>!("lc_namespace"in r))?{tools:Hf(e?.tools)}:{tools:e?.tools}}async _generate(e,t,r){let s=qf(e,this._isMultimodalModel),a=this.invocationParams(t);if(this.streaming){let l={},u=this._streamResponseChunks(e,t,r),c={};for await(let p of u){let f=p.generationInfo?.completion??0;c[f]===void 0?c[f]=p:c[f]=c[f].concat(p)}return{generations:Object.entries(c).sort(([p],[f])=>parseInt(p,10)-parseInt(f,10)).map(([p,f])=>f),llmOutput:{estimatedTokenUsage:l}}}let i=await this.caller.callWithOptions({signal:t?.signal},async()=>{let l;try{l=await this.client.generateContent({...a,contents:s})}catch(u){throw u.message?.includes("400 Bad Request")&&(u.status=400),u}return l}),o=k_(i.response);return await r?.handleLLMNewToken(o.generations[0].text??""),o}async*_streamResponseChunks(e,t,r){let s=qf(e,this._isMultimodalModel),a=this.invocationParams(t),i=await this.caller.callWithOptions({signal:t?.signal},async()=>{let{stream:o}=await this.client.generateContentStream({...a,contents:s});return o});for await(let o of i){let l=R_(o);l&&(yield l,await r?.handleLLMNewToken(l.text??""))}}withStructuredOutput(e,t){let r=e,s=t?.name,a=t?.method,i=t?.includeRaw;if(a==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "functionCalling" as a method.');let o=s??"extract",l,u;if(ur(r)){let h=sc(r);u=[{functionDeclarations:[{name:o,description:h.description??"A function available to call.",parameters:h}]}],l=new Go({returnSingle:!0,keyName:o,zodSchema:r})}else{let h;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(h=r,o=r.name):h={name:o,description:r.description??"",parameters:r},u=[{functionDeclarations:[h]}],l=new Go({returnSingle:!0,keyName:o})}let c=this.bind({tools:u});if(!i)return c.pipe(l).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});let d=$e.assign({parsed:(h,m)=>l.invoke(h.raw,m)}),p=$e.assign({parsed:()=>null}),f=d.withFallbacks({fallbacks:[p]});return gt.from([{raw:c},f]).withConfig({runName:"StructuredOutputRunnable"})}};xo();Pr();var vs="0.3.3";var $_=!1,xs,Vf,hS,mS,gS,Gf,yS,ic,Kf,Wf,Jf,oc,Zf;function M_(n,e={auto:!1}){if($_)throw new Error(`you must \`import 'groq-sdk/shims/${n.kind}'\` before importing anything else from groq-sdk`);if(xs)throw new Error(`can't \`import 'groq-sdk/shims/${n.kind}'\` after \`import 'groq-sdk/shims/${xs}'\``);$_=e.auto,xs=n.kind,Vf=n.fetch,hS=n.Request,mS=n.Response,gS=n.Headers,Gf=n.FormData,yS=n.Blob,ic=n.File,Kf=n.ReadableStream,Wf=n.getMultipartRequestOptions,Jf=n.getDefaultAgent,oc=n.fileFromPath,Zf=n.isFsReadStream}var lc=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function j_({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n",t,r,s,a;try{t=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new lc(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:i=>!1}}xs||M_(j_(),{auto:!0});var Yf={};Gi(Yf,{APIConnectionError:()=>Br,APIConnectionTimeoutError:()=>As,APIError:()=>_e,APIUserAbortError:()=>fn,AuthenticationError:()=>za,BadRequestError:()=>Ba,ConflictError:()=>Va,GroqError:()=>Pe,InternalServerError:()=>Wa,NotFoundError:()=>Ha,PermissionDeniedError:()=>qa,RateLimitError:()=>Ka,UnprocessableEntityError:()=>Ga});var Pe=class extends Error{},_e=class n extends Pe{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new Br({cause:uc(t)});let a=t;return e===400?new Ba(e,a,r,s):e===401?new za(e,a,r,s):e===403?new qa(e,a,r,s):e===404?new Ha(e,a,r,s):e===409?new Va(e,a,r,s):e===422?new Ga(e,a,r,s):e===429?new Ka(e,a,r,s):e>=500?new Wa(e,a,r,s):new n(e,a,r,s)}},fn=class extends _e{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Br=class extends _e{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},As=class extends Br{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ba=class extends _e{constructor(){super(...arguments),this.status=400}},za=class extends _e{constructor(){super(...arguments),this.status=401}},qa=class extends _e{constructor(){super(...arguments),this.status=403}},Ha=class extends _e{constructor(){super(...arguments),this.status=404}},Va=class extends _e{constructor(){super(...arguments),this.status=409}},Ga=class extends _e{constructor(){super(...arguments),this.status=422}},Ka=class extends _e{constructor(){super(...arguments),this.status=429}},Wa=class extends _e{};var cc=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1,s=new Xf;async function*a(){if(!e.body)throw t.abort(),new Pe("Attempted to iterate over a response with no body");let o=new Ja,l=L_(e.body);for await(let u of l)for(let c of o.decode(u)){let d=s.decode(c);d&&(yield d)}for(let u of o.flush()){let c=s.decode(u);c&&(yield c)}}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(let l of a())if(!o){if(l.data.startsWith("[DONE]")){o=!0;continue}if(l.event===null){let u;try{u=JSON.parse(l.data)}catch(c){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),c}if(u&&u.error)throw new _e(void 0,u.error,void 0,void 0);yield u}}o=!0}catch(l){if(l instanceof Error&&l.name==="AbortError")return;throw l}finally{o||t.abort()}}return new n(i,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let i=new Ja,o=L_(e);for await(let l of o)for(let u of i.decode(l))yield u;for(let l of i.flush())yield l}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new n(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new n(()=>s(e),this.controller),new n(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new Kf({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:a,done:i}=await t.next();if(i)return s.close();let o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){await t.return?.()}})}},Xf=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=wS(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}},Ja=class n{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=n.NEWLINE_CHARS.has(t[t.length-1]||""),s=t.split(n.NEWLINE_REGEXP);return s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Pe(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Pe(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Pe("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};Ja.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);Ja.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function wS(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function L_(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var D_=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",_S=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&F_(n),F_=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",vS=n=>_S(n)||D_(n)||Zf(n);async function th(n,e,t={}){if(n=await n,D_(n)){let s=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new ic([s],e,t)}let r=await xS(n);if(e||(e=ES(n)??"unknown_file"),!t.type){let s=r[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new ic(r,e,t)}async function xS(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(F_(n))e.push(await n.arrayBuffer());else if(IS(n))for await(let t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${AS(n)}`);return e}function AS(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function ES(n){return Qf(n.name)||Qf(n.filename)||Qf(n.path)?.split(/[\\/]/).pop()}var Qf=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},IS=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",rh=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var Ko=async n=>{let e=await U_(n.body);return Wf(e,n)},U_=async n=>{let e=new Gf;return await Promise.all(Object.entries(n||{}).map(([t,r])=>eh(e,t,r))),e};var eh=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(vS(t)){let r=await th(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>eh(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>eh(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var PS=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},TS=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},dc;async function G_(n){let{response:e}=n;if(n.options.stream)return Za("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):cc.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let t=e.headers.get("content-type");if(t?.includes("application/json")||t?.includes("application/vnd.api+json")){let a=await e.json();return Za("response",e.status,e.url,e.headers,a),a}let s=await e.text();return Za("response",e.status,e.url,e.headers,s),s}var pc=class n extends Promise{constructor(e,t=G_){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},fc=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e4,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=nh("maxRetries",t),this.timeout=nh("timeout",r),this.httpAgent=s,this.fetch=a??Vf}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...RS(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${FS()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){let{method:t,path:r,query:s,headers:a={}}=e,i=rh(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(i),l=this.buildURL(r,s);"timeout"in e&&nh("timeout",e.timeout);let u=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??Jf(l),d=u+1e3;typeof c?.options?.timeout=="number"&&d>(c.options.timeout??0)&&(c.options.timeout=d),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:e,headers:a,contentLength:o});return{req:{method:t,...i&&{body:i},headers:p,...c&&{agent:c},signal:e.signal??null},url:l,timeout:u}}buildHeaders({options:e,headers:t,contentLength:r}){let s={};r&&(s["content-length"]=r);let a=this.defaultHeaders(e);return V_(s,a),V_(s,t),rh(e.body)&&xs!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return _e.generate(e,t,r,s)}request(e,t=null){return new pc(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e;t==null&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);let{req:s,url:a,timeout:i}=this.buildRequest(r);if(await this.prepareRequest(s,{url:a,options:r}),Za("request",a,r,s.headers),r.signal?.aborted)throw new fn;let o=new AbortController,l=await this.fetchWithTimeout(a,s,i,o).catch(uc);if(l instanceof Error){if(r.signal?.aborted)throw new fn;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new As:new Br({cause:l})}let u=SS(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let m=`retrying, ${t} attempts remaining`;return Za(`response (error; ${m})`,l.status,a,u),this.retryRequest(r,t,u)}let c=await l.text().catch(m=>uc(m).message),d=NS(c),p=d?void 0:c;throw Za(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,u,p),this.makeStatusError(l.status,d,p,u)}return{response:l,options:r,controller:o}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new sh(this,r,e)}buildURL(e,t){let r=MS(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return LS(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Pe(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s,a=r?.["retry-after-ms"];if(a){let o=parseFloat(a);Number.isNaN(o)||(s=o)}let i=r?.["retry-after"];if(i&&!s){let o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await jS(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${vs}`}},B_=class{constructor(e,t,r,s){dc.set(this,void 0),PS(this,dc,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new Pe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,a]of r)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await TS(this,dc,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(dc=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},sh=class extends pc{constructor(e,t,r){super(t,async s=>new r(e,s.response,await G_(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},SS=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}});var CS=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vs,"X-Stainless-OS":q_(Deno.build.os),"X-Stainless-Arch":z_(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vs,"X-Stainless-OS":q_(process.platform),"X-Stainless-Arch":z_(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=kS();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function kS(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}var z_=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",q_=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),H_,RS=()=>H_??(H_=CS()),NS=n=>{try{return JSON.parse(n)}catch{return}},$S=new RegExp("^(?:[a-z]+:)?//","i"),MS=n=>$S.test(n),jS=n=>new Promise(e=>setTimeout(e,n)),nh=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Pe(`${n} must be an integer`);if(e<0)throw new Pe(`${n} must be a positive integer`);return e},uc=n=>n instanceof Error?n:new Error(n);var ah=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function LS(n){if(!n)return!0;for(let e in n)return!1;return!0}function DS(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function V_(n,e){for(let t in e){if(!DS(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Za(n,...e){typeof process<"u"&&process.env.DEBUG==="true"&&console.log(`Groq:DEBUG:${n}`,...e)}var FS=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),K_=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";var ct=class{constructor(e){this._client=e}};var Es=class extends ct{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}};Es||(Es={});var hn=class extends ct{constructor(){super(...arguments),this.completions=new Es(this._client)}};(function(n){n.Completions=Es})(hn||(hn={}));var mn=class extends ct{retrieve(e,t){return this._client.get(`/openai/v1/models/${e}`,t)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,t){return this._client.delete(`/openai/v1/models/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}};mn||(mn={});var Is=class extends ct{create(e,t){return this._client.post("/openai/v1/audio/transcriptions",Ko({body:e,...t}))}};Is||(Is={});var Os=class extends ct{create(e,t){return this._client.post("/openai/v1/audio/translations",Ko({body:e,...t}))}};Os||(Os={});var gn=class extends ct{constructor(){super(...arguments),this.transcriptions=new Is(this._client),this.translations=new Os(this._client)}};(function(n){n.Transcriptions=Is,n.Translations=Os})(gn||(gn={}));var W_,he=class extends fc{constructor({baseURL:e=ah("GROQ_BASE_URL"),apiKey:t=ah("GROQ_API_KEY"),...r}={}){if(t===void 0)throw new Pe("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");let s={apiKey:t,...r,baseURL:e||"https://api.groq.com"};if(!s.dangerouslyAllowBrowser&&K_())throw new Pe("This is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Groq({ dangerouslyAllowBrowser: true })");super({baseURL:s.baseURL,timeout:s.timeout??6e4,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.chat=new hn(this),this.audio=new gn(this),this.models=new mn(this),this._options=s,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};W_=he;he.Groq=W_;he.GroqError=Pe;he.APIError=_e;he.APIConnectionError=Br;he.APIConnectionTimeoutError=As;he.APIUserAbortError=fn;he.NotFoundError=Ha;he.ConflictError=Va;he.RateLimitError=Ka;he.BadRequestError=Ba;he.AuthenticationError=za;he.InternalServerError=Wa;he.PermissionDeniedError=qa;he.UnprocessableEntityError=Ga;var{GroqError:Gz,APIError:Kz,APIConnectionError:Wz,APIConnectionTimeoutError:Jz,APIUserAbortError:Zz,NotFoundError:Yz,ConflictError:Xz,RateLimitError:Qz,BadRequestError:eq,AuthenticationError:tq,InternalServerError:rq,PermissionDeniedError:nq,UnprocessableEntityError:sq}=Yf;(function(n){n.toFile=th,n.fileFromPath=oc,n.Chat=hn,n.Audio=gn,n.Models=mn})(he||(he={}));var J_=he;rs();function Wo(n,e){if(n.function===void 0)return;let t;if(e?.partial)try{t=ca(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(s){throw new cr([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}let r={name:n.function.name,args:t,type:"tool_call"};return e?.returnId&&(r.id=n.id),r}function hc(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function mc(n,e){return{name:n.function?.name,args:n.function?.arguments,id:n.id,error:e,type:"invalid_tool_call"}}var ih=class extends bs{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r=e[0].message,s;if(ts(r)&&r.tool_calls?.length?s=r.tool_calls.map(i=>{let{id:o,...l}=i;return this.returnId?{id:o,...l}:l}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(o=>Wo(o,{returnId:this.returnId,partial:t}))),!s)return[];let a=[];for(let i of s)if(i!==void 0){let o={type:i.name,args:i.args,id:i.id};Object.defineProperty(o,"name",{get(){return this.type}}),Object.defineProperty(o,"arguments",{get(){return this.args}}),a.push(o)}return a}},yn=class extends ih{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new cr(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let r=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName),s=r;if(r.length)return this.returnId||(s=r.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){let r=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName),s=r;return r.length?(this.returnId||(s=r.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}};function VS(n){let e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";default:throw new Error(`Unknown message type: ${e}`)}}function Z_(n){return n.map(e=>{if(typeof e.content!="string")throw new Error("Non string message content not supported");let t={role:VS(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id};return ts(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(hc):(e.additional_kwargs.tool_calls!=null&&(t.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(t.tool_call_id=e.tool_call_id)),t})}function GS(n){let e=n.tool_calls;switch(n.role){case"assistant":{let t=[],r=[];for(let s of e??[])try{t.push(Wo(s,{returnId:!0}))}catch(a){r.push(mc(s,a.message))}return new se({content:n.content||"",additional_kwargs:{tool_calls:e},tool_calls:t,invalid_tool_calls:r})}default:return new Ce(n.content||"",n.role??"unknown")}}function KS(n){let{role:e}=n,t=n.content??"",r;return n.function_call?r={function_call:n.function_call}:n.tool_calls?r={tool_calls:n.tool_calls}:r={},e==="user"?new Cr({content:t}):e==="assistant"?new le({content:t,additional_kwargs:r}):e==="system"?new kr({content:t}):new Sr({content:t,role:e})}var gc=class extends Dr{static lc_name(){return"ChatGroq"}_llmType(){return"groq"}get lc_secrets(){return{apiKey:"GROQ_API_KEY"}}constructor(e){super(e??{}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0});let t=e?.apiKey||Q("GROQ_API_KEY");if(!t)throw new Error('Groq API key not found. Please set the GROQ_API_KEY environment variable or provide the key into "apiKey"');this.client=new J_({apiKey:t,dangerouslyAllowBrowser:!0}),this.temperature=e?.temperature??this.temperature,this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.streaming=e?.streaming??this.streaming,this.stop=e?.stopSequences??(typeof e?.stop=="string"?[e.stop]:e?.stop)??[],this.stopSequences=this.stop,this.maxTokens=e?.maxTokens}async completionWithRetry(e,t){return this.caller.call(async()=>this.client.chat.completions.create(e,t))}invocationParams(e){let t=super.invocationParams(e);return e.tool_choice!==void 0&&(t.tool_choice=e.tool_choice),e.tools!==void 0&&(t.tools=e.tools),e.response_format!==void 0&&(t.response_format=e.response_format),{...t,stop:e.stop??this.stopSequences,model:this.model,temperature:this.temperature,max_tokens:this.maxTokens}}bindTools(e,t){return this.bind({tools:e.map(Ua),...t})}async*_streamResponseChunks(e,t,r){let s=this.invocationParams(t),a=Z_(e);if(t.tools!==void 0&&t.tools.length>0){let o=(await this._generateNonStreaming(e,t,r)).generations[0].message;if(o===void 0||typeof o.content!="string")throw new Error("Could not parse Groq output.");let l=o.tool_calls?.map((u,c)=>({name:u.name,args:JSON.stringify(u.args),id:u.id,index:c}));yield new Ie({message:new le({content:o.content,additional_kwargs:o.additional_kwargs,tool_call_chunks:l}),text:o.content})}else{let i=await this.completionWithRetry({...s,messages:a,stream:!0},{signal:t?.signal,headers:t?.headers});for await(let o of i){let l=o?.choices[0];if(!l)continue;let u=new Ie({message:KS(l.delta??{}),text:l.delta.content??"",generationInfo:{finishReason:l.finish_reason}});yield u,r?.handleLLMNewToken(u.text??"")}if(t.signal?.aborted)throw new Error("AbortError")}}async _generate(e,t,r){if(this.streaming){let s={},a=this._streamResponseChunks(e,t,r),i={};for await(let l of a){let u=l.generationInfo?.completion??0;i[u]===void 0?i[u]=l:i[u]=i[u].concat(l)}return{generations:Object.entries(i).sort(([l],[u])=>parseInt(l,10)-parseInt(u,10)).map(([l,u])=>u),llmOutput:{estimatedTokenUsage:s}}}else return this._generateNonStreaming(e,t,r)}async _generateNonStreaming(e,t,r){let s={},a=this.invocationParams(t),i=Z_(e),o=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t?.signal,headers:t?.headers});if("usage"in o&&o.usage){let{completion_tokens:u,prompt_tokens:c,total_tokens:d}=o.usage;u&&(s.completionTokens=(s.completionTokens??0)+u),c&&(s.promptTokens=(s.promptTokens??0)+c),d&&(s.totalTokens=(s.totalTokens??0)+d)}let l=[];if("choices"in o&&o.choices)for(let u of o.choices){let d={text:u.message?.content??"",message:GS(u.message??{role:"assistant"})};d.generationInfo={...u.finish_reason?{finish_reason:u.finish_reason}:{},...u.logprobs?{logprobs:u.logprobs}:{}},l.push(d)}return{generations:l,llmOutput:{tokenUsage:s}}}withStructuredOutput(e,t){let r=e,s=t?.name,a=t?.method,i=t?.includeRaw,o=s??"extract",l,u;if(a==="jsonMode")u=this.bind({response_format:{type:"json_object"}}),ur(r)?l=ka.fromZodSchema(r):l=new Ra;else if(ur(r)){let f=Fe(r);u=this.bind({tools:[{type:"function",function:{name:o,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:o}}}),l=new yn({returnSingle:!0,keyName:o,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,o=r.name):(o=r.title??o,f={name:o,description:r.description??"",parameters:r}),u=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:o}}}),l=new yn({returnSingle:!0,keyName:o})}if(!i)return u.pipe(l).withConfig({runName:"ChatGroqStructuredOutput"});let c=$e.assign({parsed:(f,h)=>l.invoke(f.raw,h)}),d=$e.assign({parsed:()=>null}),p=c.withFallbacks({fallbacks:[d]});return gt.from([{raw:u},p]).withConfig({runName:"ChatGroqStructuredOutput"})}};var yc="RFC3986",bc={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},Y_="RFC1738";var WS=Array.isArray,dr=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();var oh=1024,X_=(n,e,t,r,s)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=oh){let l=a.length>=oh?a.slice(o,o+oh):a,u=[];for(let c=0;c<l.length;++c){let d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===Y_&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=dr[d];continue}if(d<2048){u[u.length]=dr[192|d>>6]+dr[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=dr[224|d>>12]+dr[128|d>>6&63]+dr[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=dr[240|d>>18]+dr[128|d>>12&63]+dr[128|d>>6&63]+dr[128|d&63]}i+=u.join("")}return i};function Q_(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function lh(n,e){if(WS(n)){let t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}var JS=Object.prototype.hasOwnProperty,ev={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},pr=Array.isArray,ZS=Array.prototype.push,tv=function(n,e){ZS.apply(n,pr(e)?e:[e])},YS=Date.prototype.toISOString,ve={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:X_,encodeValuesOnly:!1,format:yc,formatter:bc[yc],indices:!1,serializeDate(n){return YS.call(n)},skipNulls:!1,strictNullHandling:!1};function XS(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}var uh={};function rv(n,e,t,r,s,a,i,o,l,u,c,d,p,f,h,m,y,x){let w=n,A=x,M=0,N=!1;for(;(A=A.get(uh))!==void 0&&!N;){let oe=A.get(n);if(M+=1,typeof oe<"u"){if(oe===M)throw new RangeError("Cyclic object value");N=!0}typeof A.get(uh)>"u"&&(M=0)}if(typeof u=="function"?w=u(e,w):w instanceof Date?w=p?.(w):t==="comma"&&pr(w)&&(w=lh(w,function(oe){return oe instanceof Date?p?.(oe):oe})),w===null){if(a)return l&&!m?l(e,ve.encoder,y,"key",f):e;w=""}if(XS(w)||Q_(w)){if(l){let oe=m?e:l(e,ve.encoder,y,"key",f);return[h?.(oe)+"="+h?.(l(w,ve.encoder,y,"value",f))]}return[h?.(e)+"="+h?.(String(w))]}let R=[];if(typeof w>"u")return R;let U;if(t==="comma"&&pr(w))m&&l&&(w=lh(w,l)),U=[{value:w.length>0?w.join(",")||null:void 0}];else if(pr(u))U=u;else{let oe=Object.keys(w);U=c?oe.sort(c):oe}let T=o?String(e).replace(/\./g,"%2E"):String(e),re=r&&pr(w)&&w.length===1?T+"[]":T;if(s&&pr(w)&&w.length===0)return re+"[]";for(let oe=0;oe<U.length;++oe){let ge=U[oe],cm=typeof ge=="object"&&typeof ge.value<"u"?ge.value:w[ge];if(i&&cm===null)continue;let sd=d&&o?ge.replace(/\./g,"%2E"):ge,vx=pr(w)?typeof t=="function"?t(re,sd):re:re+(d?"."+sd:"["+sd+"]");x.set(n,M);let dm=new WeakMap;dm.set(uh,x),tv(R,rv(cm,vx,t,r,s,a,i,o,t==="comma"&&m&&pr(w)?null:l,u,c,d,p,f,h,m,y,dm))}return R}function QS(n=ve){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=n.charset||ve.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=yc;if(typeof n.format<"u"){if(!JS.call(bc,n.format))throw new TypeError("Unknown format option provided.");t=n.format}let r=bc[t],s=ve.filter;(typeof n.filter=="function"||pr(n.filter))&&(s=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in ev?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=ve.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:ve.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:ve.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:ve.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:ve.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?ve.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:ve.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:ve.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:ve.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:ve.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:ve.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:ve.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:ve.strictNullHandling}}function ch(n,e={}){let t=n,r=QS(e),s,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):pr(r.filter)&&(a=r.filter,s=a);let i=[];if(typeof t!="object"||t===null)return"";let o=ev[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);let u=new WeakMap;for(let p=0;p<s.length;++p){let f=s[p];r.skipNulls&&t[f]===null||tv(i,rv(t[f],f,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}let c=i.join(r.delimiter),d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}var Ps="4.104.0";var nv=!1,Ts,dh,tC,rC,nC,ph,sC,wc,fh,hh,mh,_c,gh;function sv(n,e={auto:!1}){if(nv)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Ts)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Ts}'\``);nv=e.auto,Ts=n.kind,dh=n.fetch,tC=n.Request,rC=n.Response,nC=n.Headers,ph=n.FormData,sC=n.Blob,wc=n.File,fh=n.ReadableStream,hh=n.getMultipartRequestOptions,mh=n.getDefaultAgent,_c=n.fileFromPath,gh=n.isFsReadStream}var vc=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function av({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,s,a;try{t=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new vc(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}var yh=()=>{Ts||sv(av(),{auto:!0})};yh();var S=class extends Error{},me=class n extends S{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"],this.error=t;let a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new zr({message:r,cause:xc(t)});let a=t?.error;return e===400?new Ya(e,a,r,s):e===401?new Xa(e,a,r,s):e===403?new Qa(e,a,r,s):e===404?new ei(e,a,r,s):e===409?new ti(e,a,r,s):e===422?new ri(e,a,r,s):e===429?new ni(e,a,r,s):e>=500?new si(e,a,r,s):new n(e,a,r,s)}},ae=class extends me{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},zr=class extends me{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Jt=class extends zr{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ya=class extends me{},Xa=class extends me{},Qa=class extends me{},ei=class extends me{},ti=class extends me{},ri=class extends me{},ni=class extends me{},si=class extends me{},ai=class extends S{constructor(){super("Could not parse response content as the length limit was reached")}},ii=class extends S{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Ac=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Ss=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},yt,Cs=class{constructor(){yt.set(this,void 0),this.buffer=new Uint8Array,Ac(this,yt,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+t.length);r.set(this.buffer),r.set(t,this.buffer.length),this.buffer=r;let s=[],a;for(;(a=oC(this.buffer,Ss(this,yt,"f")))!=null;){if(a.carriage&&Ss(this,yt,"f")==null){Ac(this,yt,a.index,"f");continue}if(Ss(this,yt,"f")!=null&&(a.index!==Ss(this,yt,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,Ss(this,yt,"f")-1))),this.buffer=this.buffer.slice(Ss(this,yt,"f")),Ac(this,yt,null,"f");continue}let i=Ss(this,yt,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),Ac(this,yt,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new S(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new S(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new S("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};yt=new WeakMap;Cs.NEWLINE_CHARS=new Set([`
`,"\r"]);Cs.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function oC(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function iv(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}function bh(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var fr=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let i of lC(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new me(void 0,o.error,void 0,_h(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new me(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new n(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let i=new Cs,o=bh(e);for await(let l of o)for(let u of i.decode(l))yield u;for(let l of i.flush())yield l}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new n(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new n(()=>s(e),this.controller),new n(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new fh({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:a,done:i}=await t.next();if(i)return s.close();let o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){await t.return?.()}})}};async function*lC(n,e){if(!n.body)throw e.abort(),new S("Attempted to iterate over a response with no body");let t=new wh,r=new Cs,s=bh(n.body);for await(let a of uC(s))for(let i of r.decode(a)){let o=t.decode(i);o&&(yield o)}for(let a of r.flush()){let i=t.decode(a);i&&(yield i)}}async function*uC(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=iv(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}var wh=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=cC(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function cC(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}var ov=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",lv=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Jo(n),Jo=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",dC=n=>lv(n)||ov(n)||gh(n);async function Ah(n,e,t){if(n=await n,lv(n))return n;if(ov(n)){let s=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");let a=Jo(s)?[await s.arrayBuffer()]:[s];return new wc(a,e,t)}let r=await pC(n);if(e||(e=hC(n)??"unknown_file"),!t?.type){let s=r[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new wc(r,e,t)}async function pC(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Jo(n))e.push(await n.arrayBuffer());else if(mC(n))for await(let t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${fC(n)}`);return e}function fC(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function hC(n){return vh(n.name)||vh(n.filename)||vh(n.path)?.split(/[\\/]/).pop()}var vh=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},mC=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Eh=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var dt=async n=>{let e=await uv(n.body);return hh(e,n)},uv=async n=>{let e=new ph;return await Promise.all(Object.entries(n||{}).map(([t,r])=>xh(e,t,r))),e};var xh=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(dC(t)){let r=await Ah(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>xh(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>xh(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var yC=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},bC=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ec;yh();async function mv(n){let{response:e}=n;if(n.options.stream)return qr("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):fr.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let r=e.headers.get("content-type")?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){let i=await e.json();return qr("response",e.status,e.url,e.headers,i),gv(i,e)}let a=await e.text();return qr("response",e.status,e.url,e.headers,a),a}function gv(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Oc=class n extends Promise{constructor(e,t=mv){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>gv(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Pc=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=Ih("maxRetries",t),this.timeout=Ih("timeout",r),this.httpAgent=s,this.fetch=a??dh}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...xC(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${OC()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{let a=s&&Jo(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:a,query:i,headers:o={}}=r,l=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:Eh(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,u=this.calculateContentLength(l),c=this.buildURL(a,i);"timeout"in r&&Ih("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let d=r.httpAgent??this.httpAgent??mh(c),p=r.timeout+1e3;typeof d?.options?.timeout=="number"&&p>(d.options.timeout??0)&&(d.options.timeout=p),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:r,headers:o,contentLength:u,retryCount:t});return{req:{method:s,...l&&{body:l},headers:f,...d&&{agent:d},signal:r.signal??null},url:c,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){let a={};r&&(a["content-length"]=r);let i=this.defaultHeaders(e);return fv(a,i),fv(a,t),Eh(e.body)&&Ts!=="node"&&delete a["content-type"],Ic(i,"x-stainless-retry-count")===void 0&&Ic(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),Ic(i,"x-stainless-timeout")===void 0&&Ic(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return me.generate(e,t,r,s)}request(e,t=null){return new Oc(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:r}),qr("request",i,r,a.headers),r.signal?.aborted)throw new ae;let l=new AbortController,u=await this.fetchWithTimeout(i,a,o,l).catch(xc);if(u instanceof Error){if(r.signal?.aborted)throw new ae;if(t)return this.retryRequest(r,t);throw u.name==="AbortError"?new Jt:new zr({cause:u})}let c=_h(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){let y=`retrying, ${t} attempts remaining`;return qr(`response (error; ${y})`,u.status,i,c),this.retryRequest(r,t,c)}let d=await u.text().catch(y=>xc(y).message),p=AC(d),f=p?void 0:d;throw qr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,f),this.makeStatusError(u.status,p,f,c)}return{response:u,options:r,controller:l}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new Oh(this,r,e)}buildURL(e,t){let r=IC(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return yv(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new S(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r),l={signal:s.signal,...i};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s,a=r?.["retry-after-ms"];if(a){let o=parseFloat(a);Number.isNaN(o)||(s=o)}let i=r?.["retry-after"];if(i&&!s){let o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Hr(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ps}`}},Zo=class{constructor(e,t,r,s){Ec.set(this,void 0),yC(this,Ec,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new S("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,a]of r)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await bC(this,Ec,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ec=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Oh=class extends Oc{constructor(e,t,r){super(t,async s=>new r(e,s.response,await mv(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},_h=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),wC={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},B=n=>typeof n=="object"&&n!==null&&!yv(n)&&Object.keys(n).every(e=>bv(wC,e)),_C=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ps,"X-Stainless-OS":dv(Deno.build.os),"X-Stainless-Arch":cv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ps,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ps,"X-Stainless-OS":dv(process.platform),"X-Stainless-Arch":cv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=vC();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ps,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ps,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function vC(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}var cv=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",dv=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),pv,xC=()=>pv??(pv=_C()),AC=n=>{try{return JSON.parse(n)}catch{return}},EC=/^[a-z][a-z0-9+.-]*:/i,IC=n=>EC.test(n),Hr=n=>new Promise(e=>setTimeout(e,n)),Ih=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new S(`${n} must be an integer`);if(e<0)throw new S(`${n} must be a positive integer`);return e},xc=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)};var Yo=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function yv(n){if(!n)return!0;for(let e in n)return!1;return!0}function bv(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function fv(n,e){for(let t in e){if(!bv(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}var hv=new Set(["authorization","api-key"]);function qr(n,...e){if(typeof process<"u"&&process?.env?.DEBUG==="true"){let t=e.map(r=>{if(!r)return r;if(r.headers){let a={...r,headers:{...r.headers}};for(let i in r.headers)hv.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(let a in r)hv.has(a.toLowerCase())&&(s??(s={...r}),s[a]="REDACTED");return s??r});console.log(`OpenAI:DEBUG:${n}`,...t)}}var OC=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),wv=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",PC=n=>typeof n?.get=="function";var Ic=(n,e)=>{let t=e.toLowerCase();if(PC(n)){let r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,a,i)=>a+i.toUpperCase());for(let s of[e,t,e.toUpperCase(),r]){let a=n.get(s);if(a)return a}}for(let[r,s]of Object.entries(n))if(r.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};var _v=n=>{if(typeof Buffer<"u"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};function Xo(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}var hr=class extends Zo{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},K=class extends Zo{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}};var b=class{constructor(e){this._client=e}};var oi=class extends b{list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Tc,{query:t,...r})}};var bn=class extends b{constructor(){super(...arguments),this.messages=new oi(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/chat/completions",wn,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},wn=class extends K{},Tc=class extends K{};bn.ChatCompletionsPage=wn;bn.Messages=oi;var Gr=class extends b{constructor(){super(...arguments),this.completions=new bn(this._client)}};Gr.Completions=bn;Gr.ChatCompletionsPage=wn;var li=class extends b{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}};var ui=class extends b{create(e,t){return this._client.post("/audio/transcriptions",dt({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}};var ci=class extends b{create(e,t){return this._client.post("/audio/translations",dt({body:e,...t,__metadata:{model:e.model}}))}};var mr=class extends b{constructor(){super(...arguments),this.transcriptions=new ui(this._client),this.translations=new ci(this._client),this.speech=new li(this._client)}};mr.Transcriptions=ui;mr.Translations=ci;mr.Speech=li;var _n=class extends b{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/batches",ks,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},ks=class extends K{};_n.BatchesPage=ks;var Zt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ie=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ph,Sc,Cc,Qo,el,kc,tl,Kr,rl,Rc,Nc,di,vv,vn=class{constructor(){Ph.add(this),this.controller=new AbortController,Sc.set(this,void 0),Cc.set(this,()=>{}),Qo.set(this,()=>{}),el.set(this,void 0),kc.set(this,()=>{}),tl.set(this,()=>{}),Kr.set(this,{}),rl.set(this,!1),Rc.set(this,!1),Nc.set(this,!1),di.set(this,!1),Zt(this,Sc,new Promise((e,t)=>{Zt(this,Cc,e,"f"),Zt(this,Qo,t,"f")}),"f"),Zt(this,el,new Promise((e,t)=>{Zt(this,kc,e,"f"),Zt(this,tl,t,"f")}),"f"),ie(this,Sc,"f").catch(()=>{}),ie(this,el,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ie(this,Ph,"m",vv).bind(this))},0)}_connected(){this.ended||(ie(this,Cc,"f").call(this),this._emit("connect"))}get ended(){return ie(this,rl,"f")}get errored(){return ie(this,Rc,"f")}get aborted(){return ie(this,Nc,"f")}abort(){this.controller.abort()}on(e,t){return(ie(this,Kr,"f")[e]||(ie(this,Kr,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=ie(this,Kr,"f")[e];if(!r)return this;let s=r.findIndex(a=>a.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(ie(this,Kr,"f")[e]||(ie(this,Kr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Zt(this,di,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Zt(this,di,!0,"f"),await ie(this,el,"f")}_emit(e,...t){if(ie(this,rl,"f"))return;e==="end"&&(Zt(this,rl,!0,"f"),ie(this,kc,"f").call(this));let r=ie(this,Kr,"f")[e];if(r&&(ie(this,Kr,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!ie(this,di,"f")&&!r?.length&&Promise.reject(s),ie(this,Qo,"f").call(this,s),ie(this,tl,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!ie(this,di,"f")&&!r?.length&&Promise.reject(s),ie(this,Qo,"f").call(this,s),ie(this,tl,"f").call(this,s),this._emit("end")}}_emitFinal(){}};Sc=new WeakMap,Cc=new WeakMap,Qo=new WeakMap,el=new WeakMap,kc=new WeakMap,tl=new WeakMap,Kr=new WeakMap,rl=new WeakMap,Rc=new WeakMap,Nc=new WeakMap,di=new WeakMap,Ph=new WeakSet,vv=function(e){if(Zt(this,Rc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ae),e instanceof ae)return Zt(this,Nc,!0,"f"),this._emit("abort",e);if(e instanceof S)return this._emit("error",e);if(e instanceof Error){let t=new S(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new S(String(e)))};var $=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},bt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Me,Th,gr,$c,Yt,Ns,pi,Rs,Lc,wt,Mc,jc,al,nl,sl,xv,Av,Ev,Iv,Ov,Pv,Tv,yr=class n extends vn{constructor(){super(...arguments),Me.add(this),Th.set(this,[]),gr.set(this,{}),$c.set(this,{}),Yt.set(this,void 0),Ns.set(this,void 0),pi.set(this,void 0),Rs.set(this,void 0),Lc.set(this,void 0),wt.set(this,void 0),Mc.set(this,void 0),jc.set(this,void 0),al.set(this,void 0)}[(Th=new WeakMap,gr=new WeakMap,$c=new WeakMap,Yt=new WeakMap,Ns=new WeakMap,pi=new WeakMap,Rs=new WeakMap,Lc=new WeakMap,wt=new WeakMap,Mc=new WeakMap,jc=new WeakMap,al=new WeakMap,Me=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new n;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=fr.fromReadableStream(e,this.controller);for await(let a of s)$(this,Me,"m",nl).call(this,a);if(s.controller.signal?.aborted)throw new ae;return this._addRun($(this,Me,"m",sl).call(this))}toReadableStream(){return new fr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,a){let i=new n;return i._run(()=>i._runToolAssistantStream(e,t,r,s,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,s,a){let i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},l=await e.submitToolOutputs(t,r,o,{...a,signal:this.controller.signal});this._connected();for await(let u of l)$(this,Me,"m",nl).call(this,u);if(l.controller.signal?.aborted)throw new ae;return this._addRun($(this,Me,"m",sl).call(this))}static createThreadAssistantStream(e,t,r){let s=new n;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){let a=new n;return a._run(()=>a._runAssistantStream(e,t,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return $(this,Mc,"f")}currentRun(){return $(this,jc,"f")}currentMessageSnapshot(){return $(this,Yt,"f")}currentRunStepSnapshot(){return $(this,al,"f")}async finalRunSteps(){return await this.done(),Object.values($(this,gr,"f"))}async finalMessages(){return await this.done(),Object.values($(this,$c,"f"))}async finalRun(){if(await this.done(),!$(this,Ns,"f"))throw Error("Final run was not received.");return $(this,Ns,"f")}async _createThreadAssistantStream(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...t,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(let o of i)$(this,Me,"m",nl).call(this,o);if(i.controller.signal?.aborted)throw new ae;return this._addRun($(this,Me,"m",sl).call(this))}async _createAssistantStream(e,t,r,s){let a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(let l of o)$(this,Me,"m",nl).call(this,l);if(o.controller.signal?.aborted)throw new ae;return this._addRun($(this,Me,"m",sl).call(this))}static accumulateDelta(e,t){for(let[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let a=e[r];if(a==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(Xo(a)&&Xo(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(let i of s){if(!Xo(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,a){return await this._createToolAssistantStream(r,e,t,s,a)}};nl=function(e){if(!this.ended)switch(bt(this,Mc,e,"f"),$(this,Me,"m",Ev).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":$(this,Me,"m",Tv).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":$(this,Me,"m",Av).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":$(this,Me,"m",xv).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},sl=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");if(!$(this,Ns,"f"))throw Error("Final run has not been received");return $(this,Ns,"f")},xv=function(e){let[t,r]=$(this,Me,"m",Ov).call(this,e,$(this,Yt,"f"));bt(this,Yt,t,"f"),$(this,$c,"f")[t.id]=t;for(let s of r){let a=t.content[s.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=$(this,pi,"f")){if($(this,Rs,"f"))switch($(this,Rs,"f").type){case"text":this._emit("textDone",$(this,Rs,"f").text,$(this,Yt,"f"));break;case"image_file":this._emit("imageFileDone",$(this,Rs,"f").image_file,$(this,Yt,"f"));break}bt(this,pi,s.index,"f")}bt(this,Rs,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if($(this,pi,"f")!==void 0){let s=e.data.content[$(this,pi,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,$(this,Yt,"f"));break;case"text":this._emit("textDone",s.text,$(this,Yt,"f"));break}}$(this,Yt,"f")&&this._emit("messageDone",e.data),bt(this,Yt,void 0,"f")}},Av=function(e){let t=$(this,Me,"m",Iv).call(this,e);switch(bt(this,al,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let a of r.step_details.tool_calls)a.index==$(this,Lc,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):($(this,wt,"f")&&this._emit("toolCallDone",$(this,wt,"f")),bt(this,Lc,a.index,"f"),bt(this,wt,t.step_details.tool_calls[a.index],"f"),$(this,wt,"f")&&this._emit("toolCallCreated",$(this,wt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":bt(this,al,void 0,"f"),e.data.step_details.type=="tool_calls"&&$(this,wt,"f")&&(this._emit("toolCallDone",$(this,wt,"f")),bt(this,wt,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},Ev=function(e){$(this,Th,"f").push(e),this._emit("event",e)},Iv=function(e){switch(e.event){case"thread.run.step.created":return $(this,gr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=$(this,gr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let s=yr.accumulateDelta(t,r.delta);$(this,gr,"f")[e.data.id]=s}return $(this,gr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":$(this,gr,"f")[e.data.id]=e.data;break}if($(this,gr,"f")[e.data.id])return $(this,gr,"f")[e.data.id];throw new Error("No snapshot available")},Ov=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=$(this,Me,"m",Pv).call(this,a,i)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Pv=function(e,t){return yr.accumulateDelta(t,e)},Tv=function(e){switch(bt(this,jc,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":bt(this,Ns,e.data,"f"),$(this,wt,"f")&&(this._emit("toolCallDone",$(this,wt,"f")),bt(this,wt,void 0,"f"));break;case"thread.run.cancelling":break}};var $s=class extends b{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/assistants",fi,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}},fi=class extends K{};$s.AssistantsPage=fi;function Sh(n){return typeof n.parse=="function"}var xn=n=>n?.role==="assistant",Ch=n=>n?.role==="function",kh=n=>n?.role==="tool";function il(n){return n?.$brand==="auto-parseable-response-format"}function Ms(n){return n?.$brand==="auto-parseable-tool"}function Sv(n,e){return!e||!Rh(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:ol(n,e)}function ol(n,e){let t=n.choices.map(r=>{if(r.finish_reason==="length")throw new ai;if(r.finish_reason==="content_filter")throw new ii;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(s=>MC(e,s))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?$C(e,r.message.content):null}}});return{...n,choices:t}}function $C(n,e){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function MC(n,e){let t=n.tools?.find(r=>r.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Ms(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function Cv(n,e){if(!n)return!1;let t=n.tools?.find(r=>r.function?.name===e.function.name);return Ms(t)||t?.function.strict||!1}function Rh(n){return il(n.response_format)?!0:n.tools?.some(e=>Ms(e)||e.type==="function"&&e.function.strict===!0)??!1}function kv(n){for(let e of n??[]){if(e.type!=="function")throw new S(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new S(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var pt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},He,Nh,Dc,$h,Mh,jh,Nv,Lh,Rv=10,hi=class extends vn{constructor(){super(...arguments),He.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ch(e)||kh(e))&&e.content)this._emit("functionCallResult",e.content);else if(xn(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(xn(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new S("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),pt(this,He,"m",Nh).call(this)}async finalMessage(){return await this.done(),pt(this,He,"m",Dc).call(this)}async finalFunctionCall(){return await this.done(),pt(this,He,"m",$h).call(this)}async finalFunctionCallResult(){return await this.done(),pt(this,He,"m",Mh).call(this)}async totalUsage(){return await this.done(),pt(this,He,"m",jh).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=pt(this,He,"m",Dc).call(this);t&&this._emit("finalMessage",t);let r=pt(this,He,"m",Nh).call(this);r&&this._emit("finalContent",r);let s=pt(this,He,"m",$h).call(this);s&&this._emit("finalFunctionCall",s);let a=pt(this,He,"m",Mh).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",pt(this,He,"m",jh).call(this))}async _createChatCompletion(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),pt(this,He,"m",Nv).call(this,t);let a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ol(a,t))}async _runChatCompletion(e,t,r){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){let s="function",{function_call:a="auto",stream:i,...o}=t,l=typeof a!="string"&&a?.name,{maxChatCompletions:u=Rv}=r||{},c={};for(let p of t.functions)c[p.name||p.function.name]=p;let d=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<u;++p){let h=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},r)).choices[0]?.message;if(!h)throw new S("missing message in ChatCompletion response");if(!h.function_call)return;let{name:m,arguments:y}=h.function_call,x=c[m];if(x){if(l&&l!==m){let N=`Invalid function_call: ${JSON.stringify(m)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:m,content:N});continue}}else{let N=`Invalid function_call: ${JSON.stringify(m)}. Available options are: ${d.map(R=>JSON.stringify(R.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:m,content:N});continue}let w;try{w=Sh(x)?await x.parse(y):y}catch(N){this._addMessage({role:s,name:m,content:N instanceof Error?N.message:String(N)});continue}let A=await x.function(w,this),M=pt(this,He,"m",Lh).call(this,A);if(this._addMessage({role:s,name:m,content:M}),l)return}}async _runTools(e,t,r){let s="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&a?.function?.name,{maxChatCompletions:u=Rv}=r||{},c=t.tools.map(f=>{if(Ms(f)){if(!f.$callback)throw new S("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:f.$callback,name:f.function.name,description:f.function.description||"",parameters:f.function.parameters,parse:f.$parseRaw,strict:!0}}}return f}),d={};for(let f of c)f.type==="function"&&(d[f.function.name||f.function.function.name]=f.function);let p="tools"in t?c.map(f=>f.type==="function"?{type:"function",function:{name:f.function.name||f.function.function.name,parameters:f.function.parameters,description:f.function.description,strict:f.function.strict}}:f):void 0;for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<u;++f){let m=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:p,messages:[...this.messages]},r)).choices[0]?.message;if(!m)throw new S("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(let y of m.tool_calls){if(y.type!=="function")continue;let x=y.id,{name:w,arguments:A}=y.function,M=d[w];if(M){if(l&&l!==w){let T=`Invalid tool_call: ${JSON.stringify(w)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:x,content:T});continue}}else{let T=`Invalid tool_call: ${JSON.stringify(w)}. Available options are: ${Object.keys(d).map(re=>JSON.stringify(re)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:x,content:T});continue}let N;try{N=Sh(M)?await M.parse(A):A}catch(T){let re=T instanceof Error?T.message:String(T);this._addMessage({role:s,tool_call_id:x,content:re});continue}let R=await M.function(N,this),U=pt(this,He,"m",Lh).call(this,R);if(this._addMessage({role:s,tool_call_id:x,content:U}),l)return}}}};He=new WeakSet,Nh=function(){return pt(this,He,"m",Dc).call(this).content??null},Dc=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(xn(t)){let{function_call:r,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return r&&(a.function_call=r),a}}throw new S("stream ended without producing a ChatCompletionMessage with role=assistant")},$h=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(xn(t)&&t?.function_call)return t.function_call;if(xn(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Mh=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Ch(t)&&t.content!=null||kh(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(s=>s.type==="function"&&s.id===t.tool_call_id)))return t.content}},jh=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Nv=function(e){if(e.n!=null&&e.n>1)throw new S("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Lh=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var ll=class n extends hi{static runFunctions(e,t,r){let s=new n,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new n,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),xn(e)&&e.content&&this._emit("content",e.content)}};var Te={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Dh=class extends Error{},Fh=class extends Error{};function jC(n,e=Te.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return LC(n.trim(),e)}var LC=(n,e)=>{let t=n.length,r=0,s=p=>{throw new Dh(`${p} at position ${r}`)},a=p=>{throw new Fh(`${p} at position ${r}`)},i=()=>(d(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?u():n.substring(r,r+4)==="null"||Te.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Te.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Te.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Te.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Te.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Te.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):c()),o=()=>{let p=r,f=!1;for(r++;r<t&&(n[r]!=='"'||f&&n[r-1]==="\\");)f=n[r]==="\\"?!f:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(p,++r-Number(f)))}catch(h){a(String(h))}else if(Te.STR&e)try{return JSON.parse(n.substring(p,r-Number(f))+'"')}catch{return JSON.parse(n.substring(p,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,d();let p={};try{for(;n[r]!=="}";){if(d(),r>=t&&Te.OBJ&e)return p;let f=o();d(),r++;try{let h=i();Object.defineProperty(p,f,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(Te.OBJ&e)return p;throw h}d(),n[r]===","&&r++}}catch{if(Te.OBJ&e)return p;s("Expected '}' at end of object")}return r++,p},u=()=>{r++;let p=[];try{for(;n[r]!=="]";)p.push(i()),d(),n[r]===","&&r++}catch{if(Te.ARR&e)return p;s("Expected ']' at end of array")}return r++,p},c=()=>{if(r===0){n==="-"&&Te.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(f){if(Te.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(f))}}let p=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Te.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(p,r))}catch{n.substring(p,r)==="-"&&Te.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(p,n.lastIndexOf("e")))}catch(h){a(String(h))}}},d=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return i()},Uh=n=>jC(n,Te.ALL^Te.NUM);var mi=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ee=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},xe,Wr,gi,An,Bh,Fc,zh,qh,Hh,Uc,Vh,$v,yi=class n extends hi{constructor(e){super(),xe.add(this),Wr.set(this,void 0),gi.set(this,void 0),An.set(this,void 0),mi(this,Wr,e,"f"),mi(this,gi,[],"f")}get currentChatCompletionSnapshot(){return ee(this,An,"f")}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new n(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){super._createChatCompletion;let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),ee(this,xe,"m",Bh).call(this);let a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let i of a)ee(this,xe,"m",zh).call(this,i);if(a.controller.signal?.aborted)throw new ae;return this._addChatCompletion(ee(this,xe,"m",Uc).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ee(this,xe,"m",Bh).call(this),this._connected();let s=fr.fromReadableStream(e,this.controller),a;for await(let i of s)a&&a!==i.id&&this._addChatCompletion(ee(this,xe,"m",Uc).call(this)),ee(this,xe,"m",zh).call(this,i),a=i.id;if(s.controller.signal?.aborted)throw new ae;return this._addChatCompletion(ee(this,xe,"m",Uc).call(this))}[(Wr=new WeakMap,gi=new WeakMap,An=new WeakMap,xe=new WeakSet,Bh=function(){this.ended||mi(this,An,void 0,"f")},Fc=function(t){let r=ee(this,gi,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ee(this,gi,"f")[t.index]=r,r)},zh=function(t){if(this.ended)return;let r=ee(this,xe,"m",$v).call(this,t);this._emit("chunk",t,r);for(let s of t.choices){let a=r.choices[s.index];s.delta.content!=null&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",s.delta.content,a.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),s.delta.refusal!=null&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:a.message.refusal}),s.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:a.logprobs?.content??[]}),s.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let i=ee(this,xe,"m",Fc).call(this,a);a.finish_reason&&(ee(this,xe,"m",Hh).call(this,a),i.current_tool_call_index!=null&&ee(this,xe,"m",qh).call(this,a,i.current_tool_call_index));for(let o of s.delta.tool_calls??[])i.current_tool_call_index!==o.index&&(ee(this,xe,"m",Hh).call(this,a),i.current_tool_call_index!=null&&ee(this,xe,"m",qh).call(this,a,i.current_tool_call_index)),i.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let l=a.message.tool_calls?.[o.index];l?.type&&(l?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:l.function?.name,index:o.index,arguments:l.function.arguments,parsed_arguments:l.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(l?.type,void 0))}}},qh=function(t,r){if(ee(this,xe,"m",Fc).call(this,t).done_tool_calls.has(r))return;let a=t.message.tool_calls?.[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){let i=ee(this,Wr,"f")?.tools?.find(o=>o.type==="function"&&o.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Ms(i)?i.$parseRaw(a.function.arguments):i?.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Hh=function(t){let r=ee(this,xe,"m",Fc).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let s=ee(this,xe,"m",Vh).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Uc=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");let t=ee(this,An,"f");if(!t)throw new S("request ended without sending any chunks");return mi(this,An,void 0,"f"),mi(this,gi,[],"f"),DC(t,ee(this,Wr,"f"))},Vh=function(){let t=ee(this,Wr,"f")?.response_format;return il(t)?t:null},$v=function(t){var r,s,a,i;let o=ee(this,An,"f"),{choices:l,...u}=t;o?Object.assign(o,u):o=mi(this,An,{...u,choices:[]},"f");for(let{delta:c,finish_reason:d,index:p,logprobs:f=null,...h}of t.choices){let m=o.choices[p];if(m||(m=o.choices[p]={finish_reason:d,index:p,message:{},logprobs:f,...h}),f)if(!m.logprobs)m.logprobs=Object.assign({},f);else{let{content:R,refusal:U,...T}=f;Object.assign(m.logprobs,T),R&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...R)),U&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...U))}if(d&&(m.finish_reason=d,ee(this,Wr,"f")&&Rh(ee(this,Wr,"f")))){if(d==="length")throw new ai;if(d==="content_filter")throw new ii}if(Object.assign(m,h),!c)continue;let{content:y,refusal:x,function_call:w,role:A,tool_calls:M,...N}=c;if(Object.assign(m.message,N),x&&(m.message.refusal=(m.message.refusal||"")+x),A&&(m.message.role=A),w&&(m.message.function_call?(w.name&&(m.message.function_call.name=w.name),w.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=w.arguments)):m.message.function_call=w),y&&(m.message.content=(m.message.content||"")+y,!m.message.refusal&&ee(this,xe,"m",Vh).call(this)&&(m.message.parsed=Uh(m.message.content))),M){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:R,id:U,type:T,function:re,...oe}of M){let ge=(i=m.message.tool_calls)[R]??(i[R]={});Object.assign(ge,oe),U&&(ge.id=U),T&&(ge.type=T),re&&(ge.function??(ge.function={name:re.name??"",arguments:""})),re?.name&&(ge.function.name=re.name),re?.arguments&&(ge.function.arguments+=re.arguments,Cv(ee(this,Wr,"f"),ge)&&(ge.function.parsed_arguments=Uh(ge.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new fr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function DC(n,e){let{id:t,choices:r,created:s,model:a,system_fingerprint:i,...o}=n,l={...o,id:t,choices:r.map(({message:u,finish_reason:c,index:d,logprobs:p,...f})=>{if(!c)throw new S(`missing finish_reason for choice ${d}`);let{content:h=null,function_call:m,tool_calls:y,...x}=u,w=u.role;if(!w)throw new S(`missing role for choice ${d}`);if(m){let{arguments:A,name:M}=m;if(A==null)throw new S(`missing function_call.arguments for choice ${d}`);if(!M)throw new S(`missing function_call.name for choice ${d}`);return{...f,message:{content:h,function_call:{arguments:A,name:M},role:w,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:p}}return y?{...f,index:d,finish_reason:c,logprobs:p,message:{...x,role:w,content:h,refusal:u.refusal??null,tool_calls:y.map((A,M)=>{let{function:N,type:R,id:U,...T}=A,{arguments:re,name:oe,...ge}=N||{};if(U==null)throw new S(`missing choices[${d}].tool_calls[${M}].id
${Bc(n)}`);if(R==null)throw new S(`missing choices[${d}].tool_calls[${M}].type
${Bc(n)}`);if(oe==null)throw new S(`missing choices[${d}].tool_calls[${M}].function.name
${Bc(n)}`);if(re==null)throw new S(`missing choices[${d}].tool_calls[${M}].function.arguments
${Bc(n)}`);return{...T,id:U,type:R,function:{...ge,name:oe,arguments:re}}})}}:{...f,message:{...x,content:h,role:w,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:p}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Sv(l,e)}function Bc(n){return JSON.stringify(n)}var ul=class n extends yi{static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let s=new n(null),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new n(t),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}};var cl=class extends b{parse(e,t){return kv(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>ol(r,e))}runFunctions(e,t){return e.stream?ul.runFunctions(this._client,e,t):ll.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ul.runTools(this._client,e,t):ll.runTools(this._client,e,t)}stream(e,t){return yi.createChatCompletion(this._client,e,t)}};var bi=class extends b{constructor(){super(...arguments),this.completions=new cl(this._client)}};(function(n){n.Completions=cl})(bi||(bi={}));var wi=class extends b{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var _i=class extends b{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var En=class extends b{constructor(){super(...arguments),this.sessions=new wi(this._client),this.transcriptionSessions=new _i(this._client)}};En.Sessions=wi;En.TranscriptionSessions=_i;var js=class extends b{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,vi,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},vi=class extends K{};js.MessagesPage=vi;var Ls=class extends b{retrieve(e,t,r,s={},a){return B(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t,r={},s){return B(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,xi,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}},xi=class extends K{};Ls.RunStepsPage=xi;var Jr=class extends b{constructor(){super(...arguments),this.steps=new Ls(this._client)}create(e,t,r){let{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ai,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return yr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let l=i.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Hr(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,r){return yr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){let a=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,r,s){return yr.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}},Ai=class extends K{};Jr.RunsPage=Ai;Jr.Steps=Ls;Jr.RunStepsPage=xi;var br=class extends b{constructor(){super(...arguments),this.runs=new Jr(this._client),this.messages=new js(this._client)}create(e={},t){return B(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return yr.createThreadAssistantStream(e,this._client.beta.threads,t)}};br.Runs=Jr;br.RunsPage=Ai;br.Messages=js;br.MessagesPage=vi;var Xt=class extends b{constructor(){super(...arguments),this.realtime=new En(this._client),this.chat=new bi(this._client),this.assistants=new $s(this._client),this.threads=new br(this._client)}};Xt.Realtime=En;Xt.Assistants=$s;Xt.AssistantsPage=fi;Xt.Threads=br;var Ds=class extends b{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Ei=class extends b{retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}/content`,{...r,headers:{Accept:"application/binary",...r?.headers},__binaryResponse:!0})}};var In=class extends b{constructor(){super(...arguments),this.content=new Ei(this._client)}create(e,t,r){return this._client.post(`/containers/${e}/files`,dt({body:t,...r}))}retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}`,r)}list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Ii,{query:t,...r})}del(e,t,r){return this._client.delete(`/containers/${e}/files/${t}`,{...r,headers:{Accept:"*/*",...r?.headers}})}},Ii=class extends K{};In.FileListResponsesPage=Ii;In.Content=Ei;var wr=class extends b{constructor(){super(...arguments),this.files=new In(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/containers",Fs,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}},Fs=class extends K{};wr.ContainerListResponsesPage=Fs;wr.Files=In;wr.FileListResponsesPage=Ii;var Us=class extends b{create(e,t){let r=!!e.encoding_format,s=r?e.encoding_format:"base64";r&&qr("Request","User defined encoding_format:",e.encoding_format);let a=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?a:(qr("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{let l=o.embedding;o.embedding=_v(l)}),i)))}};var Bs=class extends b{retrieve(e,t,r,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,s)}list(e,t,r={},s){return B(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,Oi,{query:r,...s})}},Oi=class extends K{};Bs.OutputItemListResponsesPage=Oi;var Zr=class extends b{constructor(){super(...arguments),this.outputItems=new Bs(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Pi,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}},Pi=class extends K{};Zr.RunListResponsesPage=Pi;Zr.OutputItems=Bs;Zr.OutputItemListResponsesPage=Oi;var _r=class extends b{constructor(){super(...arguments),this.runs=new Zr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/evals",zs,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},zs=class extends K{};_r.EvalListResponsesPage=zs;_r.Runs=Zr;_r.RunListResponsesPage=Pi;var On=class extends b{create(e,t){return this._client.post("/files",dt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/files",qs,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),a=Date.now(),i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Hr(t),i=await this.retrieve(e),Date.now()-a>r)throw new Jt({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}},qs=class extends K{};On.FileObjectsPage=qs;var Ti=class extends b{};var Si=class extends b{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var Hs=class extends b{constructor(){super(...arguments),this.graders=new Si(this._client)}};Hs.Graders=Si;var Vs=class extends b{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Ci,{body:t,method:"post",...r})}retrieve(e,t={},r){return B(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}},Ci=class extends hr{};Vs.PermissionCreateResponsesPage=Ci;var Pn=class extends b{constructor(){super(...arguments),this.permissions=new Vs(this._client)}};Pn.Permissions=Vs;Pn.PermissionCreateResponsesPage=Ci;var Gs=class extends b{list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ki,{query:t,...r})}},ki=class extends K{};Gs.FineTuningJobCheckpointsPage=ki;var vr=class extends b{constructor(){super(...arguments),this.checkpoints=new Gs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ri,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return B(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ni,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},Ri=class extends K{},Ni=class extends K{};vr.FineTuningJobsPage=Ri;vr.FineTuningJobEventsPage=Ni;vr.Checkpoints=Gs;vr.FineTuningJobCheckpointsPage=ki;var _t=class extends b{constructor(){super(...arguments),this.methods=new Ti(this._client),this.jobs=new vr(this._client),this.checkpoints=new Pn(this._client),this.alpha=new Hs(this._client)}};_t.Methods=Ti;_t.Jobs=vr;_t.FineTuningJobsPage=Ri;_t.FineTuningJobEventsPage=Ni;_t.Checkpoints=Pn;_t.Alpha=Hs;var $i=class extends b{};var Tn=class extends b{constructor(){super(...arguments),this.graderModels=new $i(this._client)}};Tn.GraderModels=$i;var Ks=class extends b{createVariation(e,t){return this._client.post("/images/variations",dt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",dt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var Sn=class extends b{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ws,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Ws=class extends hr{};Sn.ModelsPage=Ws;var Js=class extends b{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function Mv(n,e){return!e||!ok(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Gh(n,e)}function Gh(n,e){let t=n.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:ck(e,s)};if(s.type==="message"){let a=s.content.map(i=>i.type==="output_text"?{...i,parsed:ik(e,i.text)}:i);return{...s,content:a}}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||Kh(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let s of r.output)if(s.type==="message"){for(let a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function ik(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function ok(n){return!!il(n.text?.format)}function lk(n){return n?.$brand==="auto-parseable-tool"}function uk(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function ck(n,e){let t=uk(n.tools??[],e.name);return{...e,...e,parsed_arguments:lk(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function Kh(n){let e=[];for(let t of n.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var Mi=class extends b{list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,zc,{query:t,...r})}};var ji=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Cn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Li,qc,kn,Hc,jv,Lv,Dv,Fv,Vc=class n extends vn{constructor(e){super(),Li.add(this),qc.set(this,void 0),kn.set(this,void 0),Hc.set(this,void 0),ji(this,qc,e,"f")}static createResponse(e,t,r){let s=new n(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Cn(this,Li,"m",jv).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let o of a)Cn(this,Li,"m",Lv).call(this,o,i);if(a.controller.signal?.aborted)throw new ae;return Cn(this,Li,"m",Dv).call(this)}[(qc=new WeakMap,kn=new WeakMap,Hc=new WeakMap,Li=new WeakSet,jv=function(){this.ended||ji(this,kn,void 0,"f")},Lv=function(t,r){if(this.ended)return;let s=(i,o)=>{(r==null||o.sequence_number>r)&&this._emit(i,o)},a=Cn(this,Li,"m",Fv).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let i=a.output[t.output_index];if(!i)throw new S(`missing output at index ${t.output_index}`);if(i.type==="message"){let o=i.content[t.content_index];if(!o)throw new S(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new S(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let i=a.output[t.output_index];if(!i)throw new S(`missing output at index ${t.output_index}`);i.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:s(t.type,t);break}},Dv=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");let t=Cn(this,kn,"f");if(!t)throw new S("request ended without sending any events");ji(this,kn,void 0,"f");let r=pk(t,Cn(this,qc,"f"));return ji(this,Hc,r,"f"),r},Fv=function(t){let r=Cn(this,kn,"f");if(!r){if(t.type!=="response.created")throw new S(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=ji(this,kn,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let s=r.output[t.output_index];if(!s)throw new S(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{let s=r.output[t.output_index];if(!s)throw new S(`missing output at index ${t.output_index}`);if(s.type==="message"){let a=s.content[t.content_index];if(!a)throw new S(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new S(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=r.output[t.output_index];if(!s)throw new S(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{ji(this,kn,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=Cn(this,Hc,"f");if(!e)throw new S("stream ended without producing a ChatCompletion");return e}};function pk(n,e){return Mv(n,e)}var Rn=class extends b{constructor(){super(...arguments),this.inputItems=new Mi(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&Kh(r),r))}retrieve(e,t={},r){return this._client.get(`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Gh(r,e))}stream(e,t){return Vc.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}},zc=class extends K{};Rn.InputItems=Mi;var Di=class extends b{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,dt({body:t,...r}))}};var Nn=class extends b{constructor(){super(...arguments),this.parts=new Di(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};Nn.Parts=Di;var Uv=async n=>{let e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let s of e)s.status==="fulfilled"&&r.push(s.value);return r};var $n=class extends b{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return B(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Mn,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let a=await this.retrieve(e,t,{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let l=a.response.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Hr(o);break;case"failed":case"completed":return i}}}async upload(e,t,r){let s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){let s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Fi,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},Mn=class extends K{},Fi=class extends hr{};$n.VectorStoreFilesPage=Mn;$n.FileContentResponsesPage=Fi;var Ui=class extends b{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return B(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Mn,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let l=i.headers.get("openai-poll-after-ms");if(l){let u=parseInt(l);isNaN(u)||(o=u)}}await Hr(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=s?.maxConcurrency??5,i=Math.min(a,t.length),o=this._client,l=t.values(),u=[...r];async function c(p){for(let f of p){let h=await o.files.create({file:f,purpose:"assistants"},s);u.push(h.id)}}let d=Array(i).fill(l).map(c);return await Uv(d),await this.createAndPoll(e,{file_ids:u})}};var vt=class extends b{constructor(){super(...arguments),this.files=new $n(this._client),this.fileBatches=new Ui(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/vector_stores",Zs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,Ys,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},Zs=class extends K{},Ys=class extends hr{};vt.VectorStoresPage=Zs;vt.VectorStoreSearchResponsesPage=Ys;vt.Files=$n;vt.VectorStoreFilesPage=Mn;vt.FileContentResponsesPage=Fi;vt.FileBatches=Ui;var Bv,F=class extends Pc{constructor({baseURL:e=Yo("OPENAI_BASE_URL"),apiKey:t=Yo("OPENAI_API_KEY"),organization:r=Yo("OPENAI_ORG_ID")??null,project:s=Yo("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new S("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let i={apiKey:t,organization:r,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&wv())throw new S(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Ds(this),this.chat=new Gr(this),this.embeddings=new Us(this),this.files=new On(this),this.images=new Ks(this),this.audio=new mr(this),this.moderations=new Js(this),this.models=new Sn(this),this.fineTuning=new _t(this),this.graders=new Tn(this),this.vectorStores=new vt(this),this.beta=new Xt(this),this.batches=new _n(this),this.uploads=new Nn(this),this.responses=new Rn(this),this.evals=new _r(this),this.containers=new wr(this),this._options=i,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return ch(e,{arrayFormat:"brackets"})}};Bv=F;F.OpenAI=Bv;F.DEFAULT_TIMEOUT=6e5;F.OpenAIError=S;F.APIError=me;F.APIConnectionError=zr;F.APIConnectionTimeoutError=Jt;F.APIUserAbortError=ae;F.NotFoundError=ei;F.ConflictError=ti;F.RateLimitError=ni;F.BadRequestError=Ya;F.AuthenticationError=Xa;F.InternalServerError=si;F.PermissionDeniedError=Qa;F.UnprocessableEntityError=ri;F.toFile=Ah;F.fileFromPath=_c;F.Completions=Ds;F.Chat=Gr;F.ChatCompletionsPage=wn;F.Embeddings=Us;F.Files=On;F.FileObjectsPage=qs;F.Images=Ks;F.Audio=mr;F.Moderations=Js;F.Models=Sn;F.ModelsPage=Ws;F.FineTuning=_t;F.Graders=Tn;F.VectorStores=vt;F.VectorStoresPage=Zs;F.VectorStoreSearchResponsesPage=Ys;F.Beta=Xt;F.Batches=_n;F.BatchesPage=ks;F.Uploads=Nn;F.Responses=Rn;F.Evals=_r;F.EvalListResponsesPage=zs;F.Containers=wr;F.ContainerListResponsesPage=Fs;Pr();function jn(n){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i}=n;if((r||i)&&s&&e)return`${s}/${e}`;if(r||i){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}Pr();function Bi(n){let e;return n.constructor.name===Jt.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===ae.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}function yk(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function zv(n){let e=["namespace functions {",""];for(let t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(qv(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function qv(n,e){let t=[];for(let[r,s]of Object.entries(n.properties??{}))s.description&&e<2&&t.push(`// ${s.description}`),n.required?.includes(r)?t.push(`${r}: ${Gc(s,e)},`):t.push(`${r}?: ${Gc(s,e)},`);return t.map(r=>" ".repeat(e)+r).join(`
`)}function Gc(n,e){if(yk(n))return n.anyOf.map(t=>Gc(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",qv(n,e+2),"}"].join(`
`);case"array":return n.items?`${Gc(n.items,e)}[]`:"any[]";default:return""}}function bk(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function Gv(n){let e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ce.isInstance(n))throw new Error("Invalid generic chat message");return bk(n)}default:throw new Error(`Unknown message type: ${e}`)}}function wk(n){let e=n.tool_calls;switch(n.role){case"assistant":{let t=[],r=[];for(let s of e??[])try{t.push(Wo(s,{returnId:!0}))}catch(a){r.push(mc(s,a.message))}return new se({content:n.content||"",tool_calls:t,invalid_tool_calls:r,additional_kwargs:{function_call:n.function_call,tool_calls:e}})}default:return new Ce(n.content||"",n.role??"unknown")}}function _k(n,e){let t=n.role??e,r=n.content??"",s;if(n.function_call?s={function_call:n.function_call}:n.tool_calls?s={tool_calls:n.tool_calls}:s={},t==="user")return new Cr({content:r});if(t==="assistant"){let a=[];if(Array.isArray(n.tool_calls))for(let i of n.tool_calls)a.push({name:i.function?.name,args:i.function?.arguments,id:i.id,index:i.index});return new le({content:r,tool_call_chunks:a,additional_kwargs:s})}else return t==="system"?new kr({content:r}):t==="function"?new ns({content:r,additional_kwargs:s,name:n.name}):t==="tool"?new pa({content:r,additional_kwargs:s,tool_call_id:n.tool_call_id}):new Sr({content:r,role:t})}function Hv(n){return n.map(e=>{let t={role:Gv(e),content:e.content};return e.name!=null&&(t.name=e.name),e.additional_kwargs.function_call!=null&&(t.function_call=e.additional_kwargs.function_call),ts(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(hc):(e.additional_kwargs.tool_calls!=null&&(t.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(t.tool_call_id=e.tool_call_id)),t})}var zi=class extends Dr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??Q("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??Q("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=e?.azureADTokenProvider??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??Q("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??Q("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??Q("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??Q("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??Q("OPENAI_ORGANIZATION"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){return this.bind({tools:e.map(Ua),...t})}invocationParams(e){function t(s){return s!==void 0&&s.every(a=>Array.isArray(a.lc_namespace))}return{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:t(e?.tools)?e?.tools.map(Ua):e?.tools,tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...e?.stream_options!==void 0?{stream_options:e.stream_options}:{},parallel_tool_calls:e?.parallel_tool_calls,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){let s=Hv(e),a={...this.invocationParams(t),messages:s,stream:!0},i,o=await this.completionWithRetry(a,t),l;for await(let u of o){let c=u?.choices[0];if(u.usage&&(l=u.usage),!c)continue;let{delta:d}=c;if(!d)continue;let p=_k(d,i);i=d.role??i;let f={prompt:t.promptIndex??0,completion:c.index??0};if(typeof p.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let h={...f};c.finish_reason!==void 0&&(h.finish_reason=c.finish_reason),this.logprobs&&(h.logprobs=c.logprobs);let m=new Ie({message:p,text:p.content,generationInfo:h});yield m,r?.handleLLMNewToken(m.text??"",f,void 0,void 0,void 0,{chunk:m})}if(l&&(yield new Ie({message:new le({content:"",usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens}}),text:""})),t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){let s={},a=this.invocationParams(t),i=Hv(e);if(a.stream){let o=this._streamResponseChunks(e,t,r),l={};for await(let h of o){h.message.response_metadata={...h.generationInfo,...h.message.response_metadata};let m=h.generationInfo?.completion??0;l[m]===void 0?l[m]=h:l[m]=l[m].concat(h)}let u=Object.entries(l).sort(([h],[m])=>parseInt(h,10)-parseInt(m,10)).map(([h,m])=>m),{functions:c,function_call:d}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,c,d),f=await this.getNumTokensFromGenerations(u);return s.promptTokens=p,s.completionTokens=f,s.totalTokens=p+f,{generations:u,llmOutput:{estimatedTokenUsage:s}}}else{let o=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t?.signal,...t?.options}),{completion_tokens:l,prompt_tokens:u,total_tokens:c}=o?.usage??{};l&&(s.completionTokens=(s.completionTokens??0)+l),u&&(s.promptTokens=(s.promptTokens??0)+u),c&&(s.totalTokens=(s.totalTokens??0)+c);let d=[];for(let p of o?.choices??[]){let h={text:p.message?.content??"",message:wk(p.message??{role:"assistant"})};h.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},ts(h.message)&&(h.message.usage_metadata={input_tokens:s.promptTokens??0,output_tokens:s.completionTokens??0,total_tokens:s.totalTokens??0}),d.push(h)}return{generations:d,llmOutput:{tokenUsage:s}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){let a=zv(t);s+=await this.getNumTokens(a),s+=9}return t&&e.find(a=>a._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>r.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);let a=await Promise.all(e.map(async i=>{let o=await this.getNumTokens(i.content),l=await this.getNumTokens(Gv(i)),u=i.name!==void 0?s+await this.getNumTokens(i.name):0,c=o+r+l+u,d=i;if(d._getType()==="function"&&(c-=2),d.additional_kwargs?.function_call&&(c+=3),d?.additional_kwargs.function_call?.name&&(c+=await this.getNumTokens(d.additional_kwargs.function_call?.name)),d.additional_kwargs.function_call?.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse(d.additional_kwargs.function_call?.arguments)))}catch(p){console.error("Error parsing function arguments",p,JSON.stringify(d.additional_kwargs.function_call)),c+=await this.getNumTokens(d.additional_kwargs.function_call?.arguments)}return t+=c,c}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw Bi(s)}})}_getClientOptions(e){if(!this.client){let r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=jn(r),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new F(a)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,s,a,i;vk(e)?(r=e.schema,s=e.name,a=e.method,i=e.includeRaw):(r=e,s=t?.name,a=t?.method,i=t?.includeRaw);let o,l;if(a==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Vv(r)?l=ka.fromZodSchema(r):l=new Ra;else{let p=s??"extract";if(Vv(r)){let f=Fe(r);o=this.bind({tools:[{type:"function",function:{name:p,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:p}}}),l=new yn({returnSingle:!0,keyName:p,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,p=r.name):(p=r.title??p,f={name:p,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:p}}}),l=new yn({returnSingle:!0,keyName:p})}}if(!i)return o.pipe(l);let u=$e.assign({parsed:(p,f)=>l.invoke(p.raw,f)}),c=$e.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return gt.from([{raw:o},d])}};function Vv(n){return typeof n?.parse=="function"}function vk(n){return n!==void 0&&typeof n.schema=="object"}ms();Oa();Ea();Nu();Su();ar();es();Ea();hs();fa();Ia();Ml();var Wh=class extends So{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat}async invoke(e,t){let r,s;ma(e)?(r=e.id,s=e.args):s=e;let a=Z(t);return this.call(s,{...a,configurable:{...a.configurable,tool_call_id:r}})}async call(e,t,r){let s;try{s=await this.schema.parseAsync(e)}catch(f){let h="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(h=`${h}
Details: ${f.message}`),new ha(h,JSON.stringify(e))}let a=Nw(t),o=await(await Ne.configure(a.callbacks,this.callbacks,a.tags||r,this.tags,a.metadata,this.metadata,{verbose:this.verbose}))?.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),a.runId,void 0,void 0,void 0,a.runName);delete a.runId;let l;try{l=await this._call(s,o,a)}catch(f){throw await o?.handleToolError(f),f}let u,c;if(this.responseFormat==="content_and_artifact")if(Array.isArray(l)&&l.length===2)[u,c]=l;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(l)}`);else u=l;let d;a&&"configurable"in a&&(d=a.configurable.tool_call_id);let p=xk({content:u,artifact:c,toolCallId:d,name:this.name});return await o?.handleToolEnd(p),p}},Kc=class extends Wh{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:rt.object({input:rt.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}};function xk(n){let{content:e,artifact:t,toolCallId:r}=n;return r?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new Tr({content:e,artifact:t,tool_call_id:r,name:n.name}):new Tr({content:Ak(e),artifact:t,tool_call_id:r,name:n.name}):e}function Ak(n){try{return JSON.stringify(n,null,2)}catch{return`${n}`}}var Jh=class extends Kc{static lc_name(){return"DallEAPIWrapper"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=e?.apiKey??e?.openAIApiKey??Q("OPENAI_API_KEY"),r=e?.organization??Q("OPENAI_ORGANIZATION"),s={apiKey:t,organization:r,dangerouslyAllowBrowser:!0};this.client=new F(s),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.responseFormat=e?.responseFormat??this.responseFormat,this.user=e?.user}async _call(e){let t=await this.client.images.generate({model:this.model,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user}),r="";return this.responseFormat==="url"?[r]=t.data.map(s=>s.url).filter(s=>s!=="undefined"):[r]=t.data.map(s=>s.b64_json).filter(s=>s!=="undefined"),r}};Object.defineProperty(Jh,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var lm=At(Yv());var Wc,Tk=new Uint8Array(16);function Zh(){if(!Wc&&(Wc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Wc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Wc(Tk)}var je=[];for(let n=0;n<256;++n)je.push((n+256).toString(16).slice(1));function Xv(n,e=0){return je[n[e+0]]+je[n[e+1]]+je[n[e+2]]+je[n[e+3]]+"-"+je[n[e+4]]+je[n[e+5]]+"-"+je[n[e+6]]+je[n[e+7]]+"-"+je[n[e+8]]+je[n[e+9]]+"-"+je[n[e+10]]+je[n[e+11]]+je[n[e+12]]+je[n[e+13]]+je[n[e+14]]+je[n[e+15]]}var Sk=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yh={randomUUID:Sk};function Ck(n,e,t){if(Yh.randomUUID&&!e&&!n)return Yh.randomUUID();n=n||{};let r=n.random||(n.rng||Zh)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Xv(r)}var Xs=Ck;var Jc=class{constructor(e){this.secret=e}_encode(e){return new TextEncoder().encode(e)}_decode(e){return new TextDecoder().decode(e)}async _importKey(e){let t=await crypto.subtle.importKey("raw",this._encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:this._encode("salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async _encrypt(e){let t=await this._importKey(this.secret),r=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,this._encode(e));return{iv:r,encrypted:s}}async _decrypt(e,t){let r=await this._importKey(this.secret),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},r,e);return this._decode(s)}async saveAPIKey(e,t){let{iv:r,encrypted:s}=await this._encrypt(t),a={iv:Array.from(r),encrypted:Array.from(new Uint8Array(s))};localStorage.setItem(e,JSON.stringify(a))}async getAPIKey(e){let t=localStorage.getItem(e);if(!t)return null;let{iv:r,encrypted:s}=JSON.parse(t);return await this._decrypt(new Uint8Array(s),new Uint8Array(r))}deleteAPIKey(e){localStorage.removeItem(e)}apiKeyExists(e){return localStorage.getItem(e)!==null}};var xt=["OpenAI","Google","Ollama","Groq","Anthropic","MistralAI","Deepseek","Cohere","Hugging Face","Replicate","Together AI","Perplexity","AI21 Labs","Aleph Alpha","Stability AI","Fireworks AI","Anyscale","Modal","Runpod","Banana","Cerebras","Lepton AI","Novita AI","DeepInfra","Monster API","Cloudflare Workers AI","Azure OpenAI","AWS Bedrock","OpenAI-Like"],ft="OpenAI-Like",Qv='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14L21 3m0 0l-6.5 18a.55.55 0 0 1-1 0L10 14l-7-3.5a.55.55 0 0 1 0-1L21 3"/></svg>',ex='<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M15 37.95q-1.25 0-2.125-.875T12 34.95v-28q0-1.25.875-2.125T15 3.95h22q1.25 0 2.125.875T40 6.95v28q0 1.25-.875 2.125T37 37.95Zm0-3h22v-28H15v28Zm-6 9q-1.25 0-2.125-.875T6 40.95V12.3q0-.65.425-1.075Q6.85 10.8 7.5 10.8q.65 0 1.075.425Q9 11.65 9 12.3v28.65h22.2q.65 0 1.075.425.425.425.425 1.075 0 .65-.425 1.075-.425.425-1.075.425Zm6-37v28-28Z"/></svg>',tx='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-stop"><circle cx="12" cy="12" r="10"/><rect width="6" height="6" x="9" y="9"/></svg>',rx='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4,17 10,11 4,5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>';var nx='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>',sx='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',ax='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/></svg>',ix='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>',ox='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>',dl=["nmap","nikto","sqlmap","gobuster","ffuf","burpsuite","nuclei","subfinder","httpx","waybackurls","gau","amass","masscan","zap","metasploit","john","hashcat","hydra","dirb","wpscan","shodan","recon-ng","theHarvester","dnsrecon","fierce"],lx=["python","javascript","bash","shell","node","php","ruby","perl","go","rust","java","c","cpp","powershell"];var Le=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},Qe={searchParams:"URLSearchParams"in Le,iterable:"Symbol"in Le&&"iterator"in Symbol,blob:"FileReader"in Le&&"Blob"in Le&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in Le,arrayBuffer:"ArrayBuffer"in Le};function kk(n){return n&&DataView.prototype.isPrototypeOf(n)}Qe.arrayBuffer&&(ux=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],dx=ArrayBuffer.isView||function(n){return n&&ux.indexOf(Object.prototype.toString.call(n))>-1});var ux,dx;function qi(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function Qh(n){return typeof n!="string"&&(n=String(n)),n}function em(n){var e={next:function(){var t=n.shift();return{done:t===void 0,value:t}}};return Qe.iterable&&(e[Symbol.iterator]=function(){return e}),e}function Ae(n){this.map={},n instanceof Ae?n.forEach(function(e,t){this.append(t,e)},this):Array.isArray(n)?n.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(e){this.append(e,n[e])},this)}Ae.prototype.append=function(n,e){n=qi(n),e=Qh(e);var t=this.map[n];this.map[n]=t?t+", "+e:e};Ae.prototype.delete=function(n){delete this.map[qi(n)]};Ae.prototype.get=function(n){return n=qi(n),this.has(n)?this.map[n]:null};Ae.prototype.has=function(n){return this.map.hasOwnProperty(qi(n))};Ae.prototype.set=function(n,e){this.map[qi(n)]=Qh(e)};Ae.prototype.forEach=function(n,e){for(var t in this.map)this.map.hasOwnProperty(t)&&n.call(e,this.map[t],t,this)};Ae.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),em(n)};Ae.prototype.values=function(){var n=[];return this.forEach(function(e){n.push(e)}),em(n)};Ae.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),em(n)};Qe.iterable&&(Ae.prototype[Symbol.iterator]=Ae.prototype.entries);function Xh(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function px(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function Rk(n){var e=new FileReader,t=px(e);return e.readAsArrayBuffer(n),t}function Nk(n){var e=new FileReader,t=px(e),r=/charset=([A-Za-z0-9_-]+)/.exec(n.type),s=r?r[1]:"utf-8";return e.readAsText(n,s),t}function $k(n){for(var e=new Uint8Array(n),t=new Array(e.length),r=0;r<e.length;r++)t[r]=String.fromCharCode(e[r]);return t.join("")}function cx(n){if(n.slice)return n.slice(0);var e=new Uint8Array(n.byteLength);return e.set(new Uint8Array(n)),e.buffer}function fx(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:Qe.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:Qe.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:Qe.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():Qe.arrayBuffer&&Qe.blob&&kk(n)?(this._bodyArrayBuffer=cx(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Qe.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||dx(n))?this._bodyArrayBuffer=cx(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Qe.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Qe.blob&&(this.blob=function(){var n=Xh(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=Xh(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(Qe.blob)return this.blob().then(Rk);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=Xh(this);if(n)return n;if(this._bodyBlob)return Nk(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve($k(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Qe.formData&&(this.formData=function(){return this.text().then(Lk)}),this.json=function(){return this.text().then(JSON.parse)},this}var Mk=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function jk(n){var e=n.toUpperCase();return Mk.indexOf(e)>-1?e:n}function ea(n,e){if(!(this instanceof ea))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(n instanceof ea){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,e.headers||(this.headers=new Ae(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!t&&n._bodyInit!=null&&(t=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new Ae(e.headers)),this.method=jk(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in Le){var a=new AbortController;return a.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}ea.prototype.clone=function(){return new ea(this,{body:this._bodyInit})};function Lk(n){var e=new FormData;return n.trim().split("&").forEach(function(t){if(t){var r=t.split("="),s=r.shift().replace(/\+/g," "),a=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(a))}}),e}function Dk(n){var e=new Ae,t=n.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),a=s.shift().trim();if(a){var i=s.join(":").trim();try{e.append(a,i)}catch(o){console.warn("Response "+o.message)}}}),e}fx.call(ea.prototype);function xr(n,e){if(!(this instanceof xr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new Ae(e.headers),this.url=e.url||"",this._initBody(n)}fx.call(xr.prototype);xr.prototype.clone=function(){return new xr(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Ae(this.headers),url:this.url})};xr.error=function(){var n=new xr(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var Fk=[301,302,303,307,308];xr.redirect=function(n,e){if(Fk.indexOf(e)===-1)throw new RangeError("Invalid status code");return new xr(null,{status:e,headers:{location:n}})};var Qs=Le.DOMException;try{new Qs}catch{Qs=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},Qs.prototype=Object.create(Error.prototype),Qs.prototype.constructor=Qs}function hx(n,e){return new Promise(function(t,r){var s=new ea(n,e);if(s.signal&&s.signal.aborted)return r(new Qs("Aborted","AbortError"));var a=new XMLHttpRequest;function i(){a.abort()}a.onload=function(){var u={statusText:a.statusText,headers:Dk(a.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(a.status<200||a.status>599)?u.status=200:u.status=a.status,u.url="responseURL"in a?a.responseURL:u.headers.get("X-Request-URL");var c="response"in a?a.response:a.responseText;setTimeout(function(){t(new xr(c,u))},0)},a.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},a.onabort=function(){setTimeout(function(){r(new Qs("Aborted","AbortError"))},0)};function o(u){try{return u===""&&Le.location.href?Le.location.href:u}catch{return u}}if(a.open(s.method,o(s.url),!0),s.credentials==="include"?a.withCredentials=!0:s.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(Qe.blob?a.responseType="blob":Qe.arrayBuffer&&(a.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof Ae||Le.Headers&&e.headers instanceof Le.Headers)){var l=[];Object.getOwnPropertyNames(e.headers).forEach(function(u){l.push(qi(u)),a.setRequestHeader(u,Qh(e.headers[u]))}),s.headers.forEach(function(u,c){l.indexOf(c)===-1&&a.setRequestHeader(c,u)})}else s.headers.forEach(function(u,c){a.setRequestHeader(c,u)});s.signal&&(s.signal.addEventListener("abort",i),a.onreadystatechange=function(){a.readyState===4&&s.signal.removeEventListener("abort",i)}),a.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}hx.polyfill=!0;Le.fetch||(Le.fetch=hx,Le.Headers=Ae,Le.Request=ea,Le.Response=xr);var gx="11434",yx=`http://127.0.0.1:${gx}`,Uk="0.5.18",Bk=Object.defineProperty,zk=(n,e,t)=>e in n?Bk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,tm=(n,e,t)=>(zk(n,typeof e!="symbol"?e+"":e,t),t),nm=class n extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,n)}},sm=class{constructor(e,t,r){tm(this,"abortController"),tm(this,"itr"),tm(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},am=async n=>{if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if(n.headers.get("content-type")?.includes("application/json"))try{t=await n.json(),e=t.error||e}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch{console.log("Failed to get text from error response")}throw new nm(e,n.status)};function qk(){if(typeof window<"u"&&window.navigator){let n=navigator;return"userAgentData"in n&&n.userAgentData?.platform?`${n.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process<"u")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function Hk(n){if(n instanceof Headers){let e={};return n.forEach((t,r)=>{e[r]=t}),e}else return Array.isArray(n)?Object.fromEntries(n):n||{}}var im=async(n,e,t={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${Uk} (${qk()})`};t.headers=Hk(t.headers);let s=Object.fromEntries(Object.entries(t.headers).filter(([a])=>!Object.keys(r).some(i=>i.toLowerCase()===a.toLowerCase())));return t.headers={...r,...s},n(e,t)},mx=async(n,e,t)=>{let r=await im(n,e,{headers:t?.headers});return await am(r),r},Hi=async(n,e,t,r)=>{let a=(o=>o!==null&&typeof o=="object"&&!Array.isArray(o))(t)?JSON.stringify(t):t,i=await im(n,e,{method:"POST",body:a,signal:r?.signal,headers:r?.headers});return await am(i),i},Vk=async(n,e,t,r)=>{let s=await im(n,e,{method:"DELETE",body:JSON.stringify(t),headers:r?.headers});return await am(s),s},Gk=async function*(n){let e=new TextDecoder("utf-8"),t="",r=n.getReader();for(;;){let{done:s,value:a}=await r.read();if(s)break;t+=e.decode(a);let i=t.split(`
`);t=i.pop()??"";for(let o of i)try{yield JSON.parse(o)}catch{console.warn("invalid json: ",o)}}for(let s of t.split(`
`).filter(a=>a!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},Kk=n=>{if(!n)return yx;let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);let t=new URL(n),r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r=gx);let s="";t.username&&(s=t.username,t.password&&(s+=`:${t.password}`),s+="@");let a=`${t.protocol}//${s}${t.hostname}:${r}${t.pathname}`;return a.endsWith("/")&&(a=a.slice(0,-1)),a},Wk=Object.defineProperty,Jk=(n,e,t)=>e in n?Wk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,rm=(n,e,t)=>(Jk(n,typeof e!="symbol"?e+"":e,t),t),om=class{constructor(e){rm(this,"config"),rm(this,"fetch"),rm(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e?.headers},e?.proxy||(this.config.host=Kk(e?.host??yx)),this.fetch=e?.fetch??fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;let r=`${this.config.host}/api/${e}`;if(t.stream){let a=new AbortController,i=await Hi(this.fetch,r,t,{signal:a.signal,headers:this.config.headers});if(!i.body)throw new Error("Missing body");let o=Gk(i.body),l=new sm(a,o,()=>{let u=this.ongoingStreamedRequests.indexOf(l);u>-1&&this.ongoingStreamedRequests.splice(u,1)});return this.ongoingStreamedRequests.push(l),l}return await(await Hi(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let t=new Uint8Array(e),r="",s=t.byteLength;for(let a=0;a<s;a++)r+=String.fromCharCode(t[a]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await Vk(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await Hi(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await mx(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await Hi(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await Hi(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await Hi(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await mx(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},$8=new om;async function Zc(n,e){let t;try{switch(n){case xt[0]:let r=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok)throw acode.alert("AI Assistant",`Error fetching OpenAI models: ${r.statusText}`),new Error(`Error fetching OpenAI models: ${r.statusText}`);t=(await r.json()).data.filter(T=>/gpt/i.test(T.id)).map(T=>T.id);break;case xt[1]:let a=await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${e}`,{headers:{"Content-Type":"application/json"}});if(!a.ok)throw acode.alert("AI Assistant",`Error fetching Google AI models: ${a.statusText}`),new Error(`Error fetching Google AI models: ${a.statusText}`);t=(await a.json()).models.filter(T=>/gemini/i.test(T.name)).map(T=>T.name.replace(/^models\//,""));break;case xt[2]:let o=window.localStorage.getItem("Ollama-Host")?window.localStorage.getItem("Ollama-Host"):"http://localhost:11434";t=(await new om({host:o}).list()).models.map(T=>T.model);break;case xt[3]:let c=await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!c.ok)throw acode.alert("AI Assistant",`Error fetching Groq AI models: ${c.statusText}`),new Error(`Error fetching Groq AI models: ${c.statusText}`);t=(await c.json()).data.map(T=>T.id);break;case"Anthropic":let p=await fetch("https://api.anthropic.com/v1/models",{headers:{"x-api-key":e,"Content-Type":"application/json"}});if(!p.ok)throw new Error(`Error fetching Anthropic models: ${p.statusText}`);t=(await p.json()).data?.map(T=>T.id)||["claude-3-sonnet-20240229","claude-3-haiku-20240307"];break;case"MistralAI":let h=await fetch("https://api.mistral.ai/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!h.ok)throw new Error(`Error fetching Mistral models: ${h.statusText}`);t=(await h.json()).data?.map(T=>T.id)||["mistral-large-latest","mistral-medium-latest"];break;case"Deepseek":t=["deepseek-chat","deepseek-coder"];break;case"Cohere":let y=await fetch("https://api.cohere.ai/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!y.ok)throw new Error(`Error fetching Cohere models: ${y.statusText}`);t=(await y.json()).models?.map(T=>T.name)||["command","command-light"];break;case"Hugging Face":t=["microsoft/DialoGPT-large","facebook/blenderbot-400M-distill","microsoft/DialoGPT-medium"];break;case"Replicate":t=["meta/llama-2-70b-chat","mistralai/mixtral-8x7b-instruct-v0.1","meta/codellama-34b-instruct"];break;case"Together AI":let w=await fetch("https://api.together.xyz/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!w.ok)throw new Error(`Error fetching Together AI models: ${w.statusText}`);t=(await w.json()).map(T=>T.id)||["meta-llama/Llama-2-70b-chat-hf","mistralai/Mixtral-8x7B-Instruct-v0.1"];break;case"Perplexity":t=["llama-3.1-sonar-small-128k-online","llama-3.1-sonar-large-128k-online","llama-3.1-sonar-huge-128k-online"];break;case"AI21 Labs":t=["j2-ultra","j2-mid","j2-light"];break;case"Aleph Alpha":t=["luminous-base","luminous-extended","luminous-supreme"];break;case"Stability AI":t=["stable-diffusion-xl-1024-v1-0","stable-diffusion-v1-6"];break;case"Fireworks AI":let M=await fetch("https://api.fireworks.ai/inference/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!M.ok)throw new Error(`Error fetching Fireworks AI models: ${M.statusText}`);t=(await M.json()).data?.map(T=>T.id)||["accounts/fireworks/models/llama-v2-70b-chat"];break;case"Anyscale":t=["meta-llama/Llama-2-70b-chat-hf","codellama/CodeLlama-34b-Instruct-hf"];break;case"Modal":t=["modal-labs/llama-2-70b","modal-labs/codellama-34b"];break;case"Runpod":t=["runpod/llama2-70b","runpod/codellama-34b"];break;case"Banana":t=["banana-dev/llama2-70b","banana-dev/codellama-34b"];break;case"Cerebras":t=["cerebras/btlm-3b-8k-base","cerebras/llama2-70b"];break;case"Lepton AI":t=["llama2-70b","mixtral-8x7b","wizardcoder-34b"];break;case"Novita AI":t=["llama-2-70b-chat","mixtral-8x7b-instruct"];break;case"DeepInfra":let R=await fetch("https://api.deepinfra.com/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!R.ok)throw new Error(`Error fetching DeepInfra models: ${R.statusText}`);t=(await R.json()).map(T=>T.model_name)||["meta-llama/Llama-2-70b-chat-hf"];break;case"Monster API":t=["llama2-70b-chat","mixtral-8x7b-instruct"];break;case"Cloudflare Workers AI":t=["@cf/meta/llama-2-7b-chat-int8","@cf/mistral/mistral-7b-instruct-v0.1"];break;case"Azure OpenAI":t=["gpt-4","gpt-35-turbo","gpt-4-32k"];break;case"AWS Bedrock":t=["anthropic.claude-v2","ai21.j2-ultra-v1","amazon.titan-text-express-v1"];break;case ft:return[];default:throw new Error(`Unsupported provider: ${n}`)}}catch(r){return console.error(r.message),[]}return t}function Zk(n){let e={python:[/^import\s+\w+/,/^from\s+\w+\s+import/,/def\s+\w+\(/,/if\s+__name__\s*==\s*['"']__main__['"']/,/print\s*\(/],javascript:[/^const\s+\w+/,/^let\s+\w+/,/^var\s+\w+/,/function\s+\w+\(/,/console\.log\(/,/=>\s*{/],bash:[/^#!\/bin\/bash/,/^#!\/bin\/sh/,/^\w+\s*=/,/if\s*\[\s*.*\s*\]/,/for\s+\w+\s+in/],php:[/<\?php/,/\$\w+\s*=/,/function\s+\w+\(/,/echo\s+/,/print\s+/],ruby:[/^require\s+/,/def\s+\w+/,/puts\s+/,/class\s+\w+/,/@\w+/],go:[/^package\s+\w+/,/^import\s+/,/func\s+\w+\(/,/fmt\.Print/],java:[/^public\s+class/,/^import\s+java\./,/public\s+static\s+void\s+main/,/System\.out\.print/],c:[/^#include\s*</,/int\s+main\s*\(/,/printf\s*\(/,/malloc\s*\(/],cpp:[/^#include\s*</,/using\s+namespace\s+std/,/cout\s*<</,/std::/],rust:[/^use\s+/,/fn\s+main\s*\(/,/println!\s*\(/,/let\s+mut/],powershell:[/^\$\w+\s*=/,/Write-Host/,/Get-\w+/,/Set-\w+/]};for(let[t,r]of Object.entries(e))if(r.some(s=>s.test(n)))return t;return"text"}function bx(n){let e=/```(\w+)?\n([\s\S]*?)```/g,t=[],r;for(;(r=e.exec(n))!==null;){let s=r[1]||Zk(r[2]);t.push({language:s,code:r[2].trim(),fullMatch:r[0]})}return t}function wx(n){return n.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim()}var Yc=class{constructor(){this.isTermuxAvailable=this.checkTermuxAvailability(),this.commandHistory=[],this.currentDirectory="/data/data/com.termux/files/home"}checkTermuxAvailability(){try{return typeof window<"u"&&window.location.protocol==="file:"&&navigator.userAgent.includes("Android")}catch{return!1}}async executeCommand(e,t="bash"){if(!this.isTermuxAvailable)throw new Error("Termux environment not available");try{let r=this.sanitizeCommand(e,t),s=await this.runInTermux(r,t);return this.commandHistory.push({command:r,language:t,result:s,timestamp:new Date().toISOString()}),s}catch(r){throw console.error("Command execution failed:",r),r}}sanitizeCommand(e,t){let r=[/rm\s+-rf\s+\//,/sudo\s+rm/,/mkfs/,/dd\s+if=.*of=\/dev/,/chmod\s+777\s+\//,/chown\s+.*:.*\s+\//];for(let s of r)if(s.test(e))throw new Error("Command contains potentially dangerous operations");return e.trim()}async runInTermux(e,t){return new Promise((r,s)=>{try{let a;switch(t.toLowerCase()){case"python":case"python3":a=`python3 -c "${e.replace(/"/g,'\\"')}"`;break;case"javascript":case"node":a=`node -e "${e.replace(/"/g,'\\"')}"`;break;case"bash":case"shell":a=e;break;case"php":a=`php -r "${e.replace(/"/g,'\\"')}"`;break;case"ruby":a=`ruby -e "${e.replace(/"/g,'\\"')}"`;break;case"perl":a=`perl -e "${e.replace(/"/g,'\\"')}"`;break;case"go":a=`echo '${e}' > /tmp/temp.go && go run /tmp/temp.go`;break;default:a=e}setTimeout(()=>{r({stdout:`Executed: ${a}
[Simulated output - integrate with actual Termux API]`,stderr:"",exitCode:0,command:a})},100)}catch(a){s(a)}})}async installSecurityTool(e){if(!dl.includes(e))throw new Error(`Unknown security tool: ${e}`);let r={nmap:"pkg install nmap",nikto:"pkg install nikto",sqlmap:"pip install sqlmap",gobuster:"pkg install gobuster",ffuf:"pkg install ffuf",nuclei:"pkg install nuclei",subfinder:"pkg install subfinder",httpx:"pkg install httpx",waybackurls:"go install github.com/tomnomnom/waybackurls@latest",gau:"go install github.com/lc/gau/v2/cmd/gau@latest",amass:"pkg install amass",masscan:"pkg install masscan",john:"pkg install john",hashcat:"pkg install hashcat",hydra:"pkg install hydra",dirb:"pkg install dirb",wpscan:"gem install wpscan","recon-ng":"pip install recon-ng",theHarvester:"pip install theHarvester",dnsrecon:"pip install dnsrecon",fierce:"pip install fierce"}[e];if(!r)throw new Error(`Installation command not found for ${e}`);return await this.executeCommand(r)}async runSecurityScan(e,t,r={}){if(!dl.includes(e))throw new Error(`Unknown security tool: ${e}`);if(!this.isValidTarget(t))throw new Error("Invalid target format");let a={nmap:`nmap ${r.flags||"-sV"} ${t}`,nikto:`nikto -h ${t}`,sqlmap:`sqlmap -u "${t}" ${r.flags||"--batch"}`,gobuster:`gobuster dir -u ${t} -w ${r.wordlist||"/usr/share/wordlists/common.txt"}`,ffuf:`ffuf -u ${t}/FUZZ -w ${r.wordlist||"/usr/share/wordlists/common.txt"}`,nuclei:`nuclei -u ${t} ${r.flags||""}`,subfinder:`subfinder -d ${t}`,httpx:`echo ${t} | httpx`,waybackurls:`echo ${t} | waybackurls`,amass:`amass enum -d ${t}`,masscan:`masscan ${t} ${r.flags||"-p1-65535 --rate=1000"}`,hydra:`hydra ${r.flags||""} ${t}`,dirb:`dirb ${t} ${r.wordlist||"/usr/share/wordlists/common.txt"}`,wpscan:`wpscan --url ${t} ${r.flags||""}`,theHarvester:`theHarvester -d ${t} -b google`,dnsrecon:`dnsrecon -d ${t}`,fierce:`fierce --domain ${t}`}[e];if(!a)throw new Error(`Scan command not found for ${e}`);return await this.executeCommand(a)}isValidTarget(e){let t=/^https?:\/\/[^\s/$.?#].[^\s]*$/i,r=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,s=/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}$/;return t.test(e)||r.test(e)||s.test(e)}getCommandHistory(){return this.commandHistory}clearHistory(){this.commandHistory=[]}async generateBugBountyReport(e){return{timestamp:new Date().toISOString(),target:e.target,tools_used:e.tools||[],findings:e.findings||[],severity:this.calculateSeverity(e.findings),recommendations:this.generateRecommendations(e.findings)}}calculateSeverity(e){if(!e||e.length===0)return"Info";let t=e.map(r=>r.severity||"Low");return t.includes("Critical")?"Critical":t.includes("High")?"High":t.includes("Medium")?"Medium":"Low"}generateRecommendations(e){let t=[];return e.forEach(r=>{switch(r.type){case"open_port":t.push("Consider closing unnecessary open ports");break;case"sql_injection":t.push("Implement proper input validation and parameterized queries");break;case"xss":t.push("Implement proper output encoding and CSP headers");break;case"directory_traversal":t.push("Implement proper path validation and access controls");break;default:t.push("Review and remediate the identified vulnerability")}}),[...new Set(t)]}};var Xc=class{constructor(e){this.apiKeyManager=e,this.activeAIs=[],this.maxActiveAIs=3,this.conversations=new Map,this.consensusMode=!1,this.votingEnabled=!1}async addAI(e,t,r){if(this.activeAIs.length>=this.maxActiveAIs)throw new Error(`Maximum ${this.maxActiveAIs} AIs can be active simultaneously`);if(this.activeAIs.some(a=>a.provider===e&&a.model===t))throw new Error("This AI model is already active");let s={id:Xs(),provider:e,model:t,apiKey:r,modelInstance:null,isActive:!0,responseTime:0,accuracy:0,specialization:this.getAISpecialization(e,t)};return s.modelInstance=await this.initializeModel(e,t,r),this.activeAIs.push(s),s}async removeAI(e){let t=this.activeAIs.findIndex(r=>r.id===e);if(t===-1)throw new Error("AI not found");this.activeAIs.splice(t,1),this.conversations.delete(e)}getAISpecialization(e,t){return{OpenAI:{"gpt-4":["general","coding","analysis"],"gpt-3.5-turbo":["general","conversation"],"code-davinci":["coding","debugging"]},Google:{"gemini-pro":["general","multimodal","analysis"],"gemini-pro-vision":["vision","image-analysis"]},Anthropic:{"claude-3":["reasoning","analysis","safety"],"claude-instant":["conversation","general"]},Groq:{mixtral:["fast-inference","general"],llama2:["open-source","general"]},Cohere:{command:["text-generation","summarization"],embed:["embeddings","search"]}}[e]?.[t]||["general"]}async initializeModel(e,t,r){return{provider:e,model:t,initialized:!0}}async queryAllAIs(e,t={}){if(this.activeAIs.length===0)throw new Error("No active AIs available");return(await Promise.allSettled(this.activeAIs.map(async s=>{let a=Date.now();try{let i=await this.queryAI(s.id,e,t),o=Date.now();return s.responseTime=o-a,{aiId:s.id,provider:s.provider,model:s.model,response:i,responseTime:s.responseTime,specialization:s.specialization,status:"fulfilled"}}catch(i){return{aiId:s.id,provider:s.provider,model:s.model,error:i.message,status:"rejected"}}}))).map((s,a)=>({...s.value||{error:s.reason},aiIndex:a}))}async queryAI(e,t,r={}){let s=this.activeAIs.find(o=>o.id===e);if(!s)throw new Error("AI not found");this.conversations.has(e)||this.conversations.set(e,[]);let a=this.conversations.get(e);a.push({role:"user",content:t,timestamp:new Date().toISOString()});let i=await this.simulateAIResponse(s,t,r);return a.push({role:"assistant",content:i,timestamp:new Date().toISOString()}),i}async simulateAIResponse(e,t,r){let s={OpenAI:`OpenAI (${e.model}) response to: ${t}`,Google:`Google Gemini response to: ${t}`,Anthropic:`Claude response with careful analysis: ${t}`,Groq:`Groq fast response: ${t}`,Ollama:`Local Ollama response: ${t}`};return await new Promise(a=>setTimeout(a,Math.random()*2e3+500)),s[e.provider]||`${e.provider} response to: ${t}`}async getConsensus(e,t={}){if(this.activeAIs.length<2)throw new Error("At least 2 AIs required for consensus");let s=(await this.queryAllAIs(e,t)).filter(i=>i.status!=="rejected");if(s.length===0)throw new Error("No valid responses received");return{prompt:e,responses:s,agreement_score:this.calculateAgreementScore(s),consensus_response:this.generateConsensusResponse(s),dissenting_opinions:this.findDissentingOpinions(s),confidence:this.calculateConfidence(s)}}calculateAgreementScore(e){if(e.length<2)return 1;let t=e.map(a=>a.response.toLowerCase()),r=0,s=0;for(let a=0;a<t.length;a++)for(let i=a+1;i<t.length;i++){s++;let o=new Set(t[a].split(" ")),l=new Set(t[i].split(" ")),u=new Set([...o].filter(p=>l.has(p))),c=new Set([...o,...l]);u.size/c.size>.3&&r++}return s>0?r/s:0}generateConsensusResponse(e){let t=e.flatMap(a=>a.response.split(" ")),r={};t.forEach(a=>{r[a]=(r[a]||0)+1});let s=Object.entries(r).filter(([a,i])=>i>1).sort((a,i)=>i[1]-a[1]).slice(0,20).map(([a])=>a);return`Consensus based on ${e.length} AI responses: ${s.join(" ")}`}findDissentingOpinions(e){return e.filter((t,r)=>{let s=e.filter((i,o)=>o!==r);return this.calculateResponseSimilarity(t.response,s)<.3})}calculateResponseSimilarity(e,t){if(t.length===0)return 1;let r=new Set(e.toLowerCase().split(" ")),s=0;return t.forEach(a=>{let i=new Set(a.response.toLowerCase().split(" ")),o=new Set([...r].filter(u=>i.has(u))),l=new Set([...r,...i]);s+=o.size/l.size}),s/t.length}calculateConfidence(e){let t=this.calculateAgreementScore(e),r=e.length,s=e.reduce((i,o)=>i+(o.responseTime||0),0)/r,a=t*.6;return a+=Math.min(r/this.maxActiveAIs,1)*.3,a+=Math.max(0,1-s/1e4)*.1,Math.min(a,1)}async voteOnResponse(e,t="accuracy"){if(!this.votingEnabled)throw new Error("Voting is not enabled");let r=e.map(s=>({...s,votes:0,score:this.scoreResponse(s,t)}));return r.sort((s,a)=>a.score-s.score),{winner:r[0],ranking:r,criteria:t}}scoreResponse(e,t){let r=0;switch(t){case"accuracy":r=Math.min(e.response.length/1e3,1)*.5,r+=e.specialization.includes("analysis")?.3:0,r+=e.responseTime<5e3?.2:0;break;case"speed":r=Math.max(0,1-e.responseTime/1e4);break;case"creativity":let s=e.response.split(" ");r=new Set(s).size/s.length;break;default:r=.5}return Math.min(r,1)}getActiveAIs(){return this.activeAIs.map(e=>({id:e.id,provider:e.provider,model:e.model,specialization:e.specialization,responseTime:e.responseTime,isActive:e.isActive}))}async enableConsensusMode(){this.consensusMode=!0}async disableConsensusMode(){this.consensusMode=!1}async enableVoting(){this.votingEnabled=!0}async disableVoting(){this.votingEnabled=!1}getConversationHistory(e){return this.conversations.get(e)||[]}clearConversationHistory(e){e?this.conversations.delete(e):this.conversations.clear()}async generateCodeWithMultipleAIs(e,t="python"){let r=`Generate ${t} code for: ${e}. Provide clean, well-commented code that follows best practices.`,a=(await this.queryAllAIs(r,{context:"code_generation",language:t})).filter(o=>o.status!=="rejected");if(a.length===0)throw new Error("No code responses received");return{best_code:(await this.voteOnResponse(a,"accuracy")).winner,all_responses:a,consensus:await this.getConsensus(r),language:t}}};var Vi={ollama:{name:"Ollama (Local)",type:"local",cost:"free",priority:1,models:["llama3.2:latest","llama3.1:latest","codellama:latest","deepseek-coder:latest","qwen2.5-coder:latest","starcoder2:latest","phi3:latest","gemma2:latest","mistral:latest","neural-chat:latest","wizardcoder:latest","magicoder:latest"],specialties:{"codellama:latest":"Code generation and debugging","deepseek-coder:latest":"Advanced coding and security analysis","qwen2.5-coder:latest":"Multi-language programming","starcoder2:latest":"Code completion and refactoring","wizardcoder:latest":"Complex algorithm development","magicoder:latest":"Code optimization and best practices"}},huggingface:{name:"Hugging Face (Free)",type:"api",cost:"free",priority:2,models:["microsoft/DialoGPT-large","microsoft/CodeBERT-base","Salesforce/codet5-large","bigcode/starcoder","WizardLM/WizardCoder-15B-V1.0","deepseek-ai/deepseek-coder-6.7b-base"]},colab:{name:"Google Colab (Free)",type:"colab",cost:"free",priority:3,models:["flan-t5-xxl","flan-ul2","alpaca-7b","vicuna-7b"]},security:{name:"Security-Focused Models",type:"local",cost:"free",priority:4,models:["securityllama:latest","pentestgpt:latest","vulnhunter:latest"]}},_x={network:{name:"Network Security",tools:[{name:"nmap",description:"Network discovery and security auditing",install:"apt-get install -y nmap",usage:"nmap -sV -sC target_ip"},{name:"masscan",description:"Fast port scanner",install:"apt-get install -y masscan",usage:"masscan -p1-65535 target_ip --rate=1000"},{name:"zmap",description:"Internet-wide network scanner",install:"apt-get install -y zmap",usage:"zmap -p 80 -o results.txt"}]},web:{name:"Web Application Security",tools:[{name:"gobuster",description:"Directory/file & DNS busting tool",install:"apt-get install -y gobuster",usage:"gobuster dir -u http://target -w /usr/share/wordlists/dirb/common.txt"},{name:"dirb",description:"Web content scanner",install:"apt-get install -y dirb",usage:"dirb http://target"},{name:"nikto",description:"Web server scanner",install:"apt-get install -y nikto",usage:"nikto -h http://target"},{name:"wpscan",description:"WordPress security scanner",install:"gem install wpscan",usage:"wpscan --url http://target"}]},exploitation:{name:"Exploitation Tools",tools:[{name:"metasploit-framework",description:"Penetration testing framework",install:"curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && chmod 755 msfinstall && ./msfinstall",usage:"msfconsole"},{name:"sqlmap",description:"SQL injection testing tool",install:"apt-get install -y sqlmap",usage:'sqlmap -u "http://target/page?id=1" --dbs'},{name:"hydra",description:"Password cracking tool",install:"apt-get install -y hydra",usage:"hydra -l admin -P passwords.txt target ssh"}]},forensics:{name:"Digital Forensics",tools:[{name:"volatility3",description:"Memory forensics framework",install:"pip3 install volatility3",usage:"vol -f memory.dump windows.info"},{name:"autopsy",description:"Digital forensics platform",install:"apt-get install -y autopsy",usage:"autopsy"},{name:"binwalk",description:"Firmware analysis tool",install:"apt-get install -y binwalk",usage:"binwalk -e firmware.bin"}]}},Qc={security_expert:{name:"Security Expert",prompt:`You are an elite cybersecurity expert with 15+ years of experience in penetration testing, vulnerability assessment, and ethical hacking. You have extensive knowledge of:

- Advanced penetration testing methodologies
- Bug bounty hunting techniques
- Security tool usage and optimization
- Vulnerability research and exploitation
- Secure coding practices
- Compliance frameworks (OWASP, NIST, ISO 27001)

You provide detailed, actionable security advice and can generate secure code. You understand the ethical implications of security testing and always emphasize responsible disclosure.

IMPORTANT: All security testing should only be performed on systems you own or have explicit written permission to test. Unauthorized testing is illegal and unethical.`},code_architect:{name:"Code Architect",prompt:`You are a senior software architect and full-stack developer with expertise in:

- Modern programming languages and frameworks
- Clean code principles and design patterns
- Scalable system architecture
- DevOps and CI/CD practices
- Database design and optimization
- API development and integration
- Mobile and web application development

You write production-ready code with proper error handling, documentation, and testing. You prioritize security, performance, and maintainability in all solutions.`},bug_bounty_hunter:{name:"Bug Bounty Hunter",prompt:`You are a professional bug bounty hunter with a track record of finding critical vulnerabilities. You specialize in:

- Web application security testing
- Mobile application security
- API security assessment
- Network penetration testing
- Social engineering awareness
- Report writing and vulnerability documentation

You approach security testing systematically and provide detailed reproduction steps for any vulnerabilities found. You understand the importance of responsible disclosure and working within program scope.

DISCLAIMER: Only test applications and systems where you have explicit permission. Unauthorized testing violates terms of service and may be illegal.`},ai_ethics_specialist:{name:"AI Ethics Specialist",prompt:`You are an AI ethics specialist responsible for ensuring responsible AI usage. You evaluate:

- User intent and ethical implications
- Potential misuse of AI-generated content
- Compliance with AI safety guidelines
- Responsible disclosure practices
- Educational vs. malicious intent

You provide guidance on ethical AI usage while supporting legitimate security research and education.`}};var ed=class{constructor(){this.baseUrl="http://localhost:11434",this.availableModels=[],this.installedModels=[],this.currentModel=null,this.isConnected=!1}async initialize(){try{return await this.checkConnection(),await this.loadAvailableModels(),await this.loadInstalledModels(),!0}catch(e){return console.error("Ollama initialization failed:",e),!1}}async checkConnection(){try{if((await fetch(`${this.baseUrl}/api/version`)).ok)return this.isConnected=!0,!0}catch{throw this.isConnected=!1,new Error("Ollama not running. Please start Ollama service.")}}async installOllama(){return{script:`
#!/bin/bash
echo "Installing Ollama..."

# Download and install Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# Start Ollama service
ollama serve &

# Wait for service to start
sleep 5

# Install recommended models for coding and security
echo "Installing recommended models..."
ollama pull llama3.2:latest
ollama pull codellama:latest
ollama pull deepseek-coder:latest
ollama pull qwen2.5-coder:latest
ollama pull starcoder2:latest

echo "Ollama installation complete!"
echo "Available models:"
ollama list
`,description:"Install Ollama and recommended coding models",estimatedTime:"10-15 minutes"}}async loadAvailableModels(){this.availableModels=Vi.ollama.models.map(e=>({name:e,specialty:Vi.ollama.specialties[e]||"General purpose",size:this.getModelSize(e),recommended:this.isRecommendedModel(e)}))}async loadInstalledModels(){if(!this.isConnected)return[];try{let t=await(await fetch(`${this.baseUrl}/api/tags`)).json();return this.installedModels=t.models||[],this.installedModels}catch(e){return console.error("Failed to load installed models:",e),[]}}async pullModel(e,t=null){if(!this.isConnected)throw new Error("Ollama not connected");try{let r=await fetch(`${this.baseUrl}/api/pull`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!r.ok)throw new Error(`Failed to pull model: ${r.statusText}`);let s=r.body.getReader(),a=new TextDecoder;for(;;){let{done:i,value:o}=await s.read();if(i)break;let u=a.decode(o).split(`
`).filter(c=>c.trim());for(let c of u)try{let d=JSON.parse(c);t&&d.status&&t({status:d.status,completed:d.completed||0,total:d.total||0,percent:d.total?Math.round(d.completed/d.total*100):0})}catch{}}return await this.loadInstalledModels(),!0}catch(r){throw console.error("Model pull failed:",r),r}}async generateResponse(e,t=null,r={}){if(!this.isConnected)throw new Error("Ollama not connected");let s=t||this.currentModel||"llama3.2:latest";try{let a=await fetch(`${this.baseUrl}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:s,prompt:e,stream:!1,options:{temperature:r.temperature||.7,top_p:r.top_p||.9,top_k:r.top_k||40,...r}})});if(!a.ok)throw new Error(`Generation failed: ${a.statusText}`);return(await a.json()).response}catch(a){throw console.error("Generation failed:",a),a}}async generateCode(e,t="auto",r=null){let s=r||this.getBestCodeModel(),a=`You are an expert programmer. Generate clean, efficient, and well-documented ${t} code for the following requirement:

${e}

Requirements:
- Write production-ready code
- Include proper error handling
- Add clear comments
- Follow best practices
- Ensure security considerations

Code:`;return await this.generateResponse(a,s,{temperature:.3,top_p:.8})}async analyzeSecurityCode(e,t="auto"){let r=this.getBestSecurityModel(),s=`You are a cybersecurity expert. Analyze the following ${t} code for security vulnerabilities:

${e}

Please provide:
1. Security vulnerabilities found (if any)
2. Risk level (Low/Medium/High/Critical)
3. Recommended fixes
4. Best practices to prevent similar issues

Analysis:`;return await this.generateResponse(s,r,{temperature:.2})}getBestCodeModel(){let e=["deepseek-coder:latest","codellama:latest","qwen2.5-coder:latest","starcoder2:latest"];for(let t of e)if(this.isModelInstalled(t))return t;return"llama3.2:latest"}getBestSecurityModel(){let e=["deepseek-coder:latest","llama3.2:latest","codellama:latest"];for(let t of e)if(this.isModelInstalled(t))return t;return"llama3.2:latest"}isModelInstalled(e){return this.installedModels.some(t=>t.name===e)}getModelSize(e){return{"llama3.2:latest":"2.0GB","llama3.1:latest":"4.7GB","codellama:latest":"3.8GB","deepseek-coder:latest":"3.4GB","qwen2.5-coder:latest":"3.1GB","starcoder2:latest":"3.3GB","phi3:latest":"2.3GB","gemma2:latest":"5.4GB","mistral:latest":"4.1GB"}[e]||"Unknown"}isRecommendedModel(e){return["llama3.2:latest","codellama:latest","deepseek-coder:latest","qwen2.5-coder:latest"].includes(e)}async getModelInfo(e){if(!this.isConnected)return null;try{let t=await fetch(`${this.baseUrl}/api/show`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(t.ok)return await t.json()}catch(t){console.error("Failed to get model info:",t)}return null}async deleteModel(e){if(!this.isConnected)throw new Error("Ollama not connected");try{let t=await fetch(`${this.baseUrl}/api/delete`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(t.ok)return await this.loadInstalledModels(),!0;throw new Error(`Failed to delete model: ${t.statusText}`)}catch(t){throw console.error("Model deletion failed:",t),t}}setCurrentModel(e){return this.isModelInstalled(e)?(this.currentModel=e,!0):!1}getCurrentModel(){return this.currentModel||"llama3.2:latest"}getConnectionStatus(){return{connected:this.isConnected,baseUrl:this.baseUrl,installedModels:this.installedModels.length,currentModel:this.currentModel}}};var td=class{constructor(){this.customPrompts=new Map,this.activePrompt=null,this.promptHistory=[],this.loadSavedPrompts()}loadSavedPrompts(){try{let e=localStorage.getItem("acode-ai-custom-prompts");if(e){let t=JSON.parse(e);Object.entries(t).forEach(([r,s])=>{this.customPrompts.set(r,s)})}Object.entries(Qc).forEach(([t,r])=>{this.customPrompts.has(t)||this.customPrompts.set(t,r)})}catch(e){console.error("Failed to load saved prompts:",e)}}savePrompts(){try{let e=Object.fromEntries(this.customPrompts);localStorage.setItem("acode-ai-custom-prompts",JSON.stringify(e))}catch(e){console.error("Failed to save prompts:",e)}}addPrompt(e,t,r,s="custom",a=!0){let i={id:e,name:t,prompt:r,category:s,isSystem:a,created:new Date().toISOString(),lastUsed:null,useCount:0};return this.customPrompts.set(e,i),this.savePrompts(),i}getPrompt(e){return this.customPrompts.get(e)}getAllPrompts(e=null){let t=Array.from(this.customPrompts.values());return e?t.filter(r=>r.category===e):t}deletePrompt(e){let t=this.customPrompts.delete(e);return t&&this.savePrompts(),t}setActivePrompt(e){let t=this.customPrompts.get(e);return t?(this.activePrompt=t,t.lastUsed=new Date().toISOString(),t.useCount++,this.savePrompts(),!0):!1}getActivePrompt(){return this.activePrompt}clearActivePrompt(){this.activePrompt=null}buildCompletePrompt(e,t=!1){let r="";return this.activePrompt&&this.activePrompt.isSystem&&(r+=this.activePrompt.prompt+`

`),t&&(r+=this.getLegalDisclaimer()+`

`),r+=`User: ${e}

Assistant: `,r}getLegalDisclaimer(){return`LEGAL DISCLAIMER: This AI assistant is provided for educational and authorized security testing purposes only. Users must:

1. Only test systems they own or have explicit written permission to test
2. Comply with all applicable laws and regulations
3. Follow responsible disclosure practices
4. Not use this tool for malicious purposes
5. Understand that unauthorized access to computer systems is illegal

By using this tool, you acknowledge that you have read, understood, and agree to comply with these terms and all applicable laws. The developers and providers of this tool are not responsible for any misuse or illegal activities conducted by users.

[Attorney-drafted legal language would be inserted here]`}createSecurityPrompt(e="basic"){let t=Qc.security_expert.prompt,r={basic:`

IMPORTANT: Provide educational content only. Always emphasize legal and ethical considerations.`,professional:`

You may provide advanced techniques but always within legal and ethical boundaries.`,expert:`

You have access to advanced security techniques. Ensure all activities are authorized and legal.`};return t+(r[e]||r.basic)}createCodePrompt(e="auto",t="intermediate"){let r=Qc.code_architect.prompt,s={beginner:`

Focus on simple, well-commented code with detailed explanations.`,intermediate:`

Provide efficient code with good practices and moderate complexity.`,advanced:`

Create sophisticated solutions with advanced patterns and optimizations.`,expert:`

Develop enterprise-grade code with comprehensive error handling and scalability.`};return e!=="auto"&&(r+=`

Specialize in ${e} development and follow ${e}-specific best practices.`),r+=s[t]||s.intermediate,r}importPrompts(e){try{let t=typeof e=="string"?JSON.parse(e):e,r=0;return Object.entries(t).forEach(([s,a])=>{a.name&&a.prompt&&(this.addPrompt(s,a.name,a.prompt,a.category||"imported"),r++)}),{success:!0,imported:r}}catch(t){return{success:!1,error:t.message}}}exportPrompts(){let e=Object.fromEntries(this.customPrompts);return JSON.stringify(e,null,2)}getPromptStats(){let e=Array.from(this.customPrompts.values());return{total:e.length,categories:[...new Set(e.map(t=>t.category))],mostUsed:e.sort((t,r)=>r.useCount-t.useCount).slice(0,5),recentlyUsed:e.filter(t=>t.lastUsed).sort((t,r)=>new Date(r.lastUsed)-new Date(t.lastUsed)).slice(0,5)}}searchPrompts(e){let t=e.toLowerCase();return Array.from(this.customPrompts.values()).filter(r=>r.name.toLowerCase().includes(t)||r.prompt.toLowerCase().includes(t))}getPromptTemplates(){return{bug_bounty:{name:"Bug Bounty Hunter",template:`You are a professional bug bounty hunter analyzing {target_type} for security vulnerabilities.

Focus Areas:
- {focus_areas}

Scope: {scope}
Out of Scope: {out_of_scope}

Methodology:
1. Reconnaissance and information gathering
2. Vulnerability identification
3. Exploitation (proof of concept only)
4. Documentation and reporting

Remember: Only test authorized targets with proper scope definition.`,variables:["target_type","focus_areas","scope","out_of_scope"]},code_review:{name:"Code Security Review",template:`You are conducting a security code review for {language} code.

Review Focus:
- {security_focus}

Code Quality Standards:
- {quality_standards}

Please analyze the code for:
1. Security vulnerabilities
2. Code quality issues
3. Performance concerns
4. Best practice violations

Provide specific recommendations for improvement.`,variables:["language","security_focus","quality_standards"]},app_builder:{name:"AI App Builder",template:`You are an expert app developer creating a {app_type} application.

Requirements:
{requirements}

Technical Stack:
- Frontend: {frontend}
- Backend: {backend}
- Database: {database}

Features to implement:
{features}

Create production-ready code with proper architecture, error handling, and security considerations.`,variables:["app_type","requirements","frontend","backend","database","features"]}}}fillTemplate(e,t){let s=this.getPromptTemplates()[e];if(!s)throw new Error(`Template ${e} not found`);let a=s.template;return Object.entries(t).forEach(([i,o])=>{let l=`{${i}}`;a=a.replace(new RegExp(l,"g"),o)}),{name:s.name,prompt:a,category:"generated"}}};var rd=class{constructor(e){this.terminal=e,this.installedTools=new Set,this.toolCategories=_x,this.loadInstalledTools()}loadInstalledTools(){try{let e=localStorage.getItem("acode-ai-installed-tools");e&&(this.installedTools=new Set(JSON.parse(e)))}catch(e){console.error("Failed to load installed tools:",e)}}saveInstalledTools(){try{localStorage.setItem("acode-ai-installed-tools",JSON.stringify([...this.installedTools]))}catch(e){console.error("Failed to save installed tools:",e)}}isToolInstalled(e){return this.installedTools.has(e)}markToolInstalled(e){this.installedTools.add(e),this.saveInstalledTools()}getToolsByCategory(e){return this.toolCategories[e]?.tools||[]}getCategories(){return Object.keys(this.toolCategories)}async installTool(e,t){let s=this.getToolsByCategory(t).find(a=>a.name===e);if(!s)throw new Error(`Tool ${e} not found in category ${t}`);try{await this.terminal.executeCommand(`echo "Installing ${e}..."`);let a=await this.terminal.executeCommand(s.install);if(a.success)return this.markToolInstalled(e),await this.terminal.executeCommand(`echo "${e} installed successfully!"`),{success:!0,message:`${e} installed successfully`};throw new Error(a.error||"Installation failed")}catch(a){return await this.terminal.executeCommand(`echo "Failed to install ${e}: ${a.message}"`),{success:!1,error:a.message}}}async installCategory(e){let t=this.getToolsByCategory(e),r=[];for(let s of t)if(this.isToolInstalled(s.name))r.push({tool:s.name,success:!0,message:"Already installed"});else{let a=await this.installTool(s.name,e);r.push({tool:s.name,...a})}return r}async runTool(e,t="",r=null){let s=null,a=r;if(r)s=this.getToolsByCategory(r).find(l=>l.name===e);else for(let[o,l]of Object.entries(this.toolCategories)){let u=l.tools.find(c=>c.name===e);if(u){s=u,a=o;break}}if(!s)throw new Error(`Tool ${e} not found`);if(!this.isToolInstalled(e))throw new Error(`Tool ${e} is not installed. Install it first.`);let i=t?`${e} ${t}`:s.usage;this.isDangerousTool(e)&&(await this.terminal.executeCommand(`echo "\u26A0\uFE0F  WARNING: ${e} is a powerful tool. Use responsibly and only on authorized targets."`),await this.terminal.executeCommand('echo "Press Ctrl+C to cancel, or any key to continue..."'));try{return await this.terminal.executeCommand(`echo "Running: ${i}"`),await this.terminal.executeCommand(i)}catch(o){throw await this.terminal.executeCommand(`echo "Error running ${e}: ${o.message}"`),o}}isDangerousTool(e){return["metasploit-framework","sqlmap","hydra","masscan","zmap"].includes(e)}getToolInfo(e,t=null){if(t)return this.getToolsByCategory(t).find(s=>s.name===e);for(let[r,s]of Object.entries(this.toolCategories)){let a=s.tools.find(i=>i.name===e);if(a)return{...a,category:r}}return null}generateInstallScript(){let e=`#!/bin/bash
# Automated Security Tools Installation Script
# Generated by Acode AI Assistant

echo "Starting security tools installation..."
echo "This may take 15-30 minutes depending on your internet connection."

# Update system
apt-get update

# Install basic dependencies
apt-get install -y curl wget git python3 python3-pip ruby gem

`;return Object.entries(this.toolCategories).forEach(([t,r])=>{e+=`
# ${r.name} Tools
`,r.tools.forEach(s=>{e+=`echo "Installing ${s.name}..."
`,e+=`${s.install}
`,e+=`echo "${s.name} installation complete"

`})}),e+=`
echo "All security tools installation complete!"
echo "Available tools:"
`,Object.entries(this.toolCategories).forEach(([t,r])=>{r.tools.forEach(s=>{e+=`which ${s.name} && echo "\u2713 ${s.name}" || echo "\u2717 ${s.name}"
`})}),e}getToolExamples(e){return{nmap:["nmap -sV -sC target.com  # Version and script scan","nmap -p- target.com      # Scan all ports","nmap -sU target.com      # UDP scan","nmap --script vuln target.com  # Vulnerability scan"],gobuster:["gobuster dir -u http://target.com -w /usr/share/wordlists/dirb/common.txt","gobuster dns -d target.com -w /usr/share/wordlists/subdomains.txt","gobuster vhost -u http://target.com -w /usr/share/wordlists/subdomains.txt"],sqlmap:['sqlmap -u "http://target.com/page?id=1" --dbs','sqlmap -u "http://target.com/page?id=1" -D database --tables','sqlmap -u "http://target.com/page?id=1" -D database -T table --dump'],nikto:["nikto -h http://target.com","nikto -h http://target.com -p 80,443","nikto -h http://target.com -o report.html -Format htm"],hydra:["hydra -l admin -P passwords.txt target.com ssh","hydra -L users.txt -P passwords.txt target.com ftp",'hydra -l admin -P passwords.txt target.com http-post-form "/login:user=^USER^&pass=^PASS^:Invalid"']}[e]||[`${e} --help  # Show help information`]}getToolCombinations(){return{web_app_testing:{name:"Web Application Testing",tools:["nmap","gobuster","nikto","sqlmap"],workflow:["1. Port scan with nmap","2. Directory enumeration with gobuster","3. Web vulnerability scan with nikto","4. SQL injection testing with sqlmap"]},network_assessment:{name:"Network Security Assessment",tools:["nmap","masscan","hydra"],workflow:["1. Fast port discovery with masscan","2. Detailed service enumeration with nmap","3. Brute force testing with hydra"]},wordpress_testing:{name:"WordPress Security Testing",tools:["nmap","wpscan","gobuster"],workflow:["1. Port scan with nmap","2. WordPress-specific scan with wpscan","3. Directory enumeration with gobuster"]},forensics_analysis:{name:"Digital Forensics Analysis",tools:["volatility3","autopsy","binwalk"],workflow:["1. Memory analysis with volatility3","2. Disk analysis with autopsy","3. Firmware analysis with binwalk"]}}}generateBugBountyWorkflow(e,t){return`# Bug Bounty Testing Workflow for ${e}

## Scope
${t}

## Phase 1: Reconnaissance
1. Subdomain enumeration:
   gobuster dns -d ${e} -w /usr/share/wordlists/subdomains.txt

2. Port scanning:
   nmap -sV -sC ${e}

## Phase 2: Web Application Testing
1. Directory enumeration:
   gobuster dir -u http://${e} -w /usr/share/wordlists/dirb/common.txt

2. Vulnerability scanning:
   nikto -h http://${e}

## Phase 3: Specific Testing
1. SQL injection testing:
   sqlmap -u "http://${e}/page?param=value" --dbs

2. WordPress testing (if applicable):
   wpscan --url http://${e}

## Phase 4: Documentation
- Document all findings
- Create proof of concept
- Follow responsible disclosure

\u26A0\uFE0F IMPORTANT: Only test targets within the defined scope and with proper authorization.
`}getInstallationStatus(){let e={};return Object.entries(this.toolCategories).forEach(([t,r])=>{e[t]={name:r.name,total:r.tools.length,installed:r.tools.filter(s=>this.isToolInstalled(s.name)).length,tools:r.tools.map(s=>({name:s.name,installed:this.isToolInstalled(s.name),description:s.description}))}}),e}};var PK=acode.require("multiPrompt"),Ve=acode.require("fs"),ta=acode.require("select"),ht=acode.require("prompt"),Ln=acode.require("dialogBox"),Yk=acode.require("helpers"),Yr=acode.require("loader"),TK=acode.require("sidebarApps"),SK=acode.require("toInternalUrl"),Xk=acode.require("contextMenu"),Qk=acode.require("selectionMenu"),{editor:eR}=editorManager,nd=window.DATA_STORAGE+"chatgpt",Xr=null,um=class{async init(e){this.$githubDarkFile=tag("link",{rel:"stylesheet",href:this.baseUrl+"assets/github-dark.css"}),this.$higlightJsFile=tag("script",{src:this.baseUrl+"assets/highlight.min.js"}),this.$markdownItFile=tag("script",{src:this.baseUrl+"assets/markdown-it.min.js"}),this.$style=tag("style",{textContent:pm}),document.head.append(this.$githubDarkFile,this.$higlightJsFile,this.$markdownItFile,this.$style),eR.commands.addCommand({name:"ai_assistant",description:"AI Assistant",exec:this.run.bind(this)}),Qk.add(async()=>{let m=await ta("AI Actions",["Explain Code","Rewrite","Generate Code"],{onHide:()=>{window.toast("Work is in progress...",3e3)}})},"\u2728","all"),e.id="acode-ai-assistant",e.settitle("AI Assistant"),this.$page=e;let t=tag("span",{className:"icon more_vert",dataset:{action:"toggle-menu"}}),r=tag("span",{className:"icon historyrestore",dataset:{action:"history"}}),s=tag("span",{className:"icon add",dataset:{action:"new-chat"}}),a=tag("span",{className:"icon insert_invitationevent",dataset:{action:"insert-context"}}),i=tag("span",{className:"icon terminal",dataset:{action:"terminal"},innerHTML:rx,title:"Terminal & Code Execution"}),o=tag("span",{className:"icon multi-ai",dataset:{action:"multi-ai"},innerHTML:nx,title:"Multi-AI Chat"}),l=tag("span",{className:"icon security",dataset:{action:"security"},innerHTML:sx,title:"Security & Bug Bounty Tools"}),u=tag("span",{className:"icon ollama",dataset:{action:"ollama"},innerHTML:ax,title:"Ollama Local Models"}),c=tag("span",{className:"icon prompt",dataset:{action:"prompt"},innerHTML:ix,title:"Custom Prompts & Fine-tuning"}),d=tag("span",{className:"icon free-models",dataset:{action:"free-models"},innerHTML:ox,title:"Free & Open-Source Models"});this.$page.header.append(s,a,i,o,l,u,c,d,r,t),r.onclick=this.myHistory.bind(this),s.onclick=this.newChat.bind(this),i.onclick=this.showTerminal.bind(this),o.onclick=this.showMultiAI.bind(this),l.onclick=this.showSecurityTools.bind(this),u.onclick=this.showOllamaManager.bind(this),c.onclick=this.showPromptManager.bind(this),d.onclick=this.showFreeModels.bind(this);let f=Xk({innerHTML:()=>`
        <li action="model-provider" provider="">Provider: ${window.localStorage.getItem("ai-assistant-provider")}</li>
        <li action="model" modelNme="">Model: ${window.localStorage.getItem("ai-assistant-model-name")}</li>
        `,...{top:"35px",right:"10px",toggler:t,transformOrigin:"top right"}});f.onclick=async m=>{switch(f.hide(),m.target.getAttribute("action")){case"model-provider":let x=window.localStorage.getItem("ai-assistant-provider"),w=xt.map(R=>{let T=["Ollama","Hugging Face","OpenAI-Like"].includes(R);return`${R}${T?" (FREE)":" (Paid)"}`}),A=await ta("Select AI Provider - Free options available!",w,{default:x?`${x}${["Ollama","Hugging Face","OpenAI-Like"].includes(x)?" (FREE)":" (Paid)"}`:""});if(A=A.replace(/ \((FREE|Paid)\)$/,""),x!=A)if(A===ft){let R=await ht("API Key","","text",{required:!0});if(!R)return;let U=await ht("API Base URL","https://api.openai.com/v1","text",{required:!0}),T=await ht("Model","","text",{required:!0});if(!T)return;window.localStorage.setItem("ai-assistant-provider",ft),window.localStorage.setItem("ai-assistant-model-name",T),window.localStorage.setItem("openai-like-baseurl",U),await this.apiKeyManager.saveAPIKey(ft,R),this.initiateModel(ft,R,T),this.newChat()}else if(window.localStorage.getItem(A)===null){let R;if(A==="Ollama")R="No Need Of API Key",window.toast("Ollama is FREE! No API key needed. Install locally for best performance.",4e3);else if(A==="Hugging Face"){let re=await ht("Hugging Face API Key (Optional - many models are free)","","text",{required:!1});R=re||"No Need Of API Key",re||window.toast("Using Hugging Face without API key - some models may be limited",3e3)}else R=await ht(`API key for ${A}

\u{1F4A1} TIP: Use Ollama (FREE) or Hugging Face (FREE) for the same functionality without costs!`,"","text",{required:!0});if(!R)return;Yr.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let U=await Zc(A,R);Yr.removeTitleLoader();let T=await ta("Select AI Model",U);window.localStorage.setItem("ai-assistant-provider",A),window.localStorage.setItem("ai-assistant-model-name",T),await this.apiKeyManager.saveAPIKey(A,R),this.initiateModel(A,R,T),this.newChat()}else{let R=await this.apiKeyManager.getAPIKey(A);this.initiateModel(A,R,window.localStorage.getItem("ai-assistant-model-name")),this.newChat()}break;case"model":let M=window.localStorage.getItem("ai-assistant-provider"),N=await this.apiKeyManager.getAPIKey(M);if(M===ft){let R=window.localStorage.getItem("ai-assistant-model-name")||"",U=await ht("Enter Model",R,"text",{required:!0});U&&(window.localStorage.setItem("ai-assistant-model-name",U),this.initiateModel(ft,N,U))}else{Yr.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let R=await Zc(M,N);Yr.removeTitleLoader();let U=await ta("Select AI Model",R,{default:window.localStorage.getItem("ai-assistant-model-name")||""});window.localStorage.getItem("ai-assistant-model-name")!=U&&(window.localStorage.setItem("ai-assistant-model-name",U),this.initiateModel(M,N,U))}break}};let h=tag("div",{className:"mainApp"});this.$chatBox=tag("div",{className:"chatBox"}),this.$inputBox=tag("div",{className:"inputBox"}),this.$chatTextarea=tag("textarea",{className:"chatTextarea",placeholder:"Type your query..."}),this.$sendBtn=tag("button",{className:"sendBtn"}),this.$sendBtn.innerHTML=Qv,this.$stopGenerationBtn=tag("button",{className:"stopGenerationBtn hide"}),this.$stopGenerationBtn.innerHTML=tx,this.$stopGenerationBtn.onclick=this.stopGenerating.bind(this),this.$inputBox.append(this.$chatTextarea,this.$sendBtn,this.$stopGenerationBtn),h.append(this.$inputBox,this.$chatBox),this.$page.append(h),this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:Xs()}},this.terminalManager=new Yc,this.multiAIManager=null,this.ollamaManager=new ed,this.promptManager=new td,this.freeSecurityTools=new rd(this.terminalManager),this.isMultiAIMode=!1,this.isTerminalMode=!1,this.codeExecutionEnabled=!0,this.preferFreeModels=!0}async run(){try{let e;if(await Ve(window.DATA_STORAGE+"secret.key").exists())e=await Ve(window.DATA_STORAGE+"secret.key").readFile("utf-8");else{let a=await ht("Enter a secret pass pharse to save the api key","","text",{required:!0});if(!a)return;e=a}this.apiKeyManager=new Jc(e),this.multiAIManager=new Xc(this.apiKeyManager);let t,r=window.localStorage.getItem("ai-assistant-provider");if(r)t=await this.apiKeyManager.getAPIKey(r);else{window.toast("\u{1F389} Welcome! This app supports 28+ AI providers including FREE options like Ollama and Hugging Face!",5e3);let a=["Ollama","Hugging Face","OpenAI-Like"],i=xt.filter(u=>!a.includes(u)),o=[...a.map(u=>`\u{1F193} ${u} (FREE)`),"--- Paid Options ---",...i.map(u=>`\u{1F4B0} ${u} (Paid)`)],l=await ta("\u{1F680} Choose Your AI Provider - Free Options Available!",o);if(l==="--- Paid Options ---"){window.toast("Please select an actual provider",2e3);return}if(l=l.replace(/^(|) /,"").replace(/ \((FREE|Paid)\)$/,""),l===ft){let u=await ht("API Key","","text",{required:!0});if(!u)return;let c=await ht("API Base URL","https://api.openai.com/v1","text",{required:!0}),d=await ht("Model","","text",{required:!0});if(!d)return;window.localStorage.setItem("ai-assistant-provider",ft),window.localStorage.setItem("ai-assistant-model-name",d),window.localStorage.setItem("openai-like-baseurl",c),t=u,r=ft,await Ve(window.DATA_STORAGE).createFile("secret.key",e),await this.apiKeyManager.saveAPIKey(ft,t),window.toast("Configuration saved \u{1F389}",3e3)}else{let u;if(l==="Ollama")u="No Need Of API Key",window.toast("\u{1F389} Great choice! Ollama is completely FREE and runs locally!",4e3);else if(l==="Hugging Face"){let p=await ht("Hugging Face API Key (Optional - many models work without it)","","text",{required:!1});u=p||"No Need Of API Key",p||window.toast("Using Hugging Face without API key - you can still access many free models!",4e3)}else u=await ht(`API key for ${l}

\u{1F4A1} Remember: Ollama and Hugging Face offer similar capabilities for FREE!`,"","text",{required:!0});if(!u)return;Yr.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let c=await Zc(l,u);Yr.removeTitleLoader();let d=await ta("Select AI Model",c);window.localStorage.setItem("ai-assistant-provider",l),window.localStorage.setItem("ai-assistant-model-name",d),r=l,t=u,await Ve(window.DATA_STORAGE).createFile("secret.key",e),await this.apiKeyManager.saveAPIKey(r,t),window.toast("Configuration saved \u{1F389}",3e3)}}let s=window.localStorage.getItem("ai-assistant-model-name");this.initiateModel(r,t,s),this.$mdIt=window.markdownit({html:!1,xhtmlOut:!1,breaks:!1,linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:function(a,i){let o=document.createElement("button");o.classList.add("copy-button"),o.innerHTML=ex,o.setAttribute("data-str",a);let l=`<pre class="hljs codesArea"><code>${hljs.highlightAuto(a).value}</code></pre>`;return`<div class="codeBlock">${o.outerHTML}${l}</div>`}}),this.$sendBtn.addEventListener("click",this.sendQuery.bind(this)),this.$page.show()}catch(e){console.log(e)}}initiateModel(e,t,r){switch(e){case xt[0]:this.modelInstance=new zi({apiKey:t,model:r});break;case xt[1]:this.modelInstance=new ac({model:r,apiKey:t,safetySettings:[{category:pl.HARM_CATEGORY_HARASSMENT,threshold:fl.BLOCK_LOW_AND_ABOVE}]});break;case xt[2]:let s=window.localStorage.getItem("Ollama-Host")?window.localStorage.getItem("Ollama-Host"):"http://localhost:11434";this.modelInstance=new Ju({baseUrl:s,model:r});break;case xt[3]:this.modelInstance=new gc({apiKey:t,model:r});break;case ft:let a=window.localStorage.getItem("openai-like-baseurl")||"https://api.openai.com/v1";this.modelInstance=new zi({apiKey:t,model:r,configuration:{baseURL:a}});break;default:throw new Error("Unknown provider")}}_sanitizeFileName(e){return e.replace(/[^\w\s.-]/gi,"").trim().replace(/\s+/g,"_")}transformMessages(e){return e.map((r,s)=>s%2===0&&s+1<e.length?{prompt:e[s].content,result:e[s+1].content}:null).filter(r=>r!==null)}async saveHistory(){try{let e=this.messageSessionConfig.configurable.sessionId;if(!this.messageHistories[e].messages.length)return;if(Xr==null)try{let r=`${this._sanitizeFileName(this.messageHistories[e].messages[0].content.substring(0,30))}__${e}.json`;await Ve(nd).exists()||await Ve(window.DATA_STORAGE).createDirectory("chatgpt");let s=await this.messageHistories[e].getMessages(),a=this.transformMessages(s);Xr=await Ve(nd).createFile(r,a)}catch(t){alert(t.message)}else try{if(!await Ve(Xr).exists()){this.newChat(),window.toast("Some error occurred or file you trying to open has been deleted");return}let t=await this.messageHistories[e].getMessages();Xr=await Ve(Xr).writeFile(this.transformMessages(t))}catch(t){alert(t.message)}}catch(e){window.alert(e.message)}}newChat(){this.$chatBox.innerHTML="",window.toast("New session",3e3),this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:Xs()}},Xr=null}async getHistoryItems(){if(await Ve(nd).exists()){let e=await Ve(nd).lsDir(),t="";for(let r=0;r<e.length;r++)t+=`<li class="dialog-item" style="background: var(--secondary-color);color: var(--secondary-text-color);padding: 5px;margin-bottom: 5px;border-radius: 8px;font-size:15px;display:flex;flex-direction:row;justify-content:space-between;gap:5px;" data-path="${JSON.parse(JSON.stringify(e[r])).url}">
                  <p class="history-item">${e[r].name.split("__")[0].substring(0,25)}...</p><div><button class="delete-history-btn" style="height:25px;width:25px;border:none;padding:5px;outline:none;border-radius:50%;background:var(--error-text-color);text-align:center;">\u2717</button></div>
                </li>`;return t}else{let e="";return e='<li style="background: var(--secondary-color);color: var(--secondary-text-color);padding: 10px;border-radius: 8px;" data-path="#not-available">Not Available</li>',e}}extractUUID(e){let t=/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})/,r=e.match(t);return r?r[0]:null}async displayHistory(e,t){this.$chatBox.innerHTML="";let r=e.slice(1,e.length-1),s=this.extractUUID(r);if(!s){this.newChat(),window.toast("Some error occurred");return}if(!await Ve(r).exists()){this.newChat(),window.toast("Some error occurred or file you trying to open has been deleted");return}Xr=r;try{t.hide(),Yr.create("Wait","Fetching chat history....");let a=await Ve(r).readFile(),i=JSON.parse(await Yk.decodeText(a));this.messageHistories={},this.messageHistories[s]=new ko;let o=i.flatMap(l=>[new be({content:l.prompt}),new se({content:l.result})]);await this.messageHistories[s].addMessages(o),this.messageSessionConfig={configurable:{sessionId:s}},i.forEach(l=>{this.appendUserQuery(l.prompt),this.appendGptResponse(l.result)}),Yr.destroy()}catch(a){Yr.destroy(),console.error(a.message)}}async myHistory(){try{let t=`<ul>${await this.getHistoryItems()}</ul>`,r=Ln("Conversation History",t,"Cancel");r.onclick(async s=>{let a=s.target.closest(".dialog-item"),i=a.querySelector(".delete-history-btn"),o=a.querySelector(".history-item");if(a.getAttribute("data-path")!="#not-available"&&a.getAttribute("data-path")){if(s.target===a||s.target===o){let l=JSON.stringify(a.getAttribute("data-path"));this.displayHistory(l,r)}else if(s.target===i){let l=JSON.stringify(a.getAttribute("data-path")),u=l.slice(1,l.length-1);if(await Ve(a.getAttribute("data-path")).delete(),Xr==u){let c=document.querySelector(".chatBox");c.innerHTML="",this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:Xs()}}}a.remove(),window.toast("Deleted",3e3),Xr=null}}})}catch(e){window.alert(e.message)}}async sendQuery(){let e=this.$chatTextarea;e.value!=""&&(this.appendUserQuery(e.value),this.scrollToBottom(),this.appendGptResponse(""),this.loader(),this.getChatgptResponse(e.value),e.value="")}async appendUserQuery(e){try{let t=this.baseUrl+"assets/user_avatar.png",r=tag("div",{className:"wrapper"}),s=tag("div",{className:"chat"}),a=tag("div",{className:"profile",child:tag("img",{src:t,alt:"user"})}),i=tag("div",{className:"message",textContent:e});s.append(a,i),r.append(s),this.$chatBox.appendChild(r)}catch(t){window.alert(t)}}async appendGptResponse(e){let t=this.baseUrl+"assets/ai_assistant.svg",r=tag("div",{className:"ai_wrapper"}),s=tag("div",{className:"ai_chat"}),a=tag("div",{className:"ai_profile",child:tag("img",{src:t,alt:"ai"})}),i=tag("div",{className:"ai_message"});i.innerHTML=this.$mdIt.render(e);let o=i.querySelectorAll(".copy-button");if(o)for(let l of o)l.addEventListener("click",function(){(0,lm.default)(this.dataset.str),window.toast("Copied to clipboard",3e3)});s.append(a,i),r.append(s),this.$chatBox.appendChild(r)}async stopGenerating(){this.abortController.abort(),this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide")}async getChatgptResponse(e){try{let t=Array.from(document.querySelectorAll(".ai_message"));this.abortController=new AbortController;let{signal:r}=this.abortController,s=Fa.fromMessages([["system","You are an AI assistant for the open source plugin AI Assistant for Acode code editor(open source vscode like code editor for Android)."],["placeholder","{chat_history}"],["human","{input}"]]),a=new Zu,i=s.pipe(this.modelInstance).pipe(a),l=await new Ro({runnable:i,getMessageHistory:async f=>{if(this.messageHistories[f]===void 0)this.messageHistories[f]=new ko;else{let h=await this.messageHistories[f].getMessages();this.messageHistories[f].addMessages(h.slice(-6))}return this.messageHistories[f]},inputMessagesKey:"input",historyMessagesKey:"chat_history"}).stream({input:e},this.messageSessionConfig,r);clearInterval(this.$loadInterval),this.$sendBtn.classList.add("hide"),this.$stopGenerationBtn.classList.remove("hide");let u=t[t.length-1];u.innerHTML="";let c="";for await(let f of l)c+=f,u.textContent+=f,this.scrollToBottom();let d=this.$mdIt.render(c);u.innerHTML=d;let p=u.querySelectorAll(".copy-button");if(p)for(let f of p)f.addEventListener("click",function(){(0,lm.default)(this.dataset.str),window.toast("Copied to clipboard",3e3)});this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide"),await this.saveHistory()}catch(t){let r=Array.from(document.querySelectorAll(".ai_message"));clearInterval(this.$loadInterval);let s=r[r.length-1];s.innerHTML="";let a=tag("div",{className:"error-box"});console.log(t),t.response?a.innerText=`Status code: ${t.response.status}
${JSON.stringify(t.response.data)}`:a.innerText=`${t.message}`,s.appendChild(a),this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide")}}async scrollToBottom(){this.$chatBox.scrollTop=this.$chatBox.scrollHeight}async loader(){let e=Array.from(document.querySelectorAll(".ai_message"));e.length!=0&&(this.$loadInterval=setInterval(()=>{e[e.length-1].innerText+="\u2022",e[e.length-1].innerText=="\u2022\u2022\u2022\u2022\u2022\u2022"&&(e[e.length-1].innerText="\u2022")},300))}async showTerminal(){let e=Ln("Terminal & Code Execution","",""),t=tag("div",{className:"terminal-container",style:"height: 400px; background: #1e1e1e; color: #fff; padding: 10px; font-family: monospace; overflow-y: auto;"}),r=tag("input",{type:"text",placeholder:"Enter command or select language for code execution...",className:"terminal-input",style:"width: 100%; margin-top: 10px; padding: 8px; background: #2d2d2d; color: #fff; border: 1px solid #555;"}),s=tag("select",{className:"language-select",style:"width: 100%; margin-top: 5px; padding: 8px; background: #2d2d2d; color: #fff; border: 1px solid #555;"});lx.forEach(o=>{let l=tag("option",{value:o,textContent:o.charAt(0).toUpperCase()+o.slice(1)});s.appendChild(l)});let a=tag("button",{textContent:"Execute",className:"execute-btn",style:"margin-top: 10px; padding: 8px 16px; background: #007acc; color: white; border: none; cursor: pointer;"});a.onclick=async()=>{let o=r.value.trim(),l=s.value;if(o)try{t.innerHTML+=`
$ ${o}
`;let u=await this.terminalManager.executeCommand(o,l);t.innerHTML+=u.stdout+`
`,u.stderr&&(t.innerHTML+=`Error: ${u.stderr}
`),r.value="",t.scrollTop=t.scrollHeight}catch(u){t.innerHTML+=`Error: ${u.message}
`,t.scrollTop=t.scrollHeight}};let i=tag("div",{});i.append(t,s,r,a),e.innerHTML=i.outerHTML,e.show()}async showMultiAI(){let e=Ln("Multi-AI Chat","",""),t=tag("div",{className:"multi-ai-container",style:"height: 500px; display: flex; flex-direction: column;"}),r=tag("div",{className:"active-ais",style:"background: #f5f5f5; padding: 10px; margin-bottom: 10px; border-radius: 5px;"}),s=tag("button",{textContent:"Add AI",style:"margin-bottom: 10px; padding: 8px 16px; background: #28a745; color: white; border: none; cursor: pointer;"}),a=tag("button",{textContent:"Get Consensus",style:"margin-bottom: 10px; margin-left: 10px; padding: 8px 16px; background: #17a2b8; color: white; border: none; cursor: pointer;"}),i=tag("textarea",{placeholder:"Enter your query for all AIs...",style:"width: 100%; height: 100px; margin-bottom: 10px; padding: 8px; resize: vertical;"}),o=tag("button",{textContent:"Query All AIs",style:"padding: 8px 16px; background: #007acc; color: white; border: none; cursor: pointer;"}),l=tag("div",{className:"responses-container",style:"flex: 1; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-top: 10px;"});s.onclick=async()=>{try{let c=await ta("Select AI Provider",xt),d=await ht("API Key","","text",{required:!0}),p=await ht("Model Name","","text",{required:!0}),f=await this.multiAIManager.addAI(c,p,d);this.updateActiveAIsList(r),window.toast(`Added ${c} (${p})`,2e3)}catch(c){window.toast(`Error: ${c.message}`,3e3)}},o.onclick=async()=>{let c=i.value.trim();if(c)try{l.innerHTML="Querying AIs...";let d=await this.multiAIManager.queryAllAIs(c);this.displayMultiAIResponses(l,d)}catch(d){l.innerHTML=`Error: ${d.message}`}},a.onclick=async()=>{let c=i.value.trim();if(c)try{l.innerHTML="Getting consensus...";let d=await this.multiAIManager.getConsensus(c);this.displayConsensus(l,d)}catch(d){l.innerHTML=`Error: ${d.message}`}};let u=tag("div",{});u.append(s,a,i,o),t.append(r,u,l),e.innerHTML=t.outerHTML,e.show(),this.updateActiveAIsList(r)}updateActiveAIsList(e){let t=this.multiAIManager.getActiveAIs();e.innerHTML=`<strong>Active AIs (${t.length}/3):</strong><br>`,t.forEach(r=>{e.innerHTML+=`\u2022 ${r.provider} (${r.model}) - ${r.specialization.join(", ")}<br>`})}displayMultiAIResponses(e,t){e.innerHTML="",t.forEach((r,s)=>{let a=tag("div",{style:"margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"}),i=tag("div",{innerHTML:`<strong>${r.provider} (${r.model})</strong> - ${r.responseTime}ms`,style:"color: #007acc; margin-bottom: 5px;"}),o=tag("div",{innerHTML:r.response||r.error,style:r.error?"color: red;":""});a.append(i,o),e.appendChild(a)})}displayConsensus(e,t){e.innerHTML="";let r=tag("div",{style:"padding: 15px; background: #e8f5e8; border-radius: 5px; margin-bottom: 15px;"});r.innerHTML=`
      <h3>Consensus Result</h3>
      <p><strong>Agreement Score:</strong> ${(t.agreement_score*100).toFixed(1)}%</p>
      <p><strong>Confidence:</strong> ${(t.confidence*100).toFixed(1)}%</p>
      <p><strong>Consensus Response:</strong></p>
      <div style="background: white; padding: 10px; border-radius: 3px; margin: 10px 0;">
        ${t.consensus_response}
      </div>
    `,t.dissenting_opinions.length>0&&(r.innerHTML+=`
        <p><strong>Dissenting Opinions:</strong></p>
        <div style="background: #fff3cd; padding: 10px; border-radius: 3px;">
          ${t.dissenting_opinions.map(a=>`\u2022 ${a.provider}: ${a.response.substring(0,100)}...`).join("<br>")}
        </div>
      `),e.appendChild(r);let s=tag("h4",{textContent:"Individual Responses:"});e.appendChild(s),this.displayMultiAIResponses(e,t.responses)}async showSecurityTools(){let e=Ln("Security & Bug Bounty Tools","",""),t=tag("div",{className:"security-tools-container",style:"height: 500px; display: flex; flex-direction: column;"}),r=tag("select",{style:"width: 100%; margin-bottom: 10px; padding: 8px;"});dl.forEach(c=>{let d=tag("option",{value:c,textContent:c.toUpperCase()});r.appendChild(d)});let s=tag("input",{type:"text",placeholder:"Target (URL, IP, or domain)",style:"width: 100%; margin-bottom: 10px; padding: 8px;"}),a=tag("input",{type:"text",placeholder:"Additional options/flags",style:"width: 100%; margin-bottom: 10px; padding: 8px;"}),i=tag("button",{textContent:"Install Tool",style:"margin-right: 10px; padding: 8px 16px; background: #28a745; color: white; border: none; cursor: pointer;"}),o=tag("button",{textContent:"Run Scan",style:"padding: 8px 16px; background: #dc3545; color: white; border: none; cursor: pointer;"}),l=tag("div",{className:"scan-results",style:"flex: 1; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-top: 10px; background: #1e1e1e; color: #fff; font-family: monospace;"});i.onclick=async()=>{let c=r.value;try{l.innerHTML+=`Installing ${c}...
`;let d=await this.terminalManager.installSecurityTool(c);l.innerHTML+=d.stdout+`
`,l.scrollTop=l.scrollHeight}catch(d){l.innerHTML+=`Error: ${d.message}
`,l.scrollTop=l.scrollHeight}},o.onclick=async()=>{let c=r.value,d=s.value.trim(),p={flags:a.value.trim()};if(!d){window.toast("Please enter a target",2e3);return}try{l.innerHTML+=`Running ${c} scan on ${d}...
`;let f=await this.terminalManager.runSecurityScan(c,d,p);l.innerHTML+=f.stdout+`
`,f.stderr&&(l.innerHTML+=`Errors: ${f.stderr}
`),l.scrollTop=l.scrollHeight}catch(f){l.innerHTML+=`Error: ${f.message}
`,l.scrollTop=l.scrollHeight}};let u=tag("div",{});u.append(r,s,a,i,o),t.append(u,l),e.innerHTML=t.outerHTML,e.show()}async showOllamaManager(){let e=Ln("Ollama Local Models","",""),t=tag("div",{className:"ollama-manager-container",style:"height: 600px; display: flex; flex-direction: column;"}),r=tag("div",{className:"ollama-status",style:"padding: 10px; margin-bottom: 10px; border-radius: 4px;"}),s=tag("div",{className:"models-list",style:"flex: 1; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;"}),a=tag("div",{className:"ollama-controls",style:"display: flex; gap: 10px; margin-bottom: 10px;"}),i=tag("button",{textContent:"Install Ollama",style:"padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer;"}),o=tag("button",{textContent:"Refresh Models",style:"padding: 8px 16px; background: #28a745; color: white; border: none; cursor: pointer;"}),l=tag("input",{type:"text",placeholder:"Model name (e.g., llama3.2:latest)",style:"flex: 1; padding: 8px;"}),u=tag("button",{textContent:"Pull Model",style:"padding: 8px 16px; background: #ffc107; color: black; border: none; cursor: pointer;"});a.append(i,o,l,u);let c=async()=>{let p=this.ollamaManager.getConnectionStatus();r.innerHTML=`
        <strong>Status:</strong> ${p.connected?"\u{1F7E2} Connected":"\u{1F534} Disconnected"}<br>
        <strong>URL:</strong> ${p.baseUrl}<br>
        <strong>Installed Models:</strong> ${p.installedModels}
      `,r.style.background=p.connected?"#d4edda":"#f8d7da"},d=async()=>{try{await this.ollamaManager.loadInstalledModels();let p=this.ollamaManager.installedModels,f=this.ollamaManager.availableModels;s.innerHTML=`
          <h4>Installed Models:</h4>
          ${p.length?p.map(h=>`
            <div style="padding: 8px; border: 1px solid #ddd; margin: 4px 0; border-radius: 4px;">
              <strong>${h.name}</strong> (${h.size||"Unknown size"})
              <button onclick="this.parentElement.remove()" style="float: right; background: #dc3545; color: white; border: none; padding: 4px 8px; cursor: pointer;">Delete</button>
            </div>
          `).join(""):"<p>No models installed</p>"}
          
          <h4>Recommended Models:</h4>
          ${f.filter(h=>h.recommended).map(h=>`
            <div style="padding: 8px; border: 1px solid #ddd; margin: 4px 0; border-radius: 4px;">
              <strong>${h.name}</strong> - ${h.specialty}<br>
              <small>Size: ${h.size}</small>
              <button onclick="pullModel('${h.name}')" style="float: right; background: #28a745; color: white; border: none; padding: 4px 8px; cursor: pointer;">Install</button>
            </div>
          `).join("")}
        `}catch(p){s.innerHTML=`<p>Error loading models: ${p.message}</p>`}};i.onclick=async()=>{let p=await this.ollamaManager.installOllama(),f=Ln("Install Ollama",p.description,"");f.innerHTML=`
        <pre style="background: #1e1e1e; color: #fff; padding: 10px; overflow-x: auto;">${p.script}</pre>
        <p>Estimated time: ${p.estimatedTime}</p>
        <button onclick="this.closest('.dialog-box').remove()" style="padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer;">Close</button>
      `,f.show()},o.onclick=async()=>{await c(),await d()},u.onclick=async()=>{let p=l.value.trim();if(!p){window.toast("Please enter a model name",2e3);return}try{u.textContent="Pulling...",u.disabled=!0,await this.ollamaManager.pullModel(p,f=>{u.textContent=`${f.percent}%`}),window.toast(`Model ${p} installed successfully!`,3e3),await d()}catch(f){window.toast(`Failed to pull model: ${f.message}`,3e3)}finally{u.textContent="Pull Model",u.disabled=!1,l.value=""}},await c(),await d(),t.append(r,s,a),e.innerHTML=t.outerHTML,e.show()}async showPromptManager(){let e=Ln("Custom Prompts & Fine-tuning","",""),t=tag("div",{className:"prompt-manager-container",style:"height: 600px; display: flex; flex-direction: column;"}),r=tag("div",{className:"prompts-list",style:"flex: 1; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;"}),s=tag("div",{className:"prompt-controls",style:"display: flex; gap: 10px; margin-bottom: 10px;"}),a=tag("button",{textContent:"New Prompt",style:"padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer;"}),i=tag("button",{textContent:"Import",style:"padding: 8px 16px; background: #28a745; color: white; border: none; cursor: pointer;"}),o=tag("button",{textContent:"Export",style:"padding: 8px 16px; background: #ffc107; color: black; border: none; cursor: pointer;"}),l=tag("select",{style:"flex: 1; padding: 8px;"}),u=tag("button",{textContent:"Use Template",style:"padding: 8px 16px; background: #6c757d; color: white; border: none; cursor: pointer;"});s.append(a,i,o,l,u);let c=()=>{let p=this.promptManager.getAllPrompts(),f=this.promptManager.getActivePrompt();r.innerHTML=p.map(h=>`
        <div style="padding: 10px; border: 1px solid #ddd; margin: 4px 0; border-radius: 4px; ${f?.id===h.id?"background: #e7f3ff;":""}">
          <div style="display: flex; justify-content: between; align-items: center;">
            <strong>${h.name}</strong>
            <div>
              <button onclick="setActivePrompt('${h.id}')" style="background: #007bff; color: white; border: none; padding: 4px 8px; cursor: pointer; margin-right: 4px;">
                ${f?.id===h.id?"Active":"Activate"}
              </button>
              <button onclick="editPrompt('${h.id}')" style="background: #28a745; color: white; border: none; padding: 4px 8px; cursor: pointer; margin-right: 4px;">Edit</button>
              <button onclick="deletePrompt('${h.id}')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; cursor: pointer;">Delete</button>
            </div>
          </div>
          <small>Category: ${h.category} | Used: ${h.useCount} times</small>
          <p style="margin: 8px 0; max-height: 100px; overflow-y: auto; background: #f8f9fa; padding: 8px; border-radius: 4px;">
            ${h.prompt.substring(0,200)}${h.prompt.length>200?"...":""}
          </p>
        </div>
      `).join("")},d=()=>{let p=this.promptManager.getPromptTemplates();l.innerHTML='<option value="">Select a template...</option>',Object.entries(p).forEach(([f,h])=>{let m=tag("option",{value:f,textContent:h.name});l.appendChild(m)})};a.onclick=()=>{this.showPromptEditor()},o.onclick=()=>{let p=this.promptManager.exportPrompts(),f=new Blob([p],{type:"application/json"}),h=URL.createObjectURL(f);tag("a",{href:h,download:"custom-prompts.json"}).click(),URL.revokeObjectURL(h)},u.onclick=()=>{let p=l.value;if(!p){window.toast("Please select a template",2e3);return}this.showTemplateEditor(p)},c(),d(),t.append(r,s),e.innerHTML=t.outerHTML,e.show()}async showFreeModels(){let e=Ln("Free & Open-Source Models","",""),t=tag("div",{className:"free-models-container",style:"height: 600px; display: flex; flex-direction: column;"}),r=tag("div",{className:"model-tabs",style:"display: flex; border-bottom: 1px solid #ddd; margin-bottom: 10px;"}),s=tag("div",{className:"models-content",style:"flex: 1; overflow-y: auto; padding: 10px;"});Object.entries(Vi).forEach(([o,l],u)=>{let c=tag("button",{textContent:l.name,className:u===0?"active-tab":"",style:`padding: 10px 20px; border: none; background: ${u===0?"#007bff":"#f8f9fa"}; color: ${u===0?"white":"black"}; cursor: pointer; border-bottom: 2px solid ${u===0?"#007bff":"transparent"};`});c.onclick=()=>{r.querySelectorAll("button").forEach(d=>{d.style.background="#f8f9fa",d.style.color="black",d.style.borderBottom="2px solid transparent",d.className=""}),c.style.background="#007bff",c.style.color="white",c.style.borderBottom="2px solid #007bff",c.className="active-tab",a(o,l)},r.appendChild(c)});let a=(o,l)=>{let u=`
        <div class="category-header">
          <h3>${l.name}</h3>
          <p><strong>Type:</strong> ${l.type} | <strong>Cost:</strong> ${l.cost} | <strong>Priority:</strong> ${l.priority}</p>
        </div>
        <div class="models-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 20px;">
      `;l.models.forEach(c=>{let d=l.specialties?.[c]||"General purpose model";u+=`
          <div class="model-card" style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #f8f9fa;">
            <h4 style="margin: 0 0 10px 0; color: #007bff;">${c}</h4>
            <p style="margin: 0 0 10px 0; font-size: 14px; color: #666;">${d}</p>
            <div style="display: flex; gap: 8px;">
              <button onclick="useModel('${o}', '${c}')" style="flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Use Model</button>
              ${l.type==="local"?`<button onclick="installModel('${c}')" style="flex: 1; padding: 8px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Install</button>`:""}
            </div>
          </div>
        `}),u+="</div>",o==="ollama"?u+=`
          <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
            <h4>Ollama Setup Instructions:</h4>
            <ol>
              <li>Install Ollama: <code>curl -fsSL https://ollama.ai/install.sh | sh</code></li>
              <li>Start Ollama service: <code>ollama serve</code></li>
              <li>Pull models: <code>ollama pull llama3.2:latest</code></li>
            </ol>
          </div>
        `:o==="huggingface"&&(u+=`
          <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
            <h4>Hugging Face Setup:</h4>
            <p>Most models are free to use. Some may require a Hugging Face account for API access.</p>
            <p>Get your free API key at: <a href="https://huggingface.co/settings/tokens" target="_blank">https://huggingface.co/settings/tokens</a></p>
          </div>
        `),s.innerHTML=u},i=Object.entries(Vi)[0];a(i[0],i[1]),t.append(r,s),e.innerHTML=t.outerHTML,e.show()}async enhancedSendQuery(){let e=wx(this.$chatTextarea.value.trim());if(!e)return;let t=bx(e);t.length>0&&this.codeExecutionEnabled&&await this.confirmCodeExecution(t)&&await this.executeCodeBlocks(t),this.isMultiAIMode&&this.multiAIManager.getActiveAIs().length>1?await this.handleMultiAIQuery(e):await this.sendQuery()}async confirmCodeExecution(e){let t=e.map(r=>`${r.language}:
${r.code.substring(0,200)}${r.code.length>200?"...":""}`).join(`

`);return await acode.confirm("Code Execution",`Execute the following code?

${t}`,"Execute","Cancel")}async executeCodeBlocks(e){for(let t of e)try{let r=await this.terminalManager.executeCommand(t.code,t.language);this.addMessage("system",`Code executed (${t.language}):
${r.stdout}`,!1),r.stderr&&this.addMessage("system",`Errors: ${r.stderr}`,!1)}catch(r){this.addMessage("system",`Execution error: ${r.message}`,!1)}}async handleMultiAIQuery(e){try{if(this.addMessage("user",e,!0),this.$sendBtn.classList.add("hide"),this.$stopGenerationBtn.classList.remove("hide"),(await this.multiAIManager.queryAllAIs(e)).forEach(r=>{r.status!=="rejected"&&this.addMessage("assistant",`**${r.provider} (${r.model})**:
${r.response}`,!1)}),this.multiAIManager.consensusMode){let r=await this.multiAIManager.getConsensus(e);this.addMessage("system",`**Consensus (${(r.confidence*100).toFixed(1)}% confidence)**:
${r.consensus_response}`,!1)}}catch(t){this.addMessage("system",`Multi-AI Error: ${t.message}`,!1)}finally{this.$sendBtn.classList.remove("hide"),this.$stopGenerationBtn.classList.add("hide"),this.$chatTextarea.value=""}}async destroy(){editorManager.editor.commands.removeCommand("ai_assistant"),window.localStorage.removeItem(window.localStorage.getItem("ai-assistant-provider")),window.localStorage.removeItem("ai-assistant-provider"),window.localStorage.removeItem("ai-assistant-model-name"),window.localStorage.removeItem("openai-like-baseurl"),await Ve(window.DATA_STORAGE+"secret.key").exists()&&await Ve(window.DATA_STORAGE+"secret.key").delete(),this.$githubDarkFile.remove(),this.$higlightJsFile.remove(),this.$markdownItFile.remove(),this.$style.remove()}};if(window.acode){let n=new um;acode.setPluginInit(id.id,(e,t,{cacheFileUrl:r,cacheFile:s})=>{e.endsWith("/")||(e+="/"),n.baseUrl=e,n.init(t,s,r)}),acode.setPluginUnmount(id.id,()=>{n.destroy()})}})();
/*! Bundled license information:

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
